<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Referees - 5ive Trackr</title>
    <meta name="author" content="5ive Trackr">
    <meta name="copyright" content="Â© 2025 5ive Trackr. All rights reserved.">
    <meta name="robots" content="noarchive, noimageindex">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    
    <!-- Consolidated Dashboard Master CSS -->
    <link rel="stylesheet" href="../../css/dashboard-master.css?v=consolidated-2025">
    <style>
    /* Safe system font stack - no external dependencies */
    body, * {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, Roboto, "Noto Sans", "Liberation Sans", sans-serif;
    }
</style>
    <!-- League Manager Sidebar Styles - Load immediately to prevent layout shifts -->
    <link rel="stylesheet" href="../../css/league-manager-sidebar.css">
    <!-- League Manager Header Styles - Load immediately to prevent layout shifts -->
    <link rel="stylesheet" href="../../css/league-manager-header.css">
    
    <style>
        /* Main Content Area */
        .main-content {
            margin-left: 250px;
            padding-top: 70px;
            min-height: calc(100vh - 140px);
            background: white;
            overflow-y: auto;
            padding-bottom: 80px;
        }

        .content-area {
            padding: 24px 24px 60px 24px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        /* Overview Cards Styling */
        .overview-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 48px;
            margin-bottom: 48px;
        }

        .overview-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 60px;
        }

        .overview-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .card-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            gap: 16px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        .card-value {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            line-height: 1;
        }

        /* Management Controls Styling */
        .management-controls {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 24px;
            gap: 32px;
            position: relative;
            padding: 8px 0 8px 16px; /* Add padding: top, right, bottom, left */
            background: #f8f9fa;
            border-radius: 8px;
        }

        .search-container {
            position: relative;
            display: flex;
            align-items: center;
            width: 395px; /* Fixed width for better control */
        }

        .venue-filter-container {
            position: relative;
            display: flex;
            align-items: center;
            width: 500px; /* Fixed width */
            margin-left: 0;
        }

        .search-input {
            width: 100%;
            padding: 10px 40px 10px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            background: white;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #2e6417;
            box-shadow: 0 0 0 3px rgba(46, 100, 23, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            font-size: 16px;
            color: #6b7280;
            pointer-events: none;
        }

        .venue-filter-btn {
            width: 100%;
            padding: 10px 40px 10px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            background: white;
            transition: all 0.2s;
            cursor: pointer;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .venue-filter-btn:hover,
        .venue-filter-btn.active {
            border-color: #2e6417;
            box-shadow: 0 0 0 3px rgba(46, 100, 23, 0.1);
        }

        .venue-filter-icon {
            font-size: 16px;
            color: #6b7280;
            transition: transform 0.2s;
        }

        .venue-filter-btn.active .venue-filter-icon {
            transform: rotate(180deg);
        }

        .venue-filter-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .venue-filter-dropdown.show {
            display: block;
        }

        .venue-option-filter {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
        }

        .venue-option-filter:last-child {
            border-bottom: none;
        }

        .venue-option-filter:hover {
            background-color: #f9fafb;
        }

        .venue-checkbox {
            margin-right: 8px; /* Reduced from default */
            cursor: pointer;
            width: 14px; /* Reduced size */
            height: 14px; /* Reduced size */
        }

        .venue-option-text {
            flex: 1;
            font-size: 14px;
            color: #374151;
        }

        /* Table Styling */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            overflow: hidden;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .referees-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Inter', sans-serif;
        }

        .table-header-cell {
            padding: 16px 20px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            border-right: 1px solid #f3f4f6;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: relative;
            vertical-align: middle;
            line-height: 1.2;
        }

        .table-header-cell:last-child {
            border-right: none;
        }

        .table-header-cell.sortable {
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }

        .table-header-cell.sortable:hover {
            background: #f3f4f6;
        }

        .sort-indicator {
            display: inline-block;
            margin-left: 8px;
            font-size: 12px;
            color: #9ca3af;
            transition: color 0.2s;
            vertical-align: middle;
            line-height: 1;
        }

        .table-header-cell.sort-asc .sort-indicator {
            color: #2e6417;
        }

        .table-header-cell.sort-desc .sort-indicator {
            color: #2e6417;
        }

        .table-header-cell.sort-asc .sort-indicator::after {
            content: "â–²";
        }

        .table-header-cell.sort-desc .sort-indicator::after {
            content: "â–¼";
        }

        .table-header-cell.sortable:not(.sort-asc):not(.sort-desc) .sort-indicator::after {
            content: "â–²â–¼";
            font-size: 10px;
        }

        .referees-table tbody tr {
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
        }

        .referees-table tbody tr:hover {
            background-color: #f9fafb;
        }

        .referees-table tbody tr:last-child {
            border-bottom: none;
        }

        .referees-table td {
            padding: 16px 20px;
            vertical-align: middle;
            font-size: 14px;
            color: #374151;
            border-right: 1px solid #f3f4f6;
        }

        .referees-table td:last-child {
            border-right: none;
        }

        /* Center align specific columns */
        .referees-table td:nth-child(3) { /* Active column */
            text-align: center;
        }

        .referees-table td:nth-child(4) { /* Schedule column */
            text-align: center;
        }

        /* Column Specific Styling */
        .referee-col {
            width: 26%; /* Keep the same */
        }

        .venues-col {
            width: 35%; /* Increased from 27% */
        }

        .active-col {
            width: 8%; /* Reduced from 8% */
        }

        .schedule-col {
            width: 31%; /* Fit 14-day calendar */
        }

        .referee-info {
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: space-between;
            width: 100%;
            cursor: pointer;
            transition: background-color 0.2s ease;
            padding: 4px;
            border-radius: 6px;
            margin: -4px;
        }

        .referee-info:hover {
            background-color: #f0f7ed;
        }

        .referee-main-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .referee-avatar {
            width: 40px;
            height: 40px;
            background: #2e6417;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .referee-details {
            flex: 1;
        }

        .referee-name {
            font-weight: 600;
            color: #111827;
            margin-bottom: 2px;
        }

        .referee-contact {
            font-size: 12px;
            color: #6b7280;
        }

        .venue-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .venue-tag {
            background: #f0f7ed;
            color: #2e6417;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #dcfce7;
            color: #166534;
        }

        .status-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .schedule-info {
            font-size: 12px;
            color: #6b7280;
        }

        .schedule-games {
            font-weight: 600;
            color: #111827;
            margin-bottom: 2px;
        }

        /* Schedule Calendar Styling */
        .schedule-calendar {
            display: flex;
            gap: 2px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .schedule-day {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 28px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            padding: 2px;
        }

        .schedule-day.assigned {
            background: #2e6417;
            color: white;
            border: 1px solid transparent;
        }

        .schedule-day.available {
            background: #f3f4f6;
            color: #6b7280;
            border: 1px solid #e5e7eb;
        }

        .schedule-day.current-day {
            border: 2px solid #000000 !important;
        }

        .schedule-day:hover {
            transform: scale(1.1);
        }

        .day-number {
            font-size: 10px;
            font-weight: 700;
            line-height: 1;
        }

        .day-letter {
            font-size: 8px;
            font-weight: 500;
            line-height: 1;
            margin-top: 1px;
        }

        .venues-list {
            font-size: 14px;
            color: #374151;
            line-height: 1.4;
        }

        .status-icon {
            font-size: 18px;
            display: inline-block;
        }

        /* Content Header - Removed */

        /* Page Header Styling - Matching Teams Page */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f3f4f6;
        }
        
        .page-title-section {
            flex: 1;
        }
        
        .page-title, .content-title {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 4px 0;
        }
        
        .page-subtitle {
            color: #6b7280;
            font-size: 16px;
            margin: 0;
        }
        
        .page-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            text-decoration: none;
            font-family: 'Inter', sans-serif;
        }
        
        .btn-primary {
            background-color: #2e6417;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e4009;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background-color: #e9ecef;
        }
        
        .btn-danger {
            background-color: #dc2626;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #b91c1c;
            transform: translateY(-1px);
        }
        
        .modal-footer-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn-icon {
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
        }

        /* Professional CSS Icons */
        .btn-icon.icon-export::before {
            content: "ðŸ“‹";
            font-style: normal;
        }
        
        .btn-icon.icon-create::before {
            content: "ï¼‹";
            font-style: normal;
            font-weight: bold;
        }

        /* Action Cards Grid - Removed */

        /* Button Styles - Removed */

        /* Table styles removed - ready for rebuild */

        /* Header Template Styles */
        .main-header[data-loaded="league-manager"] {
            background-color: #ffffff !important;
            border-radius: 0 0 12px 12px !important;
            padding: 16px 24px !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            width: calc(100% - 250px) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            position: fixed !important;
            top: 0 !important;
            left: 250px !important;
            z-index: 999 !important;
            height: 70px !important;
            box-sizing: border-box !important;
        }

        /* Notifications Button Styling */
        .notifications-btn {
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            padding: 0;
            font-size: 10px;
            font-weight: 600;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }

        .notification-badge.hidden {
            display: none;
        }

        /* Notifications Panel Styling */
        .notifications-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 400px;
            max-width: 90vw;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1001;
            max-height: 60vh;
            display: none;
            flex-direction: column;
            border: 1px solid #e0e0e0;
        }

        .notifications-panel.active {
            display: flex;
        }

        .notifications-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }

        .notifications-overlay.active {
            display: block;
        }

        .notifications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .notifications-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .notifications-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mark-all-read {
            color: #2e6417;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }

        .mark-all-read:hover {
            text-decoration: underline;
        }

        .close-panel {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-panel:hover {
            color: #333;
        }

        .notifications-content {
            flex: 1;
            overflow-y: auto;
            max-height: calc(60vh - 80px);
        }

        .notifications-list {
            padding: 8px 0;
        }

        /* Dialog styles removed - not needed */

        /* Venue Selector Styles */
        .venue-selector-container {
            padding: 0 15px 20px 15px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 16px;
            position: relative;
            overflow: visible;
        }

        .venue-selector-btn {
            width: 100% !important;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: none !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2);
            position: relative;
            box-sizing: border-box !important;
            margin: 0 !important;
            user-select: none !important;
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
        }

        .venue-selector-btn:hover {
            transform: none !important;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2) !important;
        }

        .venue-selector-btn:active {
            transform: none !important;
        }

        .venue-selector-content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
        }

        .venue-selector-label {
            font-size: 0.7rem;
            opacity: 0.9;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .venue-selector-name {
            font-size: 0.875rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .venue-selector-icon {
            font-size: 1rem;
            margin-left: 8px;
            transition: none !important;
        }

        .venue-selector-btn.active .venue-selector-icon {
            transform: rotate(180deg) !important;
            transition: none !important;
        }

        .venue-selector-btn.active {
            border-radius: 8px 8px 0 0 !important;
            border-bottom: none !important;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2) !important;
            transition: none !important;
        }

        .venue-dropdown {
            position: absolute;
            top: calc(100% - 1px);
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            border: none !important;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            z-index: 9999 !important;
            margin-top: 0;
            transform: none !important;
            transition: none !important;
            display: none;
            max-height: 300px;
            overflow-y: auto;
            color: white;
            outline: none !important;
        }

        .venue-dropdown.show {
            display: block !important;
            transition: none !important;
        }

        /* Venue Selector Overlay - Only darken area outside dropdown */
        .venue-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            z-index: 9998 !important;
            display: none;
            transition: none !important;
        }

        .venue-selector-overlay.show {
            display: block !important;
            transition: none !important;
        }

        .venue-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: none !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
            background: transparent;
        }

        .venue-option:last-child {
            border-bottom: none;
        }

        .venue-option:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            transition: none !important;
        }

        .venue-option.selected {
            background: rgba(255, 255, 255, 0.2) !important;
            color: white;
            font-weight: 700;
            transition: none !important;
        }

        .venue-option-details {
            display: flex;
            flex-direction: column;
        }

        .venue-option-name {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 2px;
            color: white;
        }

        .venue-option-address {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.8);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .venue-option-check {
            color: white;
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Clickable Overview Cards */
        .overview-card.clickable {
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .overview-card.clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        /* Quick Assignment Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        .quick-assignment-modal {
            width: 90%;
            max-width: 1200px;
            height: 85vh;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
            flex-shrink: 0; /* Prevent header from shrinking */
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            margin: 0;
        }

        .modal-close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .modal-close-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 24px 32px;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
            flex-shrink: 0; /* Prevent the footer from shrinking */
            margin-top: auto; /* Push footer to bottom */
        }

        /* Date Range Selector */
        .date-range-selector {
            margin-bottom: 32px;
        }

        .date-range-label {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }

        .date-range-options {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .date-range-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .date-range-btn:hover {
            border-color: #2e6417;
            color: #2e6417;
        }

        .date-range-btn.active {
            background: #2e6417;
            border-color: #2e6417;
            color: white;
        }

        .date-range-display {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        /* Assignment Controls */
        .assignment-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .assignment-stats {
            display: flex;
            gap: 32px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #111827;
        }

        .assignment-actions {
            display: flex;
            gap: 12px;
        }

        /* Fixtures Assignment Container */
        .fixtures-assignment-container {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
        }

        .fixtures-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .fixture-day-group {
            border-bottom: 1px solid #f3f4f6;
        }

        .fixture-day-group:last-child {
            border-bottom: none;
        }

        .fixture-day-header {
            background: #f9fafb;
            padding: 16px 24px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .fixture-assignment-row {
            display: grid;
            grid-template-columns: 1fr 120px 200px 120px;
            gap: 16px;
            padding: 16px 24px;
            border-bottom: 1px solid #f3f4f6;
            align-items: center;
        }

        .fixture-assignment-row:last-child {
            border-bottom: none;
        }

        .fixture-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .fixture-teams {
            font-weight: 600;
            color: #111827;
        }

        .fixture-details {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .fixture-time {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            text-align: center;
        }

        .referee-assignment-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
            background: white;
            color: #374151;
        }

        .referee-assignment-select:focus {
            outline: none;
            border-color: #2e6417;
            box-shadow: 0 0 0 3px rgba(46, 100, 23, 0.1);
        }

        .assignment-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .assignment-status.assigned {
            color: #059669;
        }

        .assignment-status.unassigned {
            color: #dc2626;
        }

        .assignment-status-icon {
            font-size: 1rem;
        }

        /* Empty State */
        .fixtures-empty-state {
            padding: 60px 24px;
            text-align: center;
            color: #6b7280;
        }

        .fixtures-empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
        }

        .fixtures-empty-state-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .fixtures-empty-state-text {
            font-size: 0.875rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Referee Details Modal */
        .referee-details-modal {
            width: 90%;
            max-width: 800px;
            height: auto;
            max-height: 90vh;
            overflow-x: hidden;
        }

        .referee-details-content {
            display: flex;
            flex-direction: column;
            gap: 24px;
            padding: 32px;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: calc(90vh - 160px); /* Account for header and footer */
        }

        .referee-details-section {
            display: flex;
            flex-direction: column;
            gap: 24px;
            width: 100%;
            min-width: 0;
        }

        .referee-details-header-section {
            width: 100%;
        }

        .referee-details-lower-sections {
            display: flex;
            flex-direction: column;
            gap: 24px;
            width: 100%;
        }

        .referee-details-lower-section {
            display: flex;
            flex-direction: column;
            gap: 24px;
            width: 100%;
        }

        .referee-details-card {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            width: 100%;
            box-sizing: border-box;
            min-width: 0;
        }

        .referee-details-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .referee-details-avatar {
            width: 60px;
            height: 60px;
            background: #2e6417;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
        }

        .referee-details-basic {
            flex: 1;
        }

        .referee-details-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 4px;
        }

        .referee-details-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: #6b7280;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-weight: 600;
            color: #111827;
            text-align: right;
            max-width: 60%;
        }

        .referee-venues-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: flex-start;
            width: 100%;
        }

        .referee-venue-badge {
            background: #2e6417;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .referee-schedule-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 12px;
            width: 100%;
            max-width: 100%;
            overflow: visible;
        }

        .schedule-day-detail {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 40px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            min-width: 0;
        }

        .schedule-day-detail:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .schedule-day-detail.assigned {
            background: #2e6417;
            color: white;
            border-color: #2e6417;
        }

        .schedule-day-detail.available {
            background: #f3f4f6;
            color: #6b7280;
        }

        .schedule-day-detail.current-day {
            border: 2px solid #000000;
        }

        /* Schedule Day Hover Window */
        .schedule-hover-window {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 12px;
            min-width: 200px;
            max-width: 280px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            pointer-events: none;
            text-align: center;
        }

        .schedule-day-detail:hover .schedule-hover-window {
            opacity: 1;
            visibility: visible;
            transition-delay: 0.5s;
        }

        .schedule-hover-header {
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
            font-size: 0.875rem;
            text-align: center;
        }

        .schedule-fixture-item {
            padding: 6px 0;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.75rem;
            text-align: center;
            white-space: normal;
        }

        .schedule-fixture-item:last-child {
            border-bottom: none;
        }

        .fixture-time {
            font-weight: 600;
            color: #2e6417;
            margin-bottom: 2px;
        }

        .fixture-teams {
            color: #374151;
            margin-bottom: 2px;
        }

        .fixture-venue {
            color: #6b7280;
            font-size: 0.7rem;
        }

        .no-fixtures-message {
            text-align: center;
            color: #6b7280;
            font-size: 0.75rem;
            font-style: italic;
        }

        /* Schedule Day Click Modal */
        .schedule-day-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .schedule-day-modal.show {
            display: flex;
        }

        .schedule-day-modal-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        .schedule-day-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .schedule-day-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #111827;
            margin: 0;
        }

        .schedule-day-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .schedule-day-modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .schedule-day-modal-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .schedule-day-fixture {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .schedule-day-fixture:last-child {
            margin-bottom: 0;
        }

        .fixture-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .fixture-time-large {
            font-weight: 700;
            color: #2e6417;
            font-size: 1rem;
        }

        .fixture-status {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .fixture-status.confirmed {
            background: #dcfce7;
            color: #166534;
        }

        .fixture-status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .fixture-teams-large {
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
            font-size: 0.875rem;
        }

        .fixture-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .no-fixtures-day {
            text-align: center;
            color: #6b7280;
            font-style: italic;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-top: 16px;
            justify-items: center;
        }

        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2e6417;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 32px;
        }

        .form-row {
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }

        .form-input {
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #2e6417;
            box-shadow: 0 0 0 3px rgba(46, 100, 23, 0.1);
        }

        .venues-selection {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .venue-checkbox-group {
            display: flex;
            align-items: center;
        }

        .venue-checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.875rem;
            color: #374151;
        }

        .venue-checkbox-input {
            margin-right: 8px; /* Reduced from 12px */
            cursor: pointer;
            width: 14px; /* Reduced from 16px */
            height: 14px; /* Reduced from 16px */
        }

        .venue-checkbox-text {
            font-weight: 500;
        }

        /* Confirmation Message Styles */
        .confirmation-message {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .confirmation-icon {
            font-size: 2rem;
            flex-shrink: 0;
            margin-top: 4px;
        }

        .confirmation-text {
            flex: 1;
        }

        .confirmation-text p {
            margin: 0 0 12px 0;
            color: #374151;
            line-height: 1.5;
        }

        .confirmation-text p:last-child {
            margin-bottom: 0;
        }

        .confirmation-text strong {
            color: #111827;
        }

        /* Success Message Styles */
        .success-message {
            display: flex;
            align-items: flex-start;
            gap: 16px;
        }

        .success-icon {
            font-size: 2rem;
            flex-shrink: 0;
            margin-top: 4px;
        }

        .success-text {
            flex: 1;
        }

        .success-text p {
            margin: 0;
            color: #374151;
            line-height: 1.5;
            font-size: 1rem;
        }

        /* Invite Referee Modal Styles */
        .invitation-preview {
            margin-top: 24px;
            border-top: 1px solid #e5e7eb;
            padding-top: 24px;
        }

        .preview-card {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
        }

        .preview-header {
            font-weight: 600;
            color: #111827;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
        }

        .preview-body {
            color: #374151;
        }

        .preview-body p {
            margin: 0 0 12px 0;
        }

        .preview-body ul {
            margin: 8px 0 12px 20px;
            padding: 0;
        }

        .preview-body li {
            margin-bottom: 4px;
        }

        .form-input[type="email"]:invalid {
            border-color: #dc2626;
        }

        .form-input[type="email"]:valid {
            border-color: #16a34a;
        }

        /* Responsive adjustments for invite modal */
        @media (max-width: 768px) {
            .modal-container {
                margin: 16px;
                max-height: calc(100vh - 32px);
            }
            
            .invitation-preview {
                margin-top: 16px;
                padding-top: 16px;
            }
            
            .preview-card {
                padding: 16px;
            }
        }

        /* Navigation Icon Fixes */
        body[data-role="league-manager"] .sidebar .nav-icon[data-icon="referee"],
        .sidebar .nav-icon[data-icon="referee"] {
            background-image: url('../../img/referee-icon.svg') !important;
            background-size: 18px 18px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            width: 20px !important;
            height: 20px !important;
            display: inline-block !important;
        }

        body[data-role="league-manager"] .sidebar .nav-icon[data-icon="shirt"],
        .sidebar .nav-icon[data-icon="shirt"] {
            background-image: url('../../img/shirt-icon.svg') !important;
            background-size: 18px 18px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            width: 20px !important;
            height: 20px !important;
            display: inline-block !important;
        }

        /* Navigation Sizing Fix Applied: Consistent padding (14px 20px) for all nav items via league-manager-sidebar.css */

        /* Export Data Modal Styles */
        .export-data-modal {
            width: 90%;
            max-width: 800px;
            height: auto;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .export-section {
            margin-bottom: 48px;
        }

        .export-section:last-child {
            margin-bottom: 0;
        }

        .export-section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }

        .export-options-grid {
            display: none; /* Hidden - data types are now mandatory */
        }

        /* Monthly Export View Styles */
        .monthly-export-container {
            margin-bottom: 24px;
        }

        .monthly-export-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 8px;
        }

        .monthly-export-header .export-section-title {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
            margin-top: 0;
            flex: 1;
            margin-right: 24px;
            align-self: center;
            line-height: 1;
        }

        .monthly-export-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
        }

        .monthly-export-nav {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .monthly-nav-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            color: #374151;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .monthly-nav-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .monthly-nav-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .monthly-export-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-height: none; /* Remove height restriction to show all venues */
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            background: white;
        }

        .month-row {
            display: flex;
            align-items: stretch;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background: #f9fafb;
            min-height: auto; /* Allow natural sizing based on content */
        }

        .month-label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 120px; /* Reduced from 160px */
            min-width: 120px;
            padding: 12px 16px; /* Reduced padding */
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            color: white;
            font-weight: 700;
            font-size: 0.75rem; /* Reduced from 0.875rem */
            text-transform: uppercase;
            letter-spacing: 0.05em;
            flex-shrink: 0; /* Prevent shrinking */
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-family: 'Inter', sans-serif;
        }

        .month-label:hover {
            background: linear-gradient(135deg, #1e4009 0%, #2e6417 100%);
            transform: translateY(-1px);
        }

        .month-label.selected {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            box-shadow: 0 0 0 2px #22c55e;
        }

        .month-label.selected:hover {
            background: linear-gradient(135deg, #15803d 0%, #16a34a 100%);
        }

        .month-label-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-align: center;
            line-height: 1.2;
        }

        .month-name {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 2px;
        }

        .month-year {
            font-size: 0.65rem;
            font-weight: 600;
            opacity: 0.9;
            text-transform: none;
            letter-spacing: 0.02em;
        }

        .venues-export-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            min-height: auto; /* Allow natural sizing */
        }

        .venue-export-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            background: white; /* Remove selection styling */
            cursor: default; /* Remove pointer cursor */
            transition: all 0.2s ease;
        }

        .venue-export-item:last-child {
            border-bottom: none;
        }

        .venue-export-item.highlighted {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-left: 3px solid #16a34a;
            padding-left: 13px; /* Adjust for border */
        }

        .venue-export-item.highlighted .venue-export-name {
            color: #15803d;
            font-weight: 600;
        }

        /* Remove hover and selection states - venues are no longer interactive */

        .venue-export-name {
            font-weight: 500;
            color: #374151;
            font-size: 0.75rem; /* Reduced from 0.875rem */
        }

        .venue-export-status {
            display: flex;
            align-items: center;
            gap: 4px; /* Reduced from 6px */
        }

        .export-status-indicator {
            width: 10px; /* Reduced from 12px */
            height: 10px; /* Reduced from 12px */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 7px; /* Reduced from 8px */
            font-weight: 700;
        }

        .export-status-indicator.exported {
            background: #22c55e;
            color: white;
        }

        .export-status-indicator.not-exported {
            background: #e5e7eb;
            color: #6b7280;
        }

        .export-status-indicator.partial {
            background: #f59e0b;
            color: white;
        }

        .export-status-text {
            font-size: 0.65rem; /* Reduced from 0.75rem */
            font-weight: 500;
            color: #6b7280;
        }

        .export-status-text.exported {
            color: #22c55e;
        }

        .export-status-text.partial {
            color: #f59e0b;
        }

        .selected-months-display {
            margin-top: 16px;
            padding: 12px 16px;
            background: #f0f7ed;
            border: 1px solid #2e6417;
            border-radius: 8px;
        }

        .selected-months-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #2e6417;
            margin-bottom: 8px;
        }

        .selected-months-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .selected-month-tag {
            background: #2e6417;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .clear-selection-btn {
            background: none;
            border: none;
            color: #6b7280;
            font-size: 0.75rem;
            cursor: pointer;
            margin-left: 8px;
            text-decoration: underline;
        }

        .clear-selection-btn:hover {
            color: #374151;
        }

        .date-range-display {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-top: 16px;
            padding: 12px 16px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .date-range-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
        }

        .date-range-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: #111827;
        }

        /* Venue Filter Styles */
        .venue-filter-section {
            margin-bottom: 24px;
        }

        .venue-filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
        }

        .venue-filter-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
        }

        .venue-filter-option:hover {
            border-color: #2e6417;
            background: #f9fafb;
        }

        .venue-filter-option.selected {
            border-color: #2e6417;
            background: #f0f7ed;
        }

        .venue-filter-checkbox {
            margin-right: 8px; /* Reduced from 12px */
            width: 14px; /* Reduced from 16px */
            height: 14px; /* Reduced from 16px */
            cursor: pointer;
        }

        .venue-filter-text {
            flex: 1;
            font-weight: 500;
            color: #374151;
        }

        .venue-filter-text.all-venues {
            font-weight: 600;
            color: #2e6417;
        }

        /* Export Preview Styles */
        .export-preview {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 24px;
        }

        .export-preview-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
        }

        .export-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
        }

        .export-summary-item {
            text-align: center;
        }

        .export-summary-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2e6417;
            margin-bottom: 4px;
        }

        .export-summary-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Export Format Options */
        .export-format-options {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .export-format-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .export-format-btn:hover {
            border-color: #2e6417;
            color: #2e6417;
        }

        .export-format-btn.selected {
            background: #2e6417;
            border-color: #2e6417;
            color: white;
        }

        /* Export Button Disabled State and Tooltip */
        .btn:disabled, .btn.disabled {
            background-color: #f3f4f6 !important;
            color: #9ca3af !important;
            border-color: #e5e7eb !important;
            cursor: not-allowed !important;
            opacity: 0.6 !important;
            transform: none !important;
            box-shadow: none !important;
            position: relative;
        }

        .btn:disabled:hover, .btn.disabled:hover {
            background-color: #f3f4f6 !important;
            color: #9ca3af !important;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Export Button Tooltip */
        .export-btn-container {
            position: relative;
            display: inline-block;
        }

        .export-btn-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: #374151;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            z-index: 1000;
            pointer-events: none;
        }

        .export-btn-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: #374151;
        }

        .export-btn-container:hover .export-btn-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Only show tooltip when button is disabled */
        .export-btn-container:has(.btn:not(:disabled)) .export-btn-tooltip,
        .export-btn-container:has(.btn:not(.disabled)) .export-btn-tooltip {
            display: none !important;
        }

        /* Fallback for browsers that don't support :has() */
        .btn:not(:disabled) ~ .export-btn-tooltip,
        .btn:not(.disabled) ~ .export-btn-tooltip {
            display: none !important;
        }
    </style>
    <\!-- SPA Redirect Handler -->
    <script src="../../js/core/spa-redirect.js"></script>
</head>
<body data-page="referees" data-role="league-manager">
    <!-- Sidebar - Static content with dynamic enhancement -->
    <aside class="sidebar">
        <!-- Static sidebar content that loads immediately -->
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="../../img/header-logo.svg" alt="5ive Trackr" class="logo">
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="sidebar-nav">
            <!-- Venue Selector -->
            <div class="venue-selector-container">
                <div class="venue-selector-btn" id="venue-selector-btn" onclick="toggleVenueDropdown()">
                    <div class="venue-selector-content">
                        <div class="venue-selector-label">Current Venue</div>
                        <div class="venue-selector-name" id="selected-venue-name">Loading...</div>
                    </div>
                    <span class="venue-selector-icon">â–¼</span>
                    <div class="venue-dropdown" id="venue-dropdown">
                        <!-- Data will be loaded dynamically based on logged-in user -->
                        <div class="venue-option" data-venue-id="VEN002" onclick="selectVenue('VEN002', 'Elite Sports Center', '456 Championship Drive', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Elite Sports Center</div>
                                <div class="venue-option-address">456 Championship Drive</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <div class="venue-option" data-venue-id="VEN003" onclick="selectVenue('VEN003', 'Premier League Complex', '789 Victory Boulevard', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Premier League Complex</div>
                                <div class="venue-option-address">789 Victory Boulevard</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <div class="venue-option" data-venue-id="VEN001" onclick="selectVenue('VEN001', 'Sports Arena West', '123 Athletic Avenue', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Sports Arena West</div>
                                <div class="venue-option-address">123 Athletic Avenue</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <!-- END MOCK DATA -->
                    </div>
                </div>
            </div>

            <!-- Venue Selector Overlay -->
            <div class="venue-selector-overlay" id="venue-selector-overlay" onclick="closeVenueDropdown()"></div>

            <ul class="nav-menu">
                <li class="nav-item" data-page="dashboard">
                    <a href="dashboard.html" class="nav-link">
                        <span class="nav-icon">ðŸ“Š</span>
                        <span class="link-text">Dashboard</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="fixtures">
                    <a href="fixtures.html" class="nav-link">
                        <span class="nav-icon">ðŸ“…</span>
                        <span class="link-text">Fixtures</span>
                    </a>
                </li>
                
                <li class="nav-item active" data-page="referees">
                    <a href="referees.html" class="nav-link">
                        <span class="nav-icon" data-icon="referee"></span>
                        <span class="link-text">Referees</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="divisions">
                    <a href="divisions.html" class="nav-link">
                        <span class="nav-icon">ðŸ“‹</span>
                        <span class="link-text">Divisions</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="leagues">
                    <a href="leagues.html" class="nav-link">
                        <span class="nav-icon">ðŸ†</span>
                        <span class="link-text">Leagues</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="teams">
                    <a href="teams.html" class="nav-link">
                        <span class="nav-icon" data-icon="shirt"></span>
                        <span class="link-text">Teams</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="pitches">
                    <a href="pitches.html" class="nav-link">
                        <span class="nav-icon">ðŸ¥…</span>
                        <span class="link-text">Pitches</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="venues">
                    <a href="venues.html" class="nav-link">
                        <span class="nav-icon">ðŸŸï¸</span>
                        <span class="link-text">Venues</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="payments">
                    <a href="team-payments.html" class="nav-link">
                        <span class="nav-icon">ðŸ’³</span>
                        <span class="link-text">Team Payments</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
            <div class="footer-section footer-actions">
                <a href="settings.html" class="footer-link">
                    <span class="footer-icon">âš™ï¸</span>
                    <span class="footer-text">Settings</span>
                </a>
                <a href="#" class="footer-link" onclick="handleLogout(event)">
                    <span class="footer-icon">ðŸšª</span>
                    <span class="footer-text">Logout</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- League Manager Header Template -->
    <header class="main-header" data-loaded="league-manager">
        <div class="header-left">
            <h1 class="page-title" data-page-title>Referees</h1>
        </div>

        <div class="header-right">
            <!-- User Info Section -->
            <div class="user-info"> data-user-name
                <div class="user-avatar" data-user-initials> data-user-name--</div>
                <div class="user-details"> data-user-name
                    <div class="user-name" data-user-name> data-user-nameLoading...</div>
                    <div class="user-role" data-user-role> data-user-role data-user-nameLoading...</div>
                </div>
            </div>

            <!-- Header Actions -->
            <div class="header-actions">
                <button class="header-btn notifications-btn" onclick="toggleNotificationsPanel()">
                    <span class="btn-icon">ðŸ””</span>
                    <span class="btn-text">Notifications</span>
                    <span class="notification-badge" id="notification-count">3</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notifications-panel">
        <div class="notifications-header">
            <h3>Notifications</h3>
            <div class="notifications-actions">
                <span class="mark-all-read">Mark all as read</span>
                <button class="close-panel" onclick="toggleNotificationsPanel()">Ã—</button>
            </div>
        </div>
        <div class="notifications-content">
            <div class="notifications-list" id="notifications-list">
                <!-- Notifications will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notifications Panel Overlay -->
    <div class="notifications-overlay" id="notifications-overlay" onclick="closeNotificationsPanel()"></div>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="content-area">
            <!-- Referees Management Section -->
            <div class="page-header">
                <div class="page-title-section">
                    <h1 class="content-title">Referee Management</h1>
                    <p class="page-subtitle">Manage referee assignments, availability, and game scheduling</p>
                </div>
                <div class="page-actions">
                    <button class="btn btn-secondary" onclick="exportRefereesData()">
                        <span class="btn-icon">ðŸ“Š</span>
                        <span class="btn-text">Export Data</span>
                    </button>
                    <button class="btn btn-secondary" onclick="openImportRefereesModal()">
                        <span class="btn-icon">ðŸ“¥</span>
                        <span class="btn-text">Import Referees</span>
                    </button>
                    <button class="btn btn-primary" onclick="openAddRefereeModal()"
                            aria-label="Create new referee"
                            title="Add a new referee">
                        <span class="btn-icon icon-create" aria-hidden="true"></span>
                        <span class="btn-text">Add Referee</span>
                    </button>
                </div>
            </div>

            <!-- Referees Overview Cards -->
            <div class="overview-cards">
                <div class="overview-card">
                    <div class="card-content">
                        <div class="card-title">#ï¸âƒ£ Total Referees</div>
                        <div class="card-value" id="totalRefereesCount">0</div>
                    </div>
                </div>
                <div class="overview-card">
                    <div class="card-content">
                        <div class="card-title">âœ… Active Referees</div>
                        <div class="card-value" id="activeRefereesCount">0</div>
                    </div>
                </div>
                <div class="overview-card">
                    <div class="card-content">
                        <div class="card-title">âŒ Inactive Referees</div>
                        <div class="card-value" id="inactiveRefereesCount">0</div>
                    </div>
                </div>
                <div class="overview-card clickable" onclick="openQuickAssignmentModal()">
                    <div class="card-content">
                        <div class="card-title">â— Games To Assign</div>
                        <div class="card-value" id="gamesToAssignCount">0</div>
                    </div>
                </div>
            </div>

            <!-- Referees Management Controls -->
            <div class="management-controls">
                <div class="search-container">
                    <input type="text" id="refereeSearchInput" placeholder="Search referee names..." class="search-input">
                    <span class="search-icon">ðŸ”</span>
                </div>
                <div class="venue-filter-container">
                    <button class="venue-filter-btn" id="venueFilterBtn" onclick="toggleVenueFilter()">
                        <span id="venueFilterText">Filter by venues</span>
                        <span class="venue-filter-icon">â–¼</span>
                    </button>
                    <div class="venue-filter-dropdown" id="venueFilterDropdown">
                        <div class="venue-option-filter" onclick="toggleVenueCheckbox('all', event)">
                            <input type="checkbox" id="venue-all" class="venue-checkbox" checked>
                            <label for="venue-all" class="venue-option-text">All Venues</label>
                        </div>
                        <div class="venue-option-filter" onclick="toggleVenueCheckbox('sports-arena-west', event)">
                            <input type="checkbox" id="venue-sports-arena-west" class="venue-checkbox" checked>
                            <label for="venue-sports-arena-west" class="venue-option-text">Sports Arena West</label>
                        </div>
                        <div class="venue-option-filter" onclick="toggleVenueCheckbox('elite-sports-center', event)">
                            <input type="checkbox" id="venue-elite-sports-center" class="venue-checkbox" checked>
                            <label for="venue-elite-sports-center" class="venue-option-text">Elite Sports Center</label>
                        </div>
                        <div class="venue-option-filter" onclick="toggleVenueCheckbox('premier-league-complex', event)">
                            <input type="checkbox" id="venue-premier-league-complex" class="venue-checkbox" checked>
                            <label for="venue-premier-league-complex" class="venue-option-text">Premier League Complex</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Referees Table -->
            <div class="table-container">
                <div class="table-wrapper">
                    <table class="referees-table">
                        <thead>
                            <tr>
                                <th class="table-header-cell referee-col sortable" onclick="sortTable('referee')" data-sort="referee">
                                    Referee<span class="sort-indicator"></span>
                                </th>
                                <th class="table-header-cell venues-col sortable" onclick="sortTable('venues')" data-sort="venues">
                                    Venues<span class="sort-indicator"></span>
                                </th>
                                <th class="table-header-cell active-col sortable" onclick="sortTable('active')" data-sort="active">
                                    Active<span class="sort-indicator"></span>
                                </th>
                                <th class="table-header-cell schedule-col">Upcoming Schedule</th>
                            </tr>
                        </thead>
                        <tbody id="refereesTableBody">
                            <!-- Referee rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Quick Assignment Modal -->
    <div class="modal-overlay" id="quickAssignmentModalOverlay" onclick="closeQuickAssignmentModal()">
        <div class="modal-container quick-assignment-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">Quick Match Assignment</h2>
                <button class="modal-close-btn" onclick="closeQuickAssignmentModal()">Ã—</button>
            </div>
            
            <div class="modal-content">
                <!-- Date Range Selector -->
                <div class="date-range-selector">
                    <div class="date-range-label">Date Range:</div>
                    <div class="date-range-options">
                        <button class="date-range-btn active" data-weeks="1" onclick="selectDateRange(1)">1 Week</button>
                        <button class="date-range-btn" data-weeks="2" onclick="selectDateRange(2)">2 Weeks</button>
                        <button class="date-range-btn" data-weeks="4" onclick="selectDateRange(4)">4 Weeks</button>
                        <button class="date-range-btn" data-weeks="8" onclick="selectDateRange(8)">8 Weeks</button>
                    </div>
                    <div class="date-range-display" id="dateRangeDisplay">
                        August 2 - August 8, 2025
                    </div>
                </div>

                <!-- Assignment Controls -->
                <div class="assignment-controls">
                    <div class="assignment-stats">
                        <span class="stat-item">
                            <span class="stat-label">Total Fixtures:</span>
                            <span class="stat-value" id="totalFixturesCount">0</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label">Unassigned:</span>
                            <span class="stat-value" id="unassignedFixturesCount">0</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label">Available Referees:</span>
                            <span class="stat-value" id="availableRefereesCount">0</span>
                        </span>
                    </div>
                    <div class="assignment-actions">
                        <button class="btn btn-secondary" onclick="autoAssignAll()">
                            <span class="btn-icon">ðŸŽ¯</span>
                            <span class="btn-text">Auto-Assign All</span>
                        </button>
                        <button class="btn btn-secondary" onclick="clearAllAssignments()">
                            <span class="btn-icon">ðŸ”„</span>
                            <span class="btn-text">Clear All</span>
                        </button>
                    </div>
                </div>

                <!-- Fixtures List -->
                <div class="fixtures-assignment-container">
                    <div class="fixtures-list" id="quickAssignmentFixturesList">
                        <!-- Fixtures will be populated here -->
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeQuickAssignmentModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveAssignments()">
                    <span class="btn-icon">ðŸ’¾</span>
                    <span class="btn-text">Save Assignments</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Referee Details Modal -->
    <div class="modal-overlay" id="refereeDetailsModalOverlay" onclick="closeRefereeDetailsModal()">
        <div class="modal-container referee-details-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">Referee Details</h2>
                <button class="modal-close-btn" onclick="closeRefereeDetailsModal()">Ã—</button>
            </div>
            
            <div class="referee-details-content">
                <!-- Contact Information Section - Full Width -->
                <div class="referee-details-header-section">
                    <div class="referee-details-card">
                        <div class="referee-details-header">
                            <div class="referee-details-avatar" id="detailsAvatar">--</div>
                            <div class="referee-details-basic">
                                <div class="referee-details-name" id="detailsName">Loading...</div>
                                <div class="referee-details-status" id="detailsStatus">
                                    <span class="status-badge status-active">
                                        <span class="status-icon">âœ…</span>
                                        Active
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-title">Contact Information</div>
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value" id="detailsEmail">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Phone</div>
                            <div class="detail-value" id="detailsPhone">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Emergency Contact</div>
                            <div class="detail-value" id="detailsEmergency">--</div>
                        </div>
                    </div>
                </div>

                <!-- Venues Selected Section - Full Width -->
                <div class="referee-details-section">
                    <div class="referee-details-card">
                        <div class="section-title">Venues Selected</div>
                        <div class="detail-item">
                            <div class="referee-venues-grid" id="detailsVenues">
                                <!-- Venue badges will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- This Week's Schedule Section - Full Width -->
                <div class="referee-details-section">
                    <div class="referee-details-card">
                        <div class="section-title">This Week's Schedule</div>
                        <div class="referee-schedule-grid" id="detailsSchedule">
                            <!-- Schedule grid will be populated here -->
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="detailsGamesThisWeek">0</div>
                                <div class="stat-label">Games This Week</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Information Section - Full Width -->
                <div class="referee-details-section">
                    <div class="referee-details-card">
                        <div class="section-title">Additional Information</div>
                        <div class="detail-item">
                            <div class="detail-label">Total Games</div>
                            <div class="detail-value" id="detailsGamesTotal">0</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Joined Date</div>
                            <div class="detail-value" id="detailsJoinedDate">--</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Last Active</div>
                            <div class="detail-value" id="detailsLastActive">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRefereeDetailsModal()">Close</button>
                <div class="modal-footer-actions">
                    <button class="btn btn-primary" onclick="editRefereeFromDetails()">
                        <span class="btn-icon">âœï¸</span>
                        <span class="btn-text">Edit Referee</span>
                    </button>
                    <button class="btn btn-danger" onclick="deleteRefereeFromDetails()">
                        <span class="btn-icon">ðŸ—‘ï¸</span>
                        <span class="btn-text">Delete Referee</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Day Modal -->
    <div class="schedule-day-modal" id="scheduleDayModal" onclick="closeScheduleDayModal(event)">
        <div class="schedule-day-modal-content" onclick="event.stopPropagation()">
            <div class="schedule-day-modal-header">
                <h3 class="schedule-day-modal-title" id="scheduleDayModalTitle">Schedule for Monday, Aug 4</h3>
                <button class="schedule-day-modal-close" onclick="closeScheduleDayModal()">Ã—</button>
            </div>
            <div class="schedule-day-modal-body" id="scheduleDayModalBody">
                <!-- Schedule content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Edit Referee Modal -->
    <div class="modal-overlay" id="editRefereeModalOverlay" onclick="closeEditRefereeModal()">
        <div class="modal-container referee-details-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">Edit Referee</h2>
                <button class="modal-close-btn" onclick="closeEditRefereeModal()">Ã—</button>
            </div>
            
            <div class="modal-content">
                <form id="editRefereeForm">
                    <div class="form-section">
                        <div class="section-title">Basic Information</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editRefereeName" class="form-label">Full Name</label>
                                <input type="text" id="editRefereeName" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editRefereePhone" class="form-label">Phone Number</label>
                                <input type="tel" id="editRefereePhone" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editRefereeEmergency" class="form-label">Emergency Contact</label>
                                <input type="tel" id="editRefereeEmergency" class="form-input" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="section-title">Venues Selected</div>
                        <div class="venues-selection">
                            <div class="venue-checkbox-group">
                                <label class="venue-checkbox-label">
                                    <input type="checkbox" id="editVenueSportsArena" class="venue-checkbox-input" value="Sports Arena West">
                                    <span class="venue-checkbox-text">Sports Arena West</span>
                                </label>
                            </div>
                            <div class="venue-checkbox-group">
                                <label class="venue-checkbox-label">
                                    <input type="checkbox" id="editVenueEliteSports" class="venue-checkbox-input" value="Elite Sports Center">
                                    <span class="venue-checkbox-text">Elite Sports Center</span>
                                </label>
                            </div>
                            <div class="venue-checkbox-group">
                                <label class="venue-checkbox-label">
                                    <input type="checkbox" id="editVenuePremierLeague" class="venue-checkbox-input" value="Premier League Complex">
                                    <span class="venue-checkbox-text">Premier League Complex</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditRefereeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveRefereeChanges()">
                    <span class="btn-icon">ðŸ’¾</span>
                    <span class="btn-text">Save Changes</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteConfirmationModalOverlay" onclick="closeDeleteConfirmationModal()">
        <div class="modal-container" onclick="event.stopPropagation()" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">Delete Referee</h2>
                <button class="modal-close-btn" onclick="closeDeleteConfirmationModal()">Ã—</button>
            </div>
            
            <div class="modal-content" style="padding: 24px;">
                <div class="confirmation-message">
                    <div class="confirmation-icon">âš ï¸</div>
                    <div class="confirmation-text">
                        <p>Are you sure you want to delete referee <strong id="deleteRefereeName">--</strong>?</p>
                        <p>This action will remove the referee from all future assignments.</p>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteConfirmationModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmRefereeDelete()">
                    <span class="btn-icon">ðŸ—‘ï¸</span>
                    <span class="btn-text">Delete Referee</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Final Delete Confirmation Modal -->
    <div class="modal-overlay" id="finalDeleteModalOverlay" onclick="closeFinalDeleteModal()">
        <div class="modal-container" onclick="event.stopPropagation()" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">Final Confirmation</h2>
                <button class="modal-close-btn" onclick="closeFinalDeleteModal()">Ã—</button>
            </div>
            
            <div class="modal-content" style="padding: 24px;">
                <div class="confirmation-message">
                    <div class="confirmation-icon">ðŸš¨</div>
                    <div class="confirmation-text">
                        <p><strong>This action cannot be undone!</strong></p>
                        <p>Referee <strong id="finalDeleteRefereeName">--</strong> will be permanently deleted from the system.</p>
                        <p>All historical data and assignments will be lost.</p>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeFinalDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="finalDeleteReferee()">
                    <span class="btn-icon">âš ï¸</span>
                    <span class="btn-text">Yes, Delete Permanently</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModalOverlay" onclick="closeSuccessModal()">
        <div class="modal-container" onclick="event.stopPropagation()" style="max-width: 450px;">
            <div class="modal-header">
                <h2 class="modal-title">Success</h2>
                <button class="modal-close-btn" onclick="closeSuccessModal()">Ã—</button>
            </div>
            
            <div class="modal-content" style="padding: 24px;">
                <div class="success-message">
                    <div class="success-icon">âœ…</div>
                    <div class="success-text">
                        <p id="successMessageText">Operation completed successfully.</p>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeSuccessModal()">
                    <span class="btn-text">OK</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Invite Referee Modal -->
    <div class="modal-overlay" id="inviteRefereeModalOverlay" onclick="closeInviteRefereeModal()">
        <div class="modal-container" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">Invite New Referee</h2>
                <button class="modal-close-btn" onclick="closeInviteRefereeModal()">Ã—</button>
            </div>
            
            <div class="modal-content" style="padding: 24px;">
                <div class="form-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="inviteRefereeEmail">Referee Email Address</label>
                            <input type="email" 
                                   id="inviteRefereeEmail" 
                                   class="form-input" 
                                   placeholder="Enter referee's email address"
                                   required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="inviteRefereeName">Referee Name (Optional)</label>
                            <input type="text" 
                                   id="inviteRefereeName" 
                                   class="form-input" 
                                   placeholder="Enter referee's full name (optional)">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="inviteMessage">Personal Message (Optional)</label>
                            <textarea id="inviteMessage" 
                                      class="form-input" 
                                      rows="4" 
                                      placeholder="Add a personal message to the invitation (optional)"
                                      style="resize: vertical; min-height: 100px;"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Invitation Preview -->
                <div class="invitation-preview" id="invitationPreview" style="display: none;">
                    <div class="section-title">Invitation Preview</div>
                    <div class="preview-card" style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; margin-top: 16px;">
                        <div class="preview-header" style="margin-bottom: 16px;">
                            <strong>Subject:</strong> <span id="previewSubject"></span>
                        </div>
                        <div class="preview-body">
                            <div id="previewMessage"></div>
                            <div style="margin-top: 16px; padding: 16px; background: white; border-radius: 6px; border: 1px solid #d1d5db;">
                                <strong>Activation Code:</strong> <span id="previewActivationCode" style="font-family: monospace; font-size: 1.1em; color: #2e6417;"></span>
                                <br><br>
                                <strong>Registration Link:</strong> 
                                <div style="word-break: break-all; color: #2e6417; font-size: 0.9em;" id="previewRegistrationLink"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeInviteRefereeModal()">
                    <span class="btn-text">Cancel</span>
                </button>
                <button class="btn btn-secondary" onclick="generateInvitePreview()">
                    <span class="btn-text">Preview Invitation</span>
                </button>
                <button class="btn btn-primary" onclick="sendRefereeInvitation()">
                    <span class="btn-text">Send Invitation</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Dialog elements removed - not needed -->

    <!-- Export Data Modal -->
    <div class="modal-overlay" id="exportDataModalOverlay" onclick="closeExportDataModal()">
        <div class="modal-container export-data-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">Export Referee Data</h2>
                <button class="modal-close-btn" onclick="closeExportDataModal()">Ã—</button>
            </div>
            
            <div class="modal-content export-data-content">
                <!-- Select Venues First -->
                <div class="export-section">
                    <h3 class="export-section-title">Select Venues</h3>
                    <div class="venue-filter-section">
                        <div class="venue-filter-grid" id="exportVenueFilterGrid">
                            <div class="venue-filter-option selected" onclick="toggleExportAllVenues()">
                                <input type="checkbox" class="venue-filter-checkbox" id="export-all-venues" checked>
                                <span class="venue-filter-text all-venues">All Venues</span>
                            </div>
                            <!-- Venue options will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Date Range Selection -->
                <div class="export-section">
                    <div class="monthly-export-header">
                        <h3 class="export-section-title">Select Month</h3>
                        <div class="monthly-export-nav">
                            <button class="monthly-nav-btn" onclick="navigateExportMonths(-6)">
                                <span>â€¹â€¹</span>
                                <span>6 Months</span>
                            </button>
                            <button class="monthly-nav-btn" onclick="navigateExportMonths(-1)">
                                <span>â€¹</span>
                                <span>1 Month</span>
                            </button>
                            <button class="monthly-nav-btn" onclick="navigateExportMonths(1)">
                                <span>1 Month</span>
                                <span>â€º</span>
                            </button>
                            <button class="monthly-nav-btn" onclick="navigateExportMonths(6)">
                                <span>6 Months</span>
                                <span>â€ºâ€º</span>
                            </button>
                        </div>
                    </div>
                    <div class="monthly-export-list" id="monthlyExportList">
                        <!-- Monthly export view will be generated here (display only) -->
                    </div>
                </div>

                <!-- Export Preview -->
                <div class="export-preview" id="exportPreview" style="display: none;">
                    <div class="export-preview-title">Export Preview</div>
                    <div class="export-summary" id="exportSummary">
                        <!-- Summary will be generated here -->
                    </div>
                    
                    <div class="export-format-options">
                        <div class="export-section-title" style="margin-bottom: 12px; border: none; padding: 0;">Export Format:</div>
                        <button class="export-format-btn" onclick="selectExportFormat('csv')" data-format="csv">CSV</button>
                        <button class="export-format-btn" onclick="selectExportFormat('excel')" data-format="excel">Excel</button>
                        <button class="export-format-btn" onclick="selectExportFormat('pdf')" data-format="pdf">PDF</button>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <div class="modal-footer-actions">
                    <button class="btn btn-secondary" onclick="closeExportDataModal()">Cancel</button>
                    <div class="export-btn-container">
                        <button class="btn btn-primary" onclick="performExport()" id="exportBtn" disabled>
                            <span class="btn-icon icon-export"></span>
                            <span class="btn-text">Export Data</span>
                        </button>
                        <div class="export-btn-tooltip" id="exportBtnTooltip">
                            Please select an export format first
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Dynamic Template Scripts -->
    <script src="../../js/core/auth.js"></script>`n    <script src="../../js/core/session-manager.js"></script>
    <script src="../../js/core/session-protection.js"></script>
    <script src="../../js/components/league-manager-sidebar.js?v=<?php echo time(); ?>"></script>
    <script src="../../js/components/league-manager-header.js?v=<?php echo time(); ?>"></script>
    
    <script>
        // Header Template JavaScript Functionality
        // Load user data and update header
        async function loadUserData() {
            try {
                // Check if UserDataManager is available
                if (typeof window.UserDataManager !== 'undefined') {
                    const userData = await window.UserDataManager.load();
                    if (userData && userData.currentUser) {
                        updateUserDisplay(userData.currentUser);
                        return;
                    }
                }
                
                // Try SessionManager if available
                if (typeof window.SessionManager !== 'undefined' && window.SessionManager.isLoggedIn()) {
                    const currentUser = window.SessionManager.getCurrentUser();
                    if (currentUser) {
                        updateUserDisplay(currentUser);
                        return;
                    }
                }
                
                // Fallback: Try to load from localStorage
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    updateUserDisplay(user);
                    return;
                }
                
                // Final fallback: Use session data or default
                const sessionData = localStorage.getItem('sessionData');
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    if (session.user) {
                        updateUserDisplay(session.user);
                        return;
                    }
                }
                
                // Default fallback data
                updateUserDisplay({
                    name: 'League Manager',
                    role: 'Administrator',
                    initials: 'LM'
                });
                
            } catch (error) {
                console.error('Error loading user data in header template:', error);
                updateUserDisplay({
                    name: 'League Manager',
                    role: 'Administrator', 
                    initials: 'LM'
                });
            }
        }
        
        // Update user display elements
        function updateUserDisplay(user) {
            // Update user name
            const userNameElements = document.querySelectorAll('[data-user-name]');
            userNameElements.forEach(element => {
                const displayName = user.fullName || user.name || user.firstName || user.username || 'League Manager';
                element.textContent = displayName;
            });
            
            // Update user role
            const userRoleElements = document.querySelectorAll('[data-user-role]');
            userRoleElements.forEach(element => {
                let displayRole = user.role || user.userRole || user.accountType || 'Administrator';
                if (displayRole === 'league_manager') {
                    displayRole = 'League Manager';
                } else if (displayRole === 'team_manager') {
                    displayRole = 'Team Manager';
                } else if (displayRole === 'referee') {
                    displayRole = 'Referee';
                } else if (displayRole === 'admin') {
                    displayRole = 'Administrator';
                }
                element.textContent = displayRole;
            });
            
            // Update user initials
            const userInitialsElements = document.querySelectorAll('[data-user-initials]');
            userInitialsElements.forEach(element => {
                const nameForInitials = user.fullName || user.name || user.firstName || user.username || 'League Manager';
                const initials = user.initials || generateInitials(nameForInitials);
                element.textContent = initials;
            });
        }
        
        // Generate initials from name
        function generateInitials(name) {
            if (!name) return 'LM';
            if (name.includes('@')) {
                return 'LM';
            }
            const nameParts = name.trim().split(' ');
            if (nameParts.length === 1) {
                return nameParts[0].substring(0, 2).toUpperCase();
            } else {
                return (nameParts[0].charAt(0) + nameParts[nameParts.length - 1].charAt(0)).toUpperCase();
            }
        }
        
        // Simple Notifications System - Placeholder for future implementation
        function toggleNotificationsPanel() {
            console.log('Notifications panel clicked - feature coming soon');
            alert('Notifications feature coming soon!');
        }

        function closeNotificationsPanel() {
            console.log('Close notifications panel');
        }

        function markAllNotificationsRead() {
            console.log('Mark all notifications as read');
        }
    </script>
    
    <script>
        // Global variable to track current week offset
        let currentWeekOffset = 0;
        
        // Data loaded from server based on user permissions`n
        // Mock referee data for table population
        const MOCK_REFEREES_TABLE = [
            {
                id: 'REF001',
                firstName: 'John',
                lastName: 'Smith',
                name: 'John Smith',
                initials: 'JS',
                email: 'john.smith@5ivetrackr.com',
                phone: '+1 (555) 123-4567',
                emergencyContact: '+1 (555) 765-4321',
                lastLogin: '2 hours ago',
                venues: ['Sports Arena West', 'Elite Sports Center'],
                active: true,
                experience: 'Senior',
                certifications: 'FIFA Level 3',
                joinedDate: 'Jan 15, 2024',
                lastActive: 'Today',
                gamesThisWeek: 3,
                totalGames: 87,
                schedule: { 2: 'assigned', 4: 'assigned', 6: 'assigned' }
            },
            {
                id: 'REF002',
                firstName: 'Sarah',
                lastName: 'Johnson',
                name: 'Sarah Johnson',
                initials: 'SJ',
                email: 'sarah.johnson@5ivetrackr.com',
                phone: '+1 (555) 234-5678',
                emergencyContact: '+1 (555) 876-5432',
                lastLogin: '1 day ago',
                venues: ['Premier League Complex'],
                active: true,
                experience: 'Intermediate',
                certifications: 'National Level 2',
                joinedDate: 'Mar 22, 2024',
                lastActive: 'Yesterday',
                gamesThisWeek: 2,
                totalGames: 45,
                schedule: { 3: 'assigned', 7: 'assigned' }
            },
            {
                id: 'REF003',
                firstName: 'Michael',
                lastName: 'Brown',
                name: 'Michael Brown',
                initials: 'MB',
                email: 'michael.brown@5ivetrackr.com',
                phone: '+1 (555) 345-6789',
                emergencyContact: '+1 (555) 987-6543',
                lastLogin: '3 days ago',
                venues: ['Sports Arena West', 'Premier League Complex', 'Elite Sports Center'],
                active: false,
                experience: 'Expert',
                certifications: 'FIFA Level 4',
                joinedDate: 'Oct 8, 2023',
                lastActive: '3 days ago',
                gamesThisWeek: 0,
                totalGames: 156,
                schedule: {}
            },
            {
                id: 'REF004',
                firstName: 'Emma',
                lastName: 'Wilson',
                name: 'Emma Wilson',
                initials: 'EW',
                email: 'emma.wilson@5ivetrackr.com',
                phone: '+1 (555) 456-7890',
                emergencyContact: '+1 (555) 098-7654',
                lastLogin: '5 hours ago',
                venues: ['Elite Sports Center', 'Sports Arena West'],
                active: true,
                experience: 'Senior',
                certifications: 'FIFA Level 3',
                joinedDate: 'Feb 14, 2024',
                lastActive: 'Today',
                gamesThisWeek: 4,
                totalGames: 92,
                schedule: { 2: 'assigned', 3: 'assigned', 5: 'assigned', 7: 'assigned' }
            },
            {
                id: 'REF005',
                firstName: 'David',
                lastName: 'Lee',
                name: 'David Lee',
                initials: 'DL',
                email: 'david.lee@5ivetrackr.com',
                phone: '+1 (555) 567-8901',
                emergencyContact: '+1 (555) 109-8765',
                lastLogin: '1 week ago',
                venues: ['Premier League Complex'],
                active: false,
                experience: 'Beginner',
                certifications: 'Regional Level 1',
                joinedDate: 'Jun 30, 2024',
                lastActive: '1 week ago',
                gamesThisWeek: 0,
                totalGames: 12,
                schedule: {}
            },
            {
                id: 'REF006',
                firstName: 'Lisa',
                lastName: 'Chen',
                name: 'Lisa Chen',
                initials: 'LC',
                email: 'lisa.chen@5ivetrackr.com',
                phone: '+1 (555) 678-9012',
                emergencyContact: '+1 (555) 210-9876',
                lastLogin: '30 minutes ago',
                venues: ['Sports Arena West'],
                active: true,
                experience: 'Intermediate',
                certifications: 'National Level 2',
                joinedDate: 'Apr 12, 2024',
                lastActive: 'Today',
                gamesThisWeek: 2,
                totalGames: 38,
                schedule: { 4: 'assigned', 6: 'assigned' }
            },
            {
                id: 'REF007',
                firstName: 'Mark',
                lastName: 'Davis',
                name: 'Mark Davis',
                initials: 'MD',
                email: 'mark.davis@5ivetrackr.com',
                phone: '+1 (555) 789-0123',
                emergencyContact: '+1 (555) 321-0987',
                lastLogin: '2 days ago',
                venues: ['Elite Sports Center', 'Premier League Complex'],
                active: true,
                experience: 'Senior',
                certifications: 'FIFA Level 3',
                joinedDate: 'Nov 18, 2023',
                lastActive: '2 days ago',
                gamesThisWeek: 1,
                totalGames: 103,
                schedule: { 5: 'assigned' }
            },
            {
                id: 'REF008',
                firstName: 'Anna',
                lastName: 'Garcia',
                name: 'Anna Garcia',
                initials: 'AG',
                email: 'anna.garcia@5ivetrackr.com',
                phone: '+1 (555) 890-1234',
                emergencyContact: '+1 (555) 432-1098',
                lastLogin: '6 hours ago',
                venues: ['Sports Arena West', 'Elite Sports Center', 'Premier League Complex'],
                active: true,
                experience: 'Expert',
                certifications: 'FIFA Level 4',
                joinedDate: 'Sep 5, 2023',
                lastActive: 'Today',
                gamesThisWeek: 5,
                totalGames: 178,
                schedule: { 2: 'assigned', 3: 'assigned', 4: 'assigned', 6: 'assigned', 7: 'assigned' }
            }
        ];

        // Mock fixtures data for assignment - 8 weeks of fixtures
        const MOCK_FIXTURES_DATA = [
            // Week 1 (Aug 2-8, 2025)
            {
                id: 'FIX001',
                date: '2025-08-02',
                time: '14:00',
                homeTeam: 'Arsenal FC',
                awayTeam: 'Chelsea United',
                venue: 'Sports Arena West',
                pitch: 'Pitch 1',
                division: 'Premier Division',
                refereeId: null
            },
            {
                id: 'FIX002',
                date: '2025-08-02',
                time: '16:00',
                homeTeam: 'Liverpool Rovers',
                awayTeam: 'Manchester City',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 2',
                division: 'Premier Division',
                refereeId: null
            },
            {
                id: 'FIX003',
                date: '2025-08-03',
                time: '15:00',
                homeTeam: 'Tottenham Hotspur',
                awayTeam: 'Newcastle United',
                venue: 'Premier League Complex',
                pitch: 'Pitch 1',
                division: 'Championship',
                refereeId: null
            },
            {
                id: 'FIX004',
                date: '2025-08-05',
                time: '17:00',
                homeTeam: 'Leicester City',
                awayTeam: 'West Ham United',
                venue: 'Sports Arena West',
                pitch: 'Pitch 2',
                division: 'Championship',
                refereeId: null
            },
            {
                id: 'FIX005',
                date: '2025-08-07',
                time: '19:00',
                homeTeam: 'Brighton FC',
                awayTeam: 'Crystal Palace',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 1',
                division: 'Premier Division',
                refereeId: null
            },
            
            // Week 2 (Aug 9-15, 2025)
            {
                id: 'FIX006',
                date: '2025-08-09',
                time: '14:30',
                homeTeam: 'Aston Villa',
                awayTeam: 'Wolverhampton',
                venue: 'Premier League Complex',
                pitch: 'Pitch 2',
                division: 'Championship',
                refereeId: null
            },
            {
                id: 'FIX007',
                date: '2025-08-10',
                time: '16:30',
                homeTeam: 'Southampton FC',
                awayTeam: 'Burnley FC',
                venue: 'Sports Arena West',
                pitch: 'Pitch 1',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX008',
                date: '2025-08-12',
                time: '18:00',
                homeTeam: 'Norwich City',
                awayTeam: 'Sheffield United',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 2',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX009',
                date: '2025-08-14',
                time: '20:00',
                homeTeam: 'Everton FC',
                awayTeam: 'Brentford FC',
                venue: 'Premier League Complex',
                pitch: 'Pitch 1',
                division: 'Premier Division',
                refereeId: null
            },
            
            // Week 3 (Aug 16-22, 2025)
            {
                id: 'FIX010',
                date: '2025-08-16',
                time: '15:00',
                homeTeam: 'Fulham FC',
                awayTeam: 'Leeds United',
                venue: 'Sports Arena West',
                pitch: 'Pitch 2',
                division: 'Championship',
                refereeId: null
            },
            {
                id: 'FIX011',
                date: '2025-08-18',
                time: '17:30',
                homeTeam: 'Cardiff City',
                awayTeam: 'Swansea City',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 1',
                division: 'Championship',
                refereeId: null
            },
            {
                id: 'FIX012',
                date: '2025-08-21',
                time: '19:30',
                homeTeam: 'Millwall FC',
                awayTeam: 'Birmingham City',
                venue: 'Premier League Complex',
                pitch: 'Pitch 2',
                division: 'League One',
                refereeId: null
            },
            
            // Week 4 (Aug 23-29, 2025)
            {
                id: 'FIX013',
                date: '2025-08-23',
                time: '14:00',
                homeTeam: 'Blackburn Rovers',
                awayTeam: 'Preston North End',
                venue: 'Sports Arena West',
                pitch: 'Pitch 1',
                division: 'Championship',
                refereeId: null
            },
            {
                id: 'FIX014',
                date: '2025-08-25',
                time: '16:00',
                homeTeam: 'Hull City',
                awayTeam: 'Middlesbrough FC',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 2',
                division: 'Championship',
                refereeId: null
            },
            {
                id: 'FIX015',
                date: '2025-08-28',
                time: '18:30',
                homeTeam: 'Bristol City',
                awayTeam: 'Reading FC',
                venue: 'Premier League Complex',
                pitch: 'Pitch 1',
                division: 'League One',
                refereeId: null
            },
            
            // Week 5 (Aug 30 - Sep 5, 2025)
            {
                id: 'FIX016',
                date: '2025-08-30',
                time: '15:30',
                homeTeam: 'Coventry City',
                awayTeam: 'Rotherham United',
                venue: 'Sports Arena West',
                pitch: 'Pitch 2',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX017',
                date: '2025-09-02',
                time: '17:00',
                homeTeam: 'Stoke City',
                awayTeam: 'Luton Town',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 1',
                division: 'Championship',
                refereeId: null
            },
            {
                id: 'FIX018',
                date: '2025-09-04',
                time: '19:00',
                homeTeam: 'Watford FC',
                awayTeam: 'Queens Park Rangers',
                venue: 'Premier League Complex',
                pitch: 'Pitch 2',
                division: 'Championship',
                refereeId: null
            },
            
            // Week 6 (Sep 6-12, 2025)
            {
                id: 'FIX019',
                date: '2025-09-06',
                time: '14:30',
                homeTeam: 'Huddersfield Town',
                awayTeam: 'Barnsley FC',
                venue: 'Sports Arena West',
                pitch: 'Pitch 1',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX020',
                date: '2025-09-09',
                time: '16:30',
                homeTeam: 'Ipswich Town',
                awayTeam: 'Plymouth Argyle',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 2',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX021',
                date: '2025-09-11',
                time: '18:00',
                homeTeam: 'Derby County',
                awayTeam: 'Charlton Athletic',
                venue: 'Premier League Complex',
                pitch: 'Pitch 1',
                division: 'League One',
                refereeId: null
            },
            
            // Week 7 (Sep 13-19, 2025)
            {
                id: 'FIX022',
                date: '2025-09-13',
                time: '15:00',
                homeTeam: 'Bolton Wanderers',
                awayTeam: 'Wycombe Wanderers',
                venue: 'Sports Arena West',
                pitch: 'Pitch 2',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX023',
                date: '2025-09-16',
                time: '17:30',
                homeTeam: 'Oxford United',
                awayTeam: 'Portsmouth FC',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 1',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX024',
                date: '2025-09-18',
                time: '19:30',
                homeTeam: 'Shrewsbury Town',
                awayTeam: 'Peterborough United',
                venue: 'Premier League Complex',
                pitch: 'Pitch 2',
                division: 'League One',
                refereeId: null
            },
            
            // Week 8 (Sep 20-26, 2025)
            {
                id: 'FIX025',
                date: '2025-09-20',
                time: '14:00',
                homeTeam: 'Exeter City',
                awayTeam: 'Cambridge United',
                venue: 'Sports Arena West',
                pitch: 'Pitch 1',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX026',
                date: '2025-09-23',
                time: '16:00',
                homeTeam: 'Lincoln City',
                awayTeam: 'Fleetwood Town',
                venue: 'Elite Sports Center',
                pitch: 'Pitch 2',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX027',
                date: '2025-09-25',
                time: '18:30',
                homeTeam: 'Cheltenham Town',
                awayTeam: 'Wigan Athletic',
                venue: 'Premier League Complex',
                pitch: 'Pitch 1',
                division: 'League One',
                refereeId: null
            },
            {
                id: 'FIX028',
                date: '2025-09-26',
                time: '20:00',
                homeTeam: 'Doncaster Rovers',
                awayTeam: 'Accrington Stanley',
                venue: 'Sports Arena West',
                pitch: 'Pitch 2',
                division: 'League One',
                refereeId: null
            }
        ];

        // Global variables for Quick Assignment Modal
        let currentDateRange = 1; // weeks
        let modalFixturesData = [...MOCK_FIXTURES_DATA];
        let tempAssignments = {}; // Store temporary assignments

        // Venue Selector JavaScript Functions
        let currentVenueId = null;
        let currentVenueName = null;

        // Data loaded from server based on user permissions`n        const mockVenues = [
            { id: 'VEN001', name: 'Sports Arena West', address: '123 Athletic Avenue' },
            { id: 'VEN002', name: 'Elite Sports Center', address: '456 Championship Drive' },
            { id: 'VEN003', name: 'Premier League Complex', address: '789 Victory Boulevard' }
        ];

        function initializeVenueSelector() {
            console.log('Initializing venue selector for referees page');
            // For referees page: Always display "All Venues" and disable dropdown
            const venueNameElement = document.getElementById('selected-venue-name');
            if (venueNameElement) {
                venueNameElement.textContent = 'All Venues';
            }
            
            // Disable the dropdown button for referees page
            const dropdownBtn = document.getElementById('venue-selector-btn');
            if (dropdownBtn) {
                dropdownBtn.style.pointerEvents = 'none';
                dropdownBtn.style.opacity = '0.7';
                dropdownBtn.style.cursor = 'default';
            }
            
            console.log('Venue selector set to "All Venues" mode for referees page');
        }

        function toggleVenueDropdown() {
            // For referees page: Prevent dropdown from opening
            console.log('Dropdown disabled for referees page - showing all venues');
            return false;
        }

        function closeVenueDropdown() {
            const dropdown = document.getElementById('venue-dropdown');
            const btn = document.getElementById('venue-selector-btn');
            const overlay = document.getElementById('venue-selector-overlay');
            
            console.log('Closing dropdown function called'); // Debug log
            
            if (dropdown) dropdown.classList.remove('show');
            if (btn) btn.classList.remove('active');
            if (overlay) overlay.classList.remove('show');
        }

        function selectVenue(venueId, venueName, venueAddress, event, closeDropdown = true) {
            // Prevent event bubbling to parent button
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            // Update selected venue
            currentVenueId = venueId;
            currentVenueName = venueName;
            
            // Update button text
            document.getElementById('selected-venue-name').textContent = venueName;
            
            // Update option selection states
            document.querySelectorAll('.venue-option').forEach(option => {
                const checkmark = option.querySelector('.venue-option-check');
                if (option.dataset.venueId === venueId) {
                    option.classList.add('selected');
                    checkmark.style.display = 'block';
                } else {
                    option.classList.remove('selected');
                    checkmark.style.display = 'none';
                }
            });
            
            // Close dropdown if requested
            if (closeDropdown) {
                closeVenueDropdown();
            }
            
            // For referees page: Always show all venues/referees (no filtering)
            filterDataByVenue(venueId);
            
            console.log('Venue selector updated to:', venueName, '(ID:', venueId, ') - Showing all referees');
        }

        function filterDataByVenue(venueId) {
            // For referees page, we always show all venues and all referees
            // This function is overridden to not filter data by venue
            console.log('Referees page: Showing all venues and referees regardless of venue selection');
            
            // No filtering applied - show all referees data
            console.log('Displaying all referees data for venue:', venueId);
            
            // Note: The venue selector still functions for UI consistency,
            // but doesn't filter the referees data on this page
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('venue-dropdown');
            const btn = document.getElementById('venue-selector-btn');
            const overlay = document.getElementById('venue-selector-overlay');
            
            if (dropdown && btn && overlay &&
                !dropdown.contains(event.target) && 
                !btn.contains(event.target) &&
                !overlay.contains(event.target)) {
                closeVenueDropdown();
            }
        });

        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize venue selector first
            initializeVenueSelector();
            
            // Load user data for header
            await loadUserData();
            
            // Initialize page functionality
            initializeRefereesPage();
            
            // Listen for sidebar and header events
            initializeSidebarAndHeader();
        });

        function initializeRefereesPage() {
            // Populate the referees table
            populateRefereesTable();
            
            // Initialize search functionality
            initializeSearch();
            
            // Initialize page functionality with correct fixtures count
            updateOverviewCounts();
        }

        // Export and Import functions
        function exportRefereesData() {
            // Open the export modal
            document.getElementById('exportDataModalOverlay').classList.add('show');
            
            // Initialize the modal
            initializeExportModal();
        }

        function openImportRefereesModal() {
            alert('Import feature coming soon!');
        }

        function openAddRefereeModal() {
            // Clear previous data
            document.getElementById('inviteRefereeEmail').value = '';
            document.getElementById('inviteRefereeName').value = '';
            document.getElementById('inviteMessage').value = '';
            document.getElementById('invitationPreview').style.display = 'none';
            
            // Show modal
            document.getElementById('inviteRefereeModalOverlay').classList.add('show');
        }

        function closeInviteRefereeModal() {
            document.getElementById('inviteRefereeModalOverlay').classList.remove('show');
        }

        function generateActivationCode() {
            // Generate a 8-character alphanumeric code
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function generateInvitePreview() {
            const email = document.getElementById('inviteRefereeEmail').value.trim();
            const name = document.getElementById('inviteRefereeName').value.trim();
            const message = document.getElementById('inviteMessage').value.trim();
            
            if (!email) {
                alert('Please enter an email address to generate preview.');
                return;
            }

            // Generate activation code and registration link
            const activationCode = generateActivationCode();
            const baseUrl = 'http://localhost:8081';
            const registrationLink = `${baseUrl}/referee-registration.html?code=${activationCode}&email=${encodeURIComponent(email)}`;
            
            // Populate preview
            const recipientName = name || email;
            document.getElementById('previewSubject').textContent = `5ive Trackr - Referee Invitation for ${recipientName}`;
            
            let previewMessage = `
                <p><strong>Dear ${recipientName},</strong></p>
                <p>You have been invited to join as a referee for 5ive Trackr league management system.</p>
            `;
            
            if (message) {
                previewMessage += `
                    <p><strong>Personal Message:</strong></p>
                    <p style="font-style: italic; color: #6b7280;">"${message}"</p>
                `;
            }
            
            previewMessage += `
                <p>To complete your registration, please use the activation code and registration link provided below.</p>
                <p>If you have any questions, please contact your league manager.</p>
                <p>Best regards,<br>5ive Trackr Team</p>
            `;
            
            document.getElementById('previewMessage').innerHTML = previewMessage;
            document.getElementById('previewActivationCode').textContent = activationCode;
            document.getElementById('previewRegistrationLink').textContent = registrationLink;
            
            // Store the generated data for sending
            window.currentInvitationData = {
                email,
                name,
                message,
                activationCode,
                registrationLink,
                subject: `5ive Trackr - Referee Invitation for ${recipientName}`
            };
            
            // Show preview
            document.getElementById('invitationPreview').style.display = 'block';
        }

        function sendRefereeInvitation() {
            const email = document.getElementById('inviteRefereeEmail').value.trim();
            
            if (!email) {
                alert('Please enter an email address.');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address.');
                return;
            }

            // Generate preview data if not already generated
            if (!window.currentInvitationData) {
                generateInvitePreview();
            }

            // In a real application, this would send the invitation via API
            // For now, we'll simulate the process and show success
            
            // Simulate API call delay
            const sendButton = event.target.closest('button');
            const originalText = sendButton.querySelector('.btn-text').textContent;
            sendButton.disabled = true;
            sendButton.querySelector('.btn-text').textContent = 'Sending...';
            
            setTimeout(() => {
                // Reset button
                sendButton.disabled = false;
                sendButton.querySelector('.btn-text').textContent = originalText;
                
                // Close invite modal
                closeInviteRefereeModal();
                
                // Show success message
                const recipientName = window.currentInvitationData.name || window.currentInvitationData.email;
                showSuccessMessage(`Invitation sent successfully to ${recipientName}! They will receive an email with registration instructions and activation code: ${window.currentInvitationData.activationCode}`);
                
                // Clear stored data
                window.currentInvitationData = null;
                
                // In a real application, you might also want to:
                // 1. Store the pending invitation in the database
                // 2. Send the actual email via email service
                // 3. Set up tracking for when the referee registers
                
            }, 1500);
        }

        function populateRefereesTable(refereesData = null) {
            const tableBody = document.getElementById('refereesTableBody');
            tableBody.innerHTML = '';

            const dataToUse = refereesData || MOCK_REFEREES_TABLE;

            dataToUse.forEach(referee => {
                const row = document.createElement('tr');
                
                // Referee column
                const refereeCell = document.createElement('td');
                refereeCell.innerHTML = `
                    <div class="referee-info" onclick="openRefereeDetails('${referee.id}')" title="Click to view detailed information">
                        <div class="referee-main-info">
                            <div class="referee-avatar">${referee.firstName.charAt(0)}${referee.lastName.charAt(0)}</div>
                            <div class="referee-details">
                                <div class="referee-name">${referee.firstName} ${referee.lastName}</div>
                                <div class="referee-contact">Last login: ${referee.lastLogin}</div>
                            </div>
                        </div>
                    </div>
                `;
                row.appendChild(refereeCell);

                // Venues column
                const venuesCell = document.createElement('td');
                const venuesText = referee.venues.join(' / ');
                venuesCell.innerHTML = `<div class="venues-list">${venuesText}</div>`;
                row.appendChild(venuesCell);

                // Active column
                const activeCell = document.createElement('td');
                const statusIcon = referee.active ? 'âœ…' : 'âŒ';
                activeCell.innerHTML = `<span class="status-icon">${statusIcon}</span>`;
                row.appendChild(activeCell);

                // Schedule column (7-day calendar starting from today)
                const scheduleCell = document.createElement('td');
                const scheduleHtml = generateUpcomingSchedule(referee);
                scheduleCell.innerHTML = `<div class="schedule-calendar">${scheduleHtml}</div>`;
                row.appendChild(scheduleCell);

                tableBody.appendChild(row);
            });

            // Update overview card counts
            updateOverviewCounts();
        }

        function generateUpcomingSchedule(referee) {
            const today = new Date(2025, 7, 2); // August 2, 2025 (month is 0-indexed)
            const scheduleHtml = [];
            
            // Create a consistent pattern based on referee ID for deterministic results
            const refereeNumber = parseInt(referee.id.replace('REF', ''));
            
            for (let i = 0; i < 14; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                const dateNumber = date.getDate();
                const dayLetter = date.toLocaleDateString('en-US', { weekday: 'long' }).charAt(0);
                const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
                const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
                
                // Create consistent assignment pattern based on referee ID and day
                // Inactive referees get no assignments
                let isAssigned = false;
                if (referee.active) {
                    // Use referee number and day index to create consistent patterns
                    const seed = (refereeNumber * 14 + i) % 10;
                    isAssigned = seed < 4; // 40% chance based on deterministic seed
                }
                
                let dayClass = isAssigned ? 'schedule-day assigned' : 'schedule-day available';
                
                // Add current-day class for today (i = 0)
                if (i === 0) {
                    dayClass += ' current-day';
                }
                
                scheduleHtml.push(`<span class="${dayClass}" title="${dayName}, ${dateStr}">
                    <div class="day-number">${dateNumber}</div>
                    <div class="day-letter">${dayLetter}</div>
                </span>`);
            }
            
            return scheduleHtml.join('');
        }

        function getDayName(index) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            return days[index];
        }

        function updateOverviewCounts() {
            const totalReferees = MOCK_REFEREES_TABLE.length;
            const activeReferees = MOCK_REFEREES_TABLE.filter(ref => ref.active).length;
            const inactiveReferees = MOCK_REFEREES_TABLE.filter(ref => !ref.active).length;
            // Calculate unassigned fixtures in the current date range
            const unassignedFixtures = getUnassignedFixturesInRange();
            const gamesToAssign = unassignedFixtures.length;

            document.getElementById('totalRefereesCount').textContent = totalReferees;
            document.getElementById('activeRefereesCount').textContent = activeReferees;
            document.getElementById('inactiveRefereesCount').textContent = inactiveReferees;
            document.getElementById('gamesToAssignCount').textContent = gamesToAssign;
        }

        // Quick Assignment Modal Functions
        function openQuickAssignmentModal() {
            const modal = document.getElementById('quickAssignmentModalOverlay');
            modal.classList.add('show');
            
            // Initialize modal with current data
            updateModalDateRange();
            updateModalFixturesList();
            updateModalStats();
        }

        function closeQuickAssignmentModal() {
            const modal = document.getElementById('quickAssignmentModalOverlay');
            modal.classList.remove('show');
            
            // Reset temporary assignments
            tempAssignments = {};
        }

        function selectDateRange(weeks) {
            currentDateRange = weeks;
            
            // Update button states
            document.querySelectorAll('.date-range-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-weeks="${weeks}"]`).classList.add('active');
            
            // Update display and data
            updateModalDateRange();
            updateModalFixturesList();
            updateModalStats();
        }

        function updateModalDateRange() {
            const today = new Date(2025, 7, 2); // August 2, 2025
            const endDate = new Date(today);
            endDate.setDate(today.getDate() + (currentDateRange * 7) - 1);
            
            const options = { month: 'long', day: 'numeric', year: 'numeric' };
            const startStr = today.toLocaleDateString('en-US', options);
            const endStr = endDate.toLocaleDateString('en-US', options);
            
            document.getElementById('dateRangeDisplay').textContent = `${startStr} - ${endStr}`;
        }

        function getUnassignedFixturesInRange() {
            const today = new Date(2025, 7, 2); // August 2, 2025
            const endDate = new Date(today);
            endDate.setDate(today.getDate() + (currentDateRange * 7));
            
            return modalFixturesData.filter(fixture => {
                const fixtureDate = new Date(fixture.date);
                return fixtureDate >= today && fixtureDate < endDate && 
                       !fixture.refereeId && !tempAssignments[fixture.id];
            });
        }

        function getAllFixturesInRange() {
            const today = new Date(2025, 7, 2); // August 2, 2025
            const endDate = new Date(today);
            endDate.setDate(today.getDate() + (currentDateRange * 7));
            
            return modalFixturesData.filter(fixture => {
                const fixtureDate = new Date(fixture.date);
                return fixtureDate >= today && fixtureDate < endDate;
            });
        }

        function updateModalFixturesList() {
            const fixturesList = document.getElementById('quickAssignmentFixturesList');
            const allFixtures = getAllFixturesInRange();
            
            if (allFixtures.length === 0) {
                fixturesList.innerHTML = `
                    <div class="fixtures-empty-state">
                        <div class="fixtures-empty-state-icon">ðŸ“…</div>
                        <div class="fixtures-empty-state-title">No Fixtures Found</div>
                        <div class="fixtures-empty-state-text">There are no fixtures in the selected date range.</div>
                    </div>
                `;
                return;
            }
            
            // Group fixtures by date
            const fixturesByDate = {};
            allFixtures.forEach(fixture => {
                if (!fixturesByDate[fixture.date]) {
                    fixturesByDate[fixture.date] = [];
                }
                fixturesByDate[fixture.date].push(fixture);
            });
            
            let html = '';
            Object.keys(fixturesByDate).sort().forEach(date => {
                const dateObj = new Date(date);
                const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'long' });
                const dateDisplay = dateObj.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
                
                html += `
                    <div class="fixture-day-group">
                        <div class="fixture-day-header">
                            ${dayName}, ${dateDisplay}
                        </div>
                `;
                
                fixturesByDate[date].forEach(fixture => {
                    const assignedRefereeId = fixture.refereeId || tempAssignments[fixture.id];
                    const isAssigned = !!assignedRefereeId;
                    const refereeOptions = generateRefereeOptions(fixture, assignedRefereeId);
                    
                    html += `
                        <div class="fixture-assignment-row">
                            <div class="fixture-info">
                                <div class="fixture-teams">${fixture.homeTeam} vs ${fixture.awayTeam}</div>
                                <div class="fixture-details">${fixture.venue} - ${fixture.pitch} | ${fixture.division}</div>
                            </div>
                            <div class="fixture-time">${fixture.time}</div>
                            <div class="referee-assignment">
                                <select class="referee-assignment-select" onchange="updateTempAssignment('${fixture.id}', this.value)">
                                    ${refereeOptions}
                                </select>
                            </div>
                            <div class="assignment-status ${isAssigned ? 'assigned' : 'unassigned'}">
                                <span class="assignment-status-icon">${isAssigned ? 'âœ…' : 'âŒ'}</span>
                                <span>${isAssigned ? 'Assigned' : 'Unassigned'}</span>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });
            
            fixturesList.innerHTML = html;
        }

        function generateRefereeOptions(fixture, selectedRefereeId) {
            let options = '<option value="">Select Referee...</option>';
            
            // Get available referees for this venue
            const availableReferees = MOCK_REFEREES_TABLE.filter(referee => {
                return referee.active && referee.venues.includes(fixture.venue);
            });
            
            availableReferees.forEach(referee => {
                const selected = referee.id === selectedRefereeId ? 'selected' : '';
                options += `<option value="${referee.id}" ${selected}>${referee.firstName} ${referee.lastName}</option>`;
            });
            
            return options;
        }

        function updateTempAssignment(fixtureId, refereeId) {
            if (refereeId) {
                tempAssignments[fixtureId] = refereeId;
            } else {
                delete tempAssignments[fixtureId];
            }
            
            // Update stats
            updateModalStats();
            
            // Update the assignment status for this row
            const row = event.target.closest('.fixture-assignment-row');
            const statusElement = row.querySelector('.assignment-status');
            const isAssigned = !!refereeId;
            
            statusElement.className = `assignment-status ${isAssigned ? 'assigned' : 'unassigned'}`;
            statusElement.innerHTML = `
                <span class="assignment-status-icon">${isAssigned ? 'âœ…' : 'âŒ'}</span>
                <span>${isAssigned ? 'Assigned' : 'Unassigned'}</span>
            `;
        }

        function updateModalStats() {
            const allFixtures = getAllFixturesInRange();
            const unassignedFixtures = getUnassignedFixturesInRange();
            const activeReferees = MOCK_REFEREES_TABLE.filter(ref => ref.active).length;
            
            document.getElementById('totalFixturesCount').textContent = allFixtures.length;
            document.getElementById('unassignedFixturesCount').textContent = unassignedFixtures.length;
            document.getElementById('availableRefereesCount').textContent = activeReferees;
        }

        function autoAssignAll() {
            const unassignedFixtures = getUnassignedFixturesInRange();
            const activeReferees = MOCK_REFEREES_TABLE.filter(ref => ref.active);
            
            if (activeReferees.length === 0) {
                alert('No active referees available for assignment.');
                return;
            }
            
            let refereeIndex = 0;
            unassignedFixtures.forEach(fixture => {
                // Find referees who can work at this venue
                const suitableReferees = activeReferees.filter(ref => 
                    ref.venues.includes(fixture.venue)
                );
                
                if (suitableReferees.length > 0) {
                    const referee = suitableReferees[refereeIndex % suitableReferees.length];
                    tempAssignments[fixture.id] = referee.id;
                    refereeIndex++;
                }
            });
            
            // Refresh the fixtures list and stats
            updateModalFixturesList();
            updateModalStats();
        }

        function clearAllAssignments() {
            tempAssignments = {};
            
            // Also clear any existing assignments in the date range
            const allFixtures = getAllFixturesInRange();
            allFixtures.forEach(fixture => {
                fixture.refereeId = null;
            });
            
            // Refresh the fixtures list and stats
            updateModalFixturesList();
            updateModalStats();
        }

        function saveAssignments() {
            // Apply temporary assignments to the main data
            Object.keys(tempAssignments).forEach(fixtureId => {
                const fixture = modalFixturesData.find(f => f.id === fixtureId);
                if (fixture) {
                    fixture.refereeId = tempAssignments[fixtureId];
                }
            });
            
            // Update the main page overview counts
            updateOverviewCounts();
            
            // Show success message
            alert(`Successfully assigned ${Object.keys(tempAssignments).length} fixtures to referees.`);
            
            // Close modal
            closeQuickAssignmentModal();
        }

        function initializeSearch() {
            const searchInput = document.getElementById('refereeSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(function(e) {
                    currentSearchTerm = e.target.value.toLowerCase();
                    applyFilters();
                }, 300));
            }
        }

        // Utility function for debouncing
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Global filter state
        let currentSearchTerm = '';
        let selectedVenues = new Set(['Sports Arena West', 'Elite Sports Center', 'Premier League Complex']);
        
        // Sorting state
        let currentSort = {
            column: null,
            direction: null // 'asc' or 'desc'
        };

        // Table sorting functionality
        function sortTable(column) {
            // Determine sort direction
            if (currentSort.column === column) {
                // Toggle direction if same column
                if (currentSort.direction === 'asc') {
                    currentSort.direction = 'desc';
                } else if (currentSort.direction === 'desc') {
                    currentSort.direction = 'asc';
                } else {
                    currentSort.direction = 'asc';
                }
            } else {
                // New column, start with ascending
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            // Update header visual indicators
            updateSortIndicators();

            // Apply filters (which will also apply sorting)
            applyFilters();
        }

        function updateSortIndicators() {
            // Clear all sort classes
            document.querySelectorAll('.table-header-cell').forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });

            // Add sort class to current column
            if (currentSort.column && currentSort.direction) {
                const currentHeader = document.querySelector(`[data-sort="${currentSort.column}"]`);
                if (currentHeader) {
                    currentHeader.classList.add(`sort-${currentSort.direction}`);
                }
            }
        }

        function filterReferees(searchTerm) {
            currentSearchTerm = searchTerm.toLowerCase();
            applyFilters();
        }

        function applyFilters() {
            // Get filtered data first
            let filteredData = MOCK_REFEREES_TABLE.filter(referee => {
                // Search term filter
                const nameMatch = currentSearchTerm === '' || 
                    `${referee.firstName} ${referee.lastName}`.toLowerCase().includes(currentSearchTerm);
                
                // Venue filter
                const venueMatch = selectedVenues.size === 0 || 
                    referee.venues.some(venue => selectedVenues.has(venue));
                
                return nameMatch && venueMatch;
            });

            // Apply sorting if active
            if (currentSort.column && currentSort.direction) {
                filteredData = getSortedReferees(filteredData);
            }

            // Repopulate table with filtered and sorted data
            populateRefereesTable(filteredData);
        }

        // Updated getSortedReferees to accept optional data parameter
        function getSortedReferees(dataToSort = null) {
            let sortedReferees = [...(dataToSort || MOCK_REFEREES_TABLE)];

            if (!currentSort.column || !currentSort.direction) {
                return sortedReferees;
            }

            sortedReferees.sort((a, b) => {
                let valueA, valueB;

                switch (currentSort.column) {
                    case 'referee':
                        valueA = `${a.firstName} ${a.lastName}`.toLowerCase();
                        valueB = `${b.firstName} ${b.lastName}`.toLowerCase();
                        break;
                    case 'venues':
                        valueA = a.venues.join(', ').toLowerCase();
                        valueB = b.venues.join(', ').toLowerCase();
                        break;
                    case 'active':
                        // For active column: true = 1, false = 0 (active first when ascending)
                        valueA = a.active ? 1 : 0;
                        valueB = b.active ? 1 : 0;
                        break;
                    default:
                        return 0;
                }

                // Handle comparison
                let comparison = 0;
                if (valueA > valueB) {
                    comparison = 1;
                } else if (valueA < valueB) {
                    comparison = -1;
                }

                // Apply sort direction
                return currentSort.direction === 'desc' ? comparison * -1 : comparison;
            });

            return sortedReferees;
        }

        // Venue filter functions
        function toggleVenueFilter() {
            const dropdown = document.getElementById('venueFilterDropdown');
            const btn = document.getElementById('venueFilterBtn');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                btn.classList.remove('active');
            } else {
                dropdown.classList.add('show');
                btn.classList.add('active');
            }
        }

        function toggleVenueCheckbox(venueId, event) {
            event.stopPropagation();
            
            const checkbox = document.getElementById(`venue-${venueId}`);
            const isChecked = !checkbox.checked;
            checkbox.checked = isChecked;
            
            if (venueId === 'all') {
                // Handle "All Venues" checkbox
                const allCheckboxes = document.querySelectorAll('.venue-checkbox');
                allCheckboxes.forEach(cb => cb.checked = isChecked);
                
                if (isChecked) {
                    selectedVenues = new Set(['Sports Arena West', 'Elite Sports Center', 'Premier League Complex']);
                } else {
                    selectedVenues.clear();
                }
            } else {
                // Handle individual venue checkbox
                const venueMap = {
                    'sports-arena-west': 'Sports Arena West',
                    'elite-sports-center': 'Elite Sports Center',
                    'premier-league-complex': 'Premier League Complex'
                };
                
                const venueName = venueMap[venueId];
                if (isChecked) {
                    selectedVenues.add(venueName);
                } else {
                    selectedVenues.delete(venueName);
                    // Uncheck "All" if any individual venue is unchecked
                    document.getElementById('venue-all').checked = false;
                }
                
                // Check "All" if all individual venues are selected
                if (selectedVenues.size === 3) {
                    document.getElementById('venue-all').checked = true;
                }
            }
            
            updateVenueFilterText();
            applyFilters();
        }

        function updateVenueFilterText() {
            const filterText = document.getElementById('venueFilterText');
            if (selectedVenues.size === 0) {
                filterText.textContent = 'No venues selected';
            } else if (selectedVenues.size === 3) {
                filterText.textContent = 'All venues';
            } else {
                filterText.textContent = `${selectedVenues.size} venue${selectedVenues.size > 1 ? 's' : ''} selected`;
            }
        }

        // Close venue filter when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('venueFilterDropdown');
            const btn = document.getElementById('venueFilterBtn');
            
            if (dropdown && btn && 
                !dropdown.contains(event.target) && 
                !btn.contains(event.target)) {
                dropdown.classList.remove('show');
                btn.classList.remove('active');
            }
        });

        function initializeCalendarHeader() {
            
            // Initialize the referee rows with calendar
            initializeRefereeRows();
            
            // Initialize search functionality
            initializeSearch();
            
            // Initialize add referee button
            initializeButtons();
        }

        function initializeCalendarHeader() {
            const header = document.querySelector('.table-header');
            
            // Clear existing content
            header.innerHTML = '';
            
            // Add referee info header
            const refHeader = document.createElement('div');
            refHeader.className = 'table-cell referee-info';
            refHeader.style.textAlign = 'center';
            refHeader.style.fontWeight = '600';
            refHeader.textContent = 'Referee';
            header.appendChild(refHeader);
            
            // Add actions header
            const actionsHeader = document.createElement('div');
            actionsHeader.className = 'table-cell';
            actionsHeader.style.textAlign = 'center';
            actionsHeader.style.fontWeight = '600';
            actionsHeader.textContent = 'Actions';
            header.appendChild(actionsHeader);
            
            // Add "Upcoming schedule" header with navigation arrows spanning all 7 days
            const scheduleHeaderContainer = document.createElement('div');
            scheduleHeaderContainer.className = 'schedule-header-with-nav';
            
            // Previous week button
            const prevButton = document.createElement('div');
            prevButton.className = 'nav-button-small';
            prevButton.innerHTML = 'â†';
            prevButton.title = 'Previous week';
            prevButton.onclick = () => navigateWeek(-1);
            
            // Schedule text
            const scheduleText = document.createElement('span');
            scheduleText.style.fontWeight = '600';
            scheduleText.style.fontSize = '0.875rem';
            scheduleText.textContent = 'Upcoming schedule';
            
            // Next week button
            const nextButton = document.createElement('div');
            nextButton.className = 'nav-button-small';
            nextButton.innerHTML = 'â†’';
            nextButton.title = 'Next week';
            nextButton.onclick = () => navigateWeek(1);
            
            scheduleHeaderContainer.appendChild(prevButton);
            scheduleHeaderContainer.appendChild(scheduleText);
            scheduleHeaderContainer.appendChild(nextButton);
            header.appendChild(scheduleHeaderContainer);
        }

        function initializeRefereeRows() {
            const tableBody = document.querySelector('.table-body');
            
            // Clear existing content
            tableBody.innerHTML = '';
            
            MOCK_REFEREES.forEach(referee => {
                const row = document.createElement('div');
                row.className = 'referee-row';
                
                // Add referee info cell
                const refereeInfoCell = document.createElement('div');
                refereeInfoCell.className = 'referee-info-cell';
                refereeInfoCell.innerHTML = `
                    <div class="referee-avatar">${referee.initials}</div>
                    <div class="referee-details">
                        <div class="referee-name">${referee.name}</div>
                    </div>
                `;
                row.appendChild(refereeInfoCell);
                
                // Add actions cell
                const actionsCell = document.createElement('div');
                actionsCell.className = 'actions-cell';
                actionsCell.innerHTML = `
                    <button class="action-btn edit" onclick="editReferee('${referee.id}')" title="Edit referee">
                        âœï¸ Edit
                    </button>
                    <button class="action-btn delete" onclick="deleteReferee('${referee.id}')" title="Delete referee">
                        ðŸ—‘ï¸ Del
                    </button>
                `;
                row.appendChild(actionsCell);
                
                // Add calendar cells - now as a single schedule column containing all 7 days
                const scheduleColumn = document.createElement('div');
                scheduleColumn.className = 'schedule-column';
                
                const today = new Date();
                for (let i = 0; i < 7; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i + (currentWeekOffset * 7));
                    const dateStr = date.toISOString().split('T')[0];
                    const dayAbbrev = date.toLocaleDateString('en-US', { weekday: 'short' }).charAt(0);
                    
                    const game = MOCK_GAMES.find(g => g.date === dateStr && g.refereeId === referee.id);
                    const availableGame = MOCK_GAMES.find(g => g.date === dateStr && !g.refereeId);
                    
                    const cell = document.createElement('div');
                    cell.className = 'game-cell';
                    
                    if (game) {
                        cell.classList.add('assigned');
                        cell.innerHTML = `
                            <div class="date-number">${date.getDate()}</div>
                            <div class="day-letter">${dayAbbrev}</div>
                            <div class="game-details">
                                <div class="game-time">${game.time}</div>
                                <div class="game-teams">${game.teams}</div>
                                <div class="game-venue">${game.venue}</div>
                            </div>
                        `;
                    } else if (availableGame) {
                        cell.classList.add('available');
                        cell.innerHTML = `
                            <div class="date-number">${date.getDate()}</div>
                            <div class="day-letter">${dayAbbrev}</div>
                            <div class="game-details">
                                <div class="game-time">${availableGame.time}</div>
                                <div class="game-teams">${availableGame.teams}</div>
                                <div class="game-venue">${availableGame.venue}</div>
                            </div>
                        `;
                        cell.onclick = () => assignGame(availableGame.id, referee.id);
                    } else {
                        cell.innerHTML = `
                            <div class="date-number">${date.getDate()}</div>
                            <div class="day-letter">${dayAbbrev}</div>
                        `;
                    }
                    
                    scheduleColumn.appendChild(cell);
                }
                
                // Add the schedule column to the row
                row.appendChild(scheduleColumn);
                
                tableBody.appendChild(row);
            });
        }

        function initializeSearch() {
            const searchInput = document.querySelector('.search-input');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(function(e) {
                    applyFilters();
                }, 300));
            }
            
            // Initialize preferred days filter checkboxes
            const dayCheckboxes = document.querySelectorAll('.day-checkbox input[type="checkbox"]');
            dayCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', applyFilters);
            });
        }

        function applyFilters() {
            const searchTerm = document.querySelector('.search-input').value.toLowerCase();
            const checkedDays = Array.from(document.querySelectorAll('.day-checkbox input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            const rows = document.querySelectorAll('.referee-row');
            
            rows.forEach(row => {
                const name = row.querySelector('.referee-name').textContent.toLowerCase();
                const nameMatches = name.includes(searchTerm);
                
                // Check preferred days if any are selected
                let daysMatch = true;
                if (checkedDays.length > 0) {
                    const refereeDays = Array.from(row.querySelectorAll('.day-tag:not(.not-preferred)'))
                        .map(tag => tag.textContent);
                    daysMatch = checkedDays.some(day => refereeDays.includes(day));
                }
                
                row.style.display = (nameMatches && daysMatch) ? 'grid' : 'none';
            });
        }

        function initializeButtons() {
            // Initialize add referee button
            const addButton = document.querySelector('#add-referee');
            if (addButton) {
                addButton.addEventListener('click', () => {
                    alert('Add Referee feature coming soon!');
                });
            }
            
            // Initialize assign fixtures button
            const assignButton = document.querySelector('#assign-fixtures');
            if (assignButton) {
                assignButton.addEventListener('click', openFixturesDialog);
            }
        }

        function updateFixtureCountIndicators() {
            // Get all fixture count indicators
            const indicators = document.querySelectorAll('.fixtures-count-indicator[data-day]');
            
            indicators.forEach(indicator => {
                const dateStr = indicator.getAttribute('data-day');
                
                // Count unassigned fixtures for this day
                const unassignedFixtures = MOCK_GAMES.filter(game => 
                    game.date === dateStr && !game.refereeId
                );
                
                const fixturesCount = unassignedFixtures.length;
                
                // Reset classes
                indicator.classList.remove('complete', 'empty');
                
                if (fixturesCount === 0) {
                    indicator.classList.add('complete');
                    indicator.textContent = 'Complete';
                } else {
                    indicator.textContent = `${fixturesCount} to assign`;
                }
            });
        }

        function toggleDaySection(dateStr) {
            const dayContent = document.querySelector(`.day-group-content[data-day="${dateStr}"]`);
            const toggleBtn = document.querySelector(`.day-toggle-btn[data-day="${dateStr}"]`);
            
            if (dayContent && toggleBtn) {
                if (dayContent.classList.contains('collapsed')) {
                    // Expand
                    dayContent.classList.remove('collapsed');
                    toggleBtn.innerHTML = 'âˆ’'; // Minimize button
                } else {
                    // Collapse
                    dayContent.classList.add('collapsed');
                    toggleBtn.innerHTML = '+'; // Expand button
                }
            }
        }

        function openFixturesDialog() {
            const overlay = document.getElementById('fixtures-dialog-overlay');
            const fixturesList = document.getElementById('unassigned-fixtures-list');
            
            // Get unassigned fixtures
            const unassignedFixtures = MOCK_GAMES.filter(game => !game.refereeId);
            
            // Clear existing content
            fixturesList.innerHTML = '';
            
            // Generate next 7 days
            const today = new Date();
            const next7Days = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                next7Days.push(date);
            }
            
            // Define pitches
            const pitches = ['Court 1', 'Court 2', 'Court 3'];
            
            // Group fixtures by day
            next7Days.forEach(date => {
                const dateStr = date.toISOString().split('T')[0];
                const dayFixtures = unassignedFixtures.filter(fixture => fixture.date === dateStr);
                
                // Create day group
                const dayGroup = document.createElement('div');
                dayGroup.className = 'day-group';
                
                // Day header
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-group-header';
                const formattedDay = date.toLocaleDateString('en-US', {
                    weekday: 'long',
                    month: 'long',
                    day: 'numeric'
                });
                
                // Create header content container (left side - just title)
                const dayHeaderContent = document.createElement('div');
                dayHeaderContent.className = 'day-header-content';
                
                // Day title
                const dayTitle = document.createElement('span');
                dayTitle.className = 'day-title';
                dayTitle.textContent = formattedDay;
                dayHeaderContent.appendChild(dayTitle);
                
                // Create right side container for indicator and toggle button
                const dayHeaderRight = document.createElement('div');
                dayHeaderRight.className = 'day-header-right';
                
                // Fixtures count indicator
                const fixturesCount = dayFixtures.length;
                const fixturesIndicator = document.createElement('span');
                fixturesIndicator.className = 'fixtures-count-indicator';
                fixturesIndicator.setAttribute('data-day', dateStr);
                
                if (fixturesCount === 0) {
                    fixturesIndicator.classList.add('complete');
                    fixturesIndicator.textContent = 'Complete';
                } else {
                    fixturesIndicator.textContent = `${fixturesCount} to assign`;
                }
                
                // Toggle button
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'day-toggle-btn';
                toggleBtn.innerHTML = '+'; // Start collapsed (expand button)
                toggleBtn.setAttribute('data-day', dateStr);
                toggleBtn.onclick = () => toggleDaySection(dateStr);
                
                dayHeaderRight.appendChild(fixturesIndicator);
                dayHeaderRight.appendChild(toggleBtn);
                
                dayHeader.appendChild(dayHeaderContent);
                dayHeader.appendChild(dayHeaderRight);
                dayGroup.appendChild(dayHeader);
                
                // Day content (start collapsed)
                const dayContent = document.createElement('div');
                dayContent.className = 'day-group-content collapsed';
                dayContent.setAttribute('data-day', dateStr);
                
                // Create pitch sections within each day
                pitches.forEach(pitch => {
                    const pitchFixtures = dayFixtures.filter(fixture => fixture.venue === pitch);
                    
                    // Create pitch section
                    const pitchSection = document.createElement('div');
                    pitchSection.className = 'pitch-section';
                    
                    // Pitch header
                    const pitchHeader = document.createElement('div');
                    pitchHeader.className = 'pitch-header';
                    pitchHeader.textContent = pitch;
                    pitchSection.appendChild(pitchHeader);
                    
                    // Pitch fixtures container
                    const pitchFixturesContainer = document.createElement('div');
                    pitchFixturesContainer.className = 'pitch-fixtures';
                    
                    if (pitchFixtures.length === 0) {
                        // No fixtures for this pitch
                        const noFixtures = document.createElement('div');
                        noFixtures.className = 'no-fixtures-pitch';
                        noFixtures.textContent = 'No unassigned fixtures';
                        pitchFixturesContainer.appendChild(noFixtures);
                    } else {
                        // Add fixtures for this pitch
                        pitchFixtures.forEach(fixture => {
                            const fixtureItem = document.createElement('div');
                            fixtureItem.className = 'fixture-item';
                            
                            fixtureItem.innerHTML = `
                                <div class="fixture-details">
                                    <div class="fixture-teams">${fixture.teams}</div>
                                    <div class="fixture-meta">
                                        <span>ðŸ• ${fixture.time}</span>
                                    </div>
                                </div>
                                <div class="fixture-assignment">
                                    <button class="select-referee-btn" data-fixture-id="${fixture.id}" onclick="openRefereeSelectionDialog('${fixture.id}')">
                                        <span class="selected-referee-text">Select Referee</span>
                                    </button>
                                    <button class="assign-btn" onclick="assignFixtureToReferee('${fixture.id}')" disabled>Assign</button>
                                </div>
                            `;
                            
                            pitchFixturesContainer.appendChild(fixtureItem);
                        });
                    }
                    
                    pitchSection.appendChild(pitchFixturesContainer);
                    
                    // Add pitch-level buttons (only if there are fixtures for this pitch)
                    if (pitchFixtures.length > 0) {
                        const pitchActions = document.createElement('div');
                        pitchActions.className = 'pitch-actions';
                        pitchActions.innerHTML = `
                            <button class="select-referee-btn" data-pitch="${pitch}" data-date="${dateStr}" onclick="openRefereeSelectionDialog('${pitch}-${dateStr}')">
                                <span class="selected-referee-text">Select Referee</span>
                            </button>
                            <button class="assign-btn pitch-assign-all-btn" onclick="assignAllFixturesToReferee('${pitch}', '${dateStr}')" disabled>Assign to All</button>
                        `;
                        pitchSection.appendChild(pitchActions);
                    }
                    
                    dayContent.appendChild(pitchSection);
                });
                
                dayGroup.appendChild(dayContent);
                fixturesList.appendChild(dayGroup);
            });
            
            overlay.classList.add('active');
            
            // Update fixture count indicators after dialog is populated
            updateFixtureCountIndicators();
        }

        function closeFixturesDialog() {
            const overlay = document.getElementById('fixtures-dialog-overlay');
            overlay.classList.remove('active');
        }

        function assignFixtureToReferee(fixtureId) {
            const button = document.querySelector(`button[data-fixture-id="${fixtureId}"]`);
            const selectedRefereeId = button.getAttribute('data-selected-referee');
            
            if (!selectedRefereeId) {
                alert('Please select a referee first.');
                return;
            }
            
            // Find the fixture and referee
            const fixture = MOCK_GAMES.find(g => g.id === fixtureId);
            const referee = MOCK_REFEREES.find(r => r.id === selectedRefereeId);
            
            if (fixture && referee) {
                // Assign the referee to the fixture
                fixture.refereeId = selectedRefereeId;
                
                // Show success message
                alert(`Fixture "${fixture.teams}" has been assigned to ${referee.name}.`);
                
                // Update fixture count indicators
                updateFixtureCountIndicators();
                
                // Refresh the dialog and table
                openFixturesDialog();
                initializeRefereeRows();
            }
        }

        function assignAllFixturesToReferee(pitch, dateStr) {
            const pitchButton = document.querySelector(`button[data-pitch="${pitch}"][data-date="${dateStr}"]`);
            const selectedRefereeId = pitchButton.getAttribute('data-selected-referee');
            
            if (!selectedRefereeId) {
                alert('Please select a referee first.');
                return;
            }
            
            // Find all unassigned fixtures for this pitch and date
            const fixturesToAssign = MOCK_GAMES.filter(game => 
                game.date === dateStr && 
                game.venue === pitch && 
                !game.refereeId
            );
            
            if (fixturesToAssign.length === 0) {
                alert('No unassigned fixtures found for this pitch.');
                return;
            }
            
            // Find the referee
            const referee = MOCK_REFEREES.find(r => r.id === selectedRefereeId);
            
            if (referee) {
                // Assign the referee to all fixtures
                fixturesToAssign.forEach(fixture => {
                    fixture.refereeId = selectedRefereeId;
                });
                
                // Show success message
                const fixtureCount = fixturesToAssign.length;
                alert(`${fixtureCount} fixture${fixtureCount > 1 ? 's' : ''} on ${pitch} have been assigned to ${referee.name}.`);
                
                // Update fixture count indicators
                updateFixtureCountIndicators();
                
                // Refresh the dialog and table
                openFixturesDialog();
                initializeRefereeRows();
            }
        }

        // Global variables for referee selection
        let currentFixtureId = null;
        let currentPitchData = null; // For pitch-level assignments
        let selectedRefereeId = null;

        function openRefereeSelectionDialog(identifier) {
            selectedRefereeId = null;
            
            // Check if this is a pitch-level selection (contains a dash)
            if (identifier.includes('-')) {
                // This is a pitch-level selection
                const [pitch, dateStr] = identifier.split('-');
                currentPitchData = { pitch, dateStr };
                currentFixtureId = null;
            } else {
                // This is an individual fixture selection
                currentFixtureId = identifier;
                currentPitchData = null;
            }
            
            const dialog = document.getElementById('referee-selection-dialog');
            const confirmBtn = document.getElementById('confirm-referee-btn');
            const searchInput = document.getElementById('referee-search');
            
            // Reset search
            searchInput.value = '';
            
            // Populate referee list
            populateRefereeList();
            
            // Reset confirm button
            confirmBtn.disabled = true;
            
            // Show dialog
            dialog.classList.add('active');
        }

        function closeRefereeSelectionDialog() {
            const dialog = document.getElementById('referee-selection-dialog');
            dialog.classList.remove('active');
            currentFixtureId = null;
            currentPitchData = null;
            selectedRefereeId = null;
        }

        function populateRefereeList(searchTerm = '') {
            const refereeList = document.getElementById('referee-list');
            refereeList.innerHTML = '';
            
            const filteredReferees = MOCK_REFEREES.filter(referee => 
                referee.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            filteredReferees.forEach(referee => {
                const refereeOption = document.createElement('div');
                refereeOption.className = 'referee-option';
                refereeOption.setAttribute('data-referee-id', referee.id);
                refereeOption.onclick = () => selectReferee(referee.id);
                
                refereeOption.innerHTML = `
                    <div class="referee-option-avatar">${referee.initials}</div>
                    <div class="referee-option-details">
                        <div class="referee-option-name">${referee.name}</div>
                        <div class="referee-option-days">Preferred: ${referee.preferredDays.join(', ')}</div>
                    </div>
                `;
                
                refereeList.appendChild(refereeOption);
            });
        }

        function selectReferee(refereeId) {
            selectedRefereeId = refereeId;
            
            // Update visual selection
            const options = document.querySelectorAll('.referee-option');
            options.forEach(option => {
                option.classList.remove('selected');
                if (option.getAttribute('data-referee-id') === refereeId) {
                    option.classList.add('selected');
                }
            });
            
            // Enable confirm button
            const confirmBtn = document.getElementById('confirm-referee-btn');
            confirmBtn.disabled = false;
        }

        function confirmRefereeSelection() {
            if (!selectedRefereeId) return;
            
            const referee = MOCK_REFEREES.find(r => r.id === selectedRefereeId);
            if (!referee) return;
            
            if (currentFixtureId) {
                // Handle individual fixture selection
                const button = document.querySelector(`button[data-fixture-id="${currentFixtureId}"]`);
                const assignBtn = button.parentNode.querySelector('.assign-btn');
                
                if (button) {
                    // Update button text and styling
                    const textSpan = button.querySelector('.selected-referee-text');
                    textSpan.textContent = referee.name;
                    button.classList.add('selected');
                    button.setAttribute('data-selected-referee', selectedRefereeId);
                    
                    // Enable assign button
                    assignBtn.disabled = false;
                }
            } else if (currentPitchData) {
                // Handle pitch-level selection
                const { pitch, dateStr } = currentPitchData;
                const button = document.querySelector(`button[data-pitch="${pitch}"][data-date="${dateStr}"]`);
                const assignBtn = button.parentNode.querySelector('.pitch-assign-all-btn');
                
                if (button) {
                    // Update button text and styling
                    const textSpan = button.querySelector('.selected-referee-text');
                    textSpan.textContent = referee.name;
                    button.classList.add('selected');
                    button.setAttribute('data-selected-referee', selectedRefereeId);
                    
                    // Enable assign to all button
                    assignBtn.disabled = false;
                }
            }
            
            closeRefereeSelectionDialog();
        }

        // Add search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('referee-search');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    populateRefereeList(e.target.value);
                });
            }
        });

        // Close dialog when clicking overlay
        document.addEventListener('click', function(e) {
            if (e.target.id === 'fixtures-dialog-overlay') {
                closeFixturesDialog();
            }
            if (e.target.id === 'referee-selection-dialog') {
                closeRefereeSelectionDialog();
            }
        });

        function assignGame(gameId, refereeId) {
            // This would normally make an API call
            alert(`Assigning game ${gameId} to referee ${refereeId}`);
        }

        // Open referee details modal
        function openRefereeDetails(refereeId) {
            // Find referee data from table mock data
            const referee = MOCK_REFEREES_TABLE.find(r => r.id === refereeId);
            if (!referee) {
                console.error('Referee not found:', refereeId);
                return;
            }

            // Populate modal with referee data
            populateRefereeDetailsModal(referee);
            
            // Show modal
            const modal = document.getElementById('refereeDetailsModalOverlay');
            modal.classList.add('show');
        }

        // Close referee details modal
        function closeRefereeDetailsModal() {
            const modal = document.getElementById('refereeDetailsModalOverlay');
            modal.classList.remove('show');
        }

        // Populate referee details modal
        function populateRefereeDetailsModal(referee) {
            // Store referee ID for edit/delete functions
            document.getElementById('detailsName').setAttribute('data-referee-id', referee.id);
            
            // Basic information
            document.getElementById('detailsAvatar').textContent = referee.initials;
            document.getElementById('detailsName').textContent = referee.name;
            document.getElementById('detailsEmail').textContent = referee.email;
            document.getElementById('detailsPhone').textContent = referee.phone;
            document.getElementById('detailsEmergency').textContent = referee.emergencyContact || 'Not provided';

            // Status
            const statusElement = document.getElementById('detailsStatus');
            statusElement.innerHTML = referee.active 
                ? '<span class="status-badge status-active"><span class="status-icon">âœ…</span> Active</span>'
                : '<span class="status-badge status-inactive"><span class="status-icon">âŒ</span> Inactive</span>';

            // Venues
            const venuesContainer = document.getElementById('detailsVenues');
            venuesContainer.innerHTML = referee.venues.map(venue => 
                `<div class="referee-venue-badge">${venue}</div>`
            ).join('');

            // Schedule
            const scheduleContainer = document.getElementById('detailsSchedule');
            scheduleContainer.innerHTML = generateScheduleGrid(referee);

            // Stats
            document.getElementById('detailsGamesThisWeek').textContent = referee.gamesThisWeek || '0';
            document.getElementById('detailsGamesTotal').textContent = referee.totalGames || '0';
            document.getElementById('detailsJoinedDate').textContent = referee.joinedDate || 'Jan 15, 2024';
            document.getElementById('detailsLastActive').textContent = referee.lastActive || 'Today';
        }

        // Edit referee from details modal
        function editRefereeFromDetails() {
            // Get the current referee data
            const currentRefereeId = document.getElementById('detailsName').getAttribute('data-referee-id');
            const referee = MOCK_REFEREES_TABLE.find(r => r.id === currentRefereeId);
            
            if (!referee) {
                alert('Referee data not found');
                return;
            }
            
            // Populate the edit form with current data
            document.getElementById('editRefereeName').value = referee.name;
            document.getElementById('editRefereePhone').value = referee.phone;
            document.getElementById('editRefereeEmergency').value = referee.emergencyContact;
            
            // Set venue checkboxes
            document.getElementById('editVenueSportsArena').checked = referee.venues.includes('Sports Arena West');
            document.getElementById('editVenueEliteSports').checked = referee.venues.includes('Elite Sports Center');
            document.getElementById('editVenuePremierLeague').checked = referee.venues.includes('Premier League Complex');
            
            // Close details modal and open edit modal
            closeRefereeDetailsModal();
            document.getElementById('editRefereeModalOverlay').classList.add('show');
        }

        // Close edit referee modal
        function closeEditRefereeModal() {
            document.getElementById('editRefereeModalOverlay').classList.remove('show');
        }

        // Save referee changes
        function saveRefereeChanges() {
            const currentRefereeId = document.getElementById('detailsName').getAttribute('data-referee-id');
            const refereeIndex = MOCK_REFEREES_TABLE.findIndex(r => r.id === currentRefereeId);
            
            if (refereeIndex === -1) {
                alert('Referee not found');
                return;
            }
            
            // Get form data
            const name = document.getElementById('editRefereeName').value.trim();
            const phone = document.getElementById('editRefereePhone').value.trim();
            const emergency = document.getElementById('editRefereeEmergency').value.trim();
            
            // Validate required fields
            if (!name || !phone || !emergency) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Get selected venues
            const venues = [];
            if (document.getElementById('editVenueSportsArena').checked) venues.push('Sports Arena West');
            if (document.getElementById('editVenueEliteSports').checked) venues.push('Elite Sports Center');
            if (document.getElementById('editVenuePremierLeague').checked) venues.push('Premier League Complex');
            
            if (venues.length === 0) {
                alert('Please select at least one venue');
                return;
            }
            
            // Update referee data
            MOCK_REFEREES_TABLE[refereeIndex].name = name;
            MOCK_REFEREES_TABLE[refereeIndex].phone = phone;
            MOCK_REFEREES_TABLE[refereeIndex].emergencyContact = emergency;
            MOCK_REFEREES_TABLE[refereeIndex].venues = venues;
            
            // Update name parts if needed
            const nameParts = name.split(' ');
            MOCK_REFEREES_TABLE[refereeIndex].firstName = nameParts[0];
            MOCK_REFEREES_TABLE[refereeIndex].lastName = nameParts.slice(1).join(' ');
            
            // Close edit modal
            closeEditRefereeModal();
            
            // Refresh the table to show updated data
            populateRefereesTable();
            
            // Show professional success dialog
            showSuccessMessage('Referee information has been updated successfully!');
        }

        // Delete referee from details modal
        function deleteRefereeFromDetails() {
            const currentRefereeId = document.getElementById('detailsName').getAttribute('data-referee-id');
            const referee = MOCK_REFEREES_TABLE.find(r => r.id === currentRefereeId);
            
            if (!referee) {
                alert('Referee data not found');
                return;
            }
            
            // Set referee name in confirmation modal
            document.getElementById('deleteRefereeName').textContent = referee.name;
            
            // Close details modal and open delete confirmation modal
            closeRefereeDetailsModal();
            document.getElementById('deleteConfirmationModalOverlay').classList.add('show');
        }

        // Close delete confirmation modal
        function closeDeleteConfirmationModal() {
            document.getElementById('deleteConfirmationModalOverlay').classList.remove('show');
        }

        // Confirm referee delete (first confirmation)
        function confirmRefereeDelete() {
            const refereeName = document.getElementById('deleteRefereeName').textContent;
            
            // Set referee name in final confirmation modal
            document.getElementById('finalDeleteRefereeName').textContent = refereeName;
            
            // Close first modal and open final confirmation modal
            closeDeleteConfirmationModal();
            document.getElementById('finalDeleteModalOverlay').classList.add('show');
        }

        // Close final delete modal
        function closeFinalDeleteModal() {
            document.getElementById('finalDeleteModalOverlay').classList.remove('show');
        }

        // Final delete referee
        function finalDeleteReferee() {
            const currentRefereeId = document.getElementById('detailsName').getAttribute('data-referee-id');
            const refereeIndex = MOCK_REFEREES_TABLE.findIndex(r => r.id === currentRefereeId);
            
            if (refereeIndex === -1) {
                showSuccessMessage('Error: Referee not found');
                return;
            }
            
            const refereeName = MOCK_REFEREES_TABLE[refereeIndex].name;
            
            // Remove referee from the array
            MOCK_REFEREES_TABLE.splice(refereeIndex, 1);
            
            // Close final modal
            closeFinalDeleteModal();
            
            // Refresh the table to remove the deleted referee
            populateRefereesTable();
            
            // Show professional success dialog
            showSuccessMessage(`Referee ${refereeName} has been permanently deleted from the system.`);
        }

        // Show success modal with custom message
        function showSuccessMessage(message) {
            document.getElementById('successMessageText').textContent = message;
            document.getElementById('successModalOverlay').classList.add('show');
        }

        // Close success modal
        function closeSuccessModal() {
            document.getElementById('successModalOverlay').classList.remove('show');
        }

        // Navigation functions for week scrolling
        function navigateWeek(direction) {
            currentWeekOffset += direction;
            
            // Reinitialize the calendar and referee rows with new week
            initializeCalendarHeader();
            initializeRefereeRows();
        }

        // Utility function: Debounce
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function initializeSidebarAndHeader() {
            document.addEventListener('sidebarLoaded', function(e) {
                if (window.leagueManagerSidebar) {
                    setTimeout(() => {
                        window.leagueManagerSidebar.setActive('referees');
                    }, 100);
                }
            });
            
            document.addEventListener('headerLoaded', function(e) {
                if (window.leagueManagerHeader) {
                    setTimeout(() => {
                        window.leagueManagerHeader.updatePageTitle('referees');
                    }, 100);
                }
            });
        }

        // Toggle notifications panel
        function toggleNotificationsPanel() {
            const panel = document.getElementById('notifications-panel');
            const overlay = document.getElementById('notifications-overlay');
            
            if (panel && overlay) {
                panel.classList.toggle('active');
                overlay.classList.toggle('active');
            }
        }

        // Referee Details Modal Functions
        // Schedule Day Functions
        function openScheduleDayModal(refereeId, dayNumber, dayName, date) {
            const modal = document.getElementById('scheduleDayModal');
            const title = document.getElementById('scheduleDayModalTitle');
            const body = document.getElementById('scheduleDayModalBody');
            
            // Set modal title
            title.textContent = `Schedule for ${dayName}, ${date}`;
            
            // Get fixtures for this day
            const fixtures = getFixturesForDay(refereeId, dayNumber);
            
            // Populate modal body
            if (fixtures && fixtures.length > 0) {
                body.innerHTML = fixtures.map(fixture => `
                    <div class="schedule-day-fixture">
                        <div class="fixture-header">
                            <div class="fixture-time-large">${fixture.time}</div>
                            <div class="fixture-status ${fixture.status}">${fixture.status.charAt(0).toUpperCase() + fixture.status.slice(1)}</div>
                        </div>
                        <div class="fixture-teams-large">${fixture.teams}</div>
                        <div class="fixture-details">
                            <span>${fixture.venue}</span>
                            <span>${fixture.division}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                body.innerHTML = `
                    <div class="no-fixtures-day">
                        <p>No fixtures assigned for this day.</p>
                    </div>
                `;
            }
            
            modal.classList.add('show');
        }

        function closeScheduleDayModal(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('scheduleDayModal');
            modal.classList.remove('show');
        }

        function getFixturesForDay(refereeId, dayNumber) {
            // Mock fixture data - in production this would come from API
            const mockFixtures = {
                'REF001': {
                    2: [
                        {
                            time: '10:00 AM',
                            teams: 'Thunder FC vs Lightning United',
                            venue: 'Sports Arena West - Pitch 1',
                            division: 'Premier Division',
                            status: 'confirmed'
                        }
                    ],
                    4: [
                        {
                            time: '2:00 PM',
                            teams: 'Storm Rangers vs Rapid Fire',
                            venue: 'Elite Sports Center - Pitch 2',
                            division: 'Championship Division',
                            status: 'confirmed'
                        },
                        {
                            time: '4:30 PM',
                            teams: 'Eagle Wings vs Phoenix Rising',
                            venue: 'Elite Sports Center - Pitch 1',
                            division: 'Premier Division',
                            status: 'pending'
                        }
                    ],
                    6: [
                        {
                            time: '11:00 AM',
                            teams: 'Victory Bulls vs Champion Lions',
                            venue: 'Premier League Complex - Main Pitch',
                            division: 'Premier Division',
                            status: 'confirmed'
                        }
                    ]
                },
                'REF002': {
                    3: [
                        {
                            time: '1:00 PM',
                            teams: 'Striker Force vs Goal Getters',
                            venue: 'Premier League Complex - Pitch 2',
                            division: 'Division 1',
                            status: 'confirmed'
                        }
                    ],
                    7: [
                        {
                            time: '9:00 AM',
                            teams: 'Field Masters vs Turf Tigers',
                            venue: 'Premier League Complex - Main Pitch',
                            division: 'Championship Division',
                            status: 'confirmed'
                        }
                    ]
                },
                'REF004': {
                    1: [
                        {
                            time: '3:00 PM',
                            teams: 'Swift Kicks vs Power Play',
                            venue: 'Elite Sports Center - Pitch 1',
                            division: 'Premier Division',
                            status: 'confirmed'
                        }
                    ],
                    5: [
                        {
                            time: '12:00 PM',
                            teams: 'Net Breakers vs Score Seekers',
                            venue: 'Sports Arena West - Pitch 2',
                            division: 'Division 1',
                            status: 'pending'
                        }
                    ]
                }
            };
            
            return mockFixtures[refereeId] && mockFixtures[refereeId][dayNumber] 
                ? mockFixtures[refereeId][dayNumber] 
                : [];
        }

        function generateScheduleGrid(referee) {
            const today = new Date();
            const currentDay = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const currentDate = today.getDate();
            
            let html = '';
            
            // Generate 7 days of the week
            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(today);
                dayDate.setDate(today.getDate() + i);
                const dayNumber = dayDate.getDate();
                const dayName = dayDate.toLocaleDateString('en-US', { weekday: 'short' });
                const fullDate = dayDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                const fixtures = getFixturesForDay(referee.id, i + 1);
                const hasFixtures = fixtures && fixtures.length > 0;
                const isCurrentDay = i === 0; // First day is current day
                
                html += `
                    <div class="schedule-day-detail ${hasFixtures ? 'assigned' : 'available'} ${isCurrentDay ? 'current-day' : ''}" 
                         onclick="openScheduleDayModal('${referee.id}', ${i + 1}, '${dayName}', '${fullDate}')">
                        <div class="day-number">${dayNumber}</div>
                        <div class="day-letter">${dayName}</div>
                        
                        <div class="schedule-hover-window">
                            <div class="schedule-hover-header">${dayName}, ${fullDate}</div>
                            ${hasFixtures ? 
                                fixtures.map(fixture => `
                                    <div class="schedule-fixture-item">
                                        <div class="fixture-time">${fixture.time}</div>
                                        <div class="fixture-teams">${fixture.teams}</div>
                                        <div class="fixture-venue">${fixture.venue}</div>
                                    </div>
                                `).join('') :
                                '<div class="no-fixtures-message">No fixtures assigned</div>'
                            }
                        </div>
                    </div>
                `;
            }
            
            return html;
        }

        // Export Modal Functions
        let exportCurrentMonth = new Date(2025, 7, 1); // August 2025 (start view)
        let exportSelectedMonthVenues = new Map(); // Map of "month-venue" keys to selection status
        let exportSelectedVenues = new Set(['Sports Arena West', 'Elite Sports Center', 'Premier League Complex']);
        let exportSelectedDataTypes = new Set(['days-worked', 'matches-officiated']); // Both types are now mandatory
        let exportSelectedMonths = new Set(); // Set of selected month keys (e.g., "2025-08")

        // Data loaded from server based on user permissions`n        const PREVIOUSLY_EXPORTED_MONTHS = new Map([
            ['2025-07-Sports Arena West', true],
            ['2025-07-Elite Sports Center', false],
            ['2025-06-Premier League Complex', true],
            ['2025-06-Sports Arena West', true],
            ['2025-05-Elite Sports Center', true]
        ]);

        // Available venues
        const EXPORT_VENUES = [
            'Sports Arena West',
            'Elite Sports Center', 
            'Premier League Complex'
        ];

        function initializeExportModal() {
            // Reset venue selections (monthly selections no longer needed)
            exportSelectedVenues = new Set(['Sports Arena West', 'Elite Sports Center', 'Premier League Complex']);
            
            // Reset month selections
            exportSelectedMonths.clear();
            
            // Initialize monthly view (display only)
            generateMonthlyExportView();
            
            // Initialize venue filters
            generateExportVenueFilters();
            
            // Update displays
            updateExportButton();
            hideExportPreview();
        }

        function closeExportDataModal() {
            document.getElementById('exportDataModalOverlay').classList.remove('show');
        }

        function navigateExportMonths(monthsToMove) {
            exportCurrentMonth.setMonth(exportCurrentMonth.getMonth() + monthsToMove);
            generateMonthlyExportView();
        }

        function generateMonthlyExportView() {
            const container = document.getElementById('monthlyExportList');
            
            // Generate 6 months starting from current view month
            let html = '';
            for (let i = 0; i < 6; i++) {
                const month = new Date(exportCurrentMonth.getFullYear(), exportCurrentMonth.getMonth() + i, 1);
                const monthKey = `${month.getFullYear()}-${String(month.getMonth() + 1).padStart(2, '0')}`;
                const monthName = month.toLocaleDateString('en-US', { month: 'long' });
                const year = month.getFullYear();
                const isSelected = exportSelectedMonths.has(monthKey);
                
                html += `
                    <div class="month-row">
                        <div class="month-label ${isSelected ? 'selected' : ''}" onclick="toggleMonthSelection('${monthKey}')">
                            <div class="month-label-content">
                                <div class="month-name">${monthName}</div>
                                <div class="month-year">${year}</div>
                            </div>
                        </div>
                        <div class="venues-export-list">
                `;
                
                // Generate venue items for this month (non-selectable, display only)
                EXPORT_VENUES.forEach(venue => {
                    const key = `${monthKey}-${venue}`;
                    const previouslyExported = PREVIOUSLY_EXPORTED_MONTHS.get(key);
                    const isVenueSelected = exportSelectedVenues.has(venue);
                    const isHighlighted = isSelected && isVenueSelected;
                    
                    let statusClass = 'not-exported';
                    let statusText = 'Not Exported';
                    let statusIcon = 'â—‹';
                    
                    if (previouslyExported === true) {
                        statusClass = 'exported';
                        statusText = 'Previously Exported';
                        statusIcon = 'âœ“';
                    } else if (previouslyExported === false) {
                        statusClass = 'partial';
                        statusText = 'Partial Export';
                        statusIcon = 'â—';
                    }
                    
                    html += `
                        <div class="venue-export-item ${isHighlighted ? 'highlighted' : ''}">
                            <div class="venue-export-name">${venue}</div>
                            <div class="venue-export-status">
                                <div class="export-status-indicator ${statusClass}">${statusIcon}</div>
                                <div class="export-status-text ${statusClass}">${statusText}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // Note: toggleMonthVenueSelection removed - venues are no longer selectable within monthly sections
        // Selection is now handled through the venue filter at the top

        function clearExportSelection() {
            // Clear venue selections at the top level
            exportSelectedVenues.clear();
            const allOptions = document.querySelectorAll('#exportVenueFilterGrid .venue-filter-option');
            allOptions.forEach(opt => {
                opt.classList.remove('selected');
                const cb = opt.querySelector('.venue-filter-checkbox');
                if (cb) cb.checked = false;
            });
            
            // Clear month selections
            exportSelectedMonths.clear();
            
            // Regenerate monthly view to update selections
            generateMonthlyExportView();
            
            updateExportButton();
            updateExportPreview();
        }

        function toggleMonthSelection(monthKey) {
            if (exportSelectedMonths.has(monthKey)) {
                exportSelectedMonths.delete(monthKey);
            } else {
                exportSelectedMonths.add(monthKey);
            }
            
            // Regenerate the monthly view to update selection states and venue highlighting
            generateMonthlyExportView();
            
            // Update export button and preview
            updateExportButton();
            updateExportPreview();
        }

        // Note: updateSelectedMonthsDisplay removed - no longer selecting individual months
                const [year, month] = monthKey.split('-');
        // Note: updateSelectedMonthsDisplay removed - no longer selecting individual months

        function selectExportDate(dateStr) {
            if (!exportStartDate || (exportStartDate && exportEndDate)) {
                // Start new selection
                exportStartDate = dateStr;
                exportEndDate = null;
            } else if (dateStr === exportStartDate) {
                // Clicking same date, clear selection
                exportStartDate = null;
                exportEndDate = null;
            } else if (dateStr < exportStartDate) {
                // Selected date is before start, make it the new start
                exportEndDate = exportStartDate;
                exportStartDate = dateStr;
            } else {
                // Selected date is after start, make it the end
                exportEndDate = dateStr;
            }
            
            generateExportCalendar();
            updateExportDateDisplay();
            updateExportButton();
            updateExportPreview();
        }

        function updateExportDateDisplay() {
            const startElement = document.getElementById('exportStartDateValue');
            const endElement = document.getElementById('exportEndDateValue');
            
            startElement.textContent = exportStartDate ? 
                new Date(exportStartDate).toLocaleDateString('en-US', { 
                    month: 'short', day: 'numeric', year: 'numeric' 
                }) : 'Not selected';
                
            endElement.textContent = exportEndDate ? 
                new Date(exportEndDate).toLocaleDateString('en-US', { 
                    month: 'short', day: 'numeric', year: 'numeric' 
                }) : 'Not selected';
        }

        function generateExportVenueFilters() {
            const grid = document.getElementById('exportVenueFilterGrid');
            const allVenuesOption = grid.querySelector('.venue-filter-option');
            
            // Clear existing venue options (keep "All Venues")
            const existingOptions = grid.querySelectorAll('.venue-filter-option:not(:first-child)');
            existingOptions.forEach(option => option.remove());
            
            // Add individual venue options
            const venues = ['Sports Arena West', 'Elite Sports Center', 'Premier League Complex'];
            venues.forEach(venue => {
                const option = document.createElement('div');
                option.className = 'venue-filter-option selected';
                option.onclick = () => toggleExportVenue(venue);
                
                option.innerHTML = `
                    <input type="checkbox" class="venue-filter-checkbox" id="export-venue-${venue.replace(/\s+/g, '-').toLowerCase()}" checked>
                    <span class="venue-filter-text">${venue}</span>
                `;
                
                grid.appendChild(option);
            });
        }

        function toggleExportAllVenues() {
            const checkbox = document.getElementById('export-all-venues');
            const option = checkbox.closest('.venue-filter-option');
            const allOptions = document.querySelectorAll('#exportVenueFilterGrid .venue-filter-option');
            
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                // Select all venues
                exportSelectedVenues = new Set(['Sports Arena West', 'Elite Sports Center', 'Premier League Complex']);
                allOptions.forEach(opt => {
                    opt.classList.add('selected');
                    const cb = opt.querySelector('.venue-filter-checkbox');
                    if (cb) cb.checked = true;
                });
            } else {
                // Deselect all venues
                exportSelectedVenues.clear();
                allOptions.forEach(opt => {
                    opt.classList.remove('selected');
                    const cb = opt.querySelector('.venue-filter-checkbox');
                    if (cb) cb.checked = false;
                });
            }
            
            // Regenerate monthly view to update venue highlighting
            generateMonthlyExportView();
            
            updateExportButton();
            updateExportPreview();
        }

        function toggleExportVenue(venue) {
            const checkbox = document.getElementById(`export-venue-${venue.replace(/\s+/g, '-').toLowerCase()}`);
            const option = checkbox.closest('.venue-filter-option');
            const allVenuesCheckbox = document.getElementById('export-all-venues');
            
            checkbox.checked = !checkbox.checked;
            
            if (checkbox.checked) {
                exportSelectedVenues.add(venue);
                option.classList.add('selected');
                
                // Check if all venues are now selected
                if (exportSelectedVenues.size === 3) {
                    allVenuesCheckbox.checked = true;
                    allVenuesCheckbox.closest('.venue-filter-option').classList.add('selected');
                }
            } else {
                exportSelectedVenues.delete(venue);
                option.classList.remove('selected');
                
                // Uncheck "All Venues" if any individual venue is unchecked
                allVenuesCheckbox.checked = false;
                allVenuesCheckbox.closest('.venue-filter-option').classList.remove('selected');
            }
            
            // Regenerate monthly view to update venue highlighting
            generateMonthlyExportView();
            
            updateExportButton();
            updateExportPreview();
        }

        function updateExportButton() {
            const button = document.getElementById('exportBtn');
            const tooltip = document.getElementById('exportBtnTooltip');
            const hasVenues = exportSelectedVenues.size > 0;
            const hasMonths = exportSelectedMonths.size > 0;
            const hasFormat = document.querySelector('.export-format-btn.selected') !== null;
            
            // Enable export only if venue, month, and format are all selected
            const shouldEnable = hasVenues && hasMonths && hasFormat;
            
            button.disabled = !shouldEnable;
            
            // Update visual disabled state
            if (shouldEnable) {
                button.classList.remove('disabled');
            } else {
                button.classList.add('disabled');
            }
            
            // Update tooltip text based on what's missing
            if (!hasFormat && (hasVenues && hasMonths)) {
                tooltip.textContent = 'Please select an export format first';
            } else if (!hasVenues && !hasMonths) {
                tooltip.textContent = 'Please select venues and months first';
            } else if (!hasVenues) {
                tooltip.textContent = 'Please select venues first';
            } else if (!hasMonths) {
                tooltip.textContent = 'Please select months first';
            } else {
                tooltip.textContent = 'Please select an export format first';
            }
        }

        function updateExportPreview() {
            const hasVenues = exportSelectedVenues.size > 0;
            const hasMonths = exportSelectedMonths.size > 0;
            
            if (hasVenues && hasMonths) {
                showExportPreview();
            } else {
                hideExportPreview();
            }
        }

        function showExportPreview() {
            const preview = document.getElementById('exportPreview');
            const summaryContainer = document.getElementById('exportSummary');
            
            // Calculate preview data based on selected months and selected venues
            const totalMonths = exportSelectedMonths.size;
            const selectedVenueNames = Array.from(exportSelectedVenues);
            
            const totalReferees = MOCK_REFEREES_TABLE.filter(ref => 
                ref.venues.some(venue => selectedVenueNames.includes(venue))
            ).length;
            
            let summaryHTML = `
                <div class="export-summary-item">
                    <div class="export-summary-number">${totalMonths}</div>
                    <div class="export-summary-label">Months Selected</div>
                </div>
                <div class="export-summary-item">
                    <div class="export-summary-number">${totalMonths * exportSelectedVenues.size}</div>
                    <div class="export-summary-label">Month-Venue Combinations</div>
                </div>
                <div class="export-summary-item">
                    <div class="export-summary-number">${totalReferees}</div>
                    <div class="export-summary-label">Referees Included</div>
                </div>
                <div class="export-summary-item">
                    <div class="export-summary-number">${exportSelectedVenues.size}</div>
                    <div class="export-summary-label">Venues Selected</div>
                </div>
            `;
            
            summaryContainer.innerHTML = summaryHTML;
            preview.style.display = 'block';
        }

        function hideExportPreview() {
            document.getElementById('exportPreview').style.display = 'none';
        }

        function selectExportFormat(format) {
            // Update button states
            document.querySelectorAll('.export-format-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.getAttribute('data-format') === format) {
                    btn.classList.add('selected');
                }
            });
            
            // Update the export button state
            updateExportButton();
        }

        function performExport() {
            try {
                console.log('performExport called'); // Debug log
                
                const selectedFormat = document.querySelector('.export-format-btn.selected').getAttribute('data-format');
                const dataTypes = Array.from(exportSelectedDataTypes);
                const venues = Array.from(exportSelectedVenues);
                const selectedMonths = Array.from(exportSelectedMonths);
                
                console.log('Selected format:', selectedFormat);
                console.log('Selected months:', selectedMonths);
                console.log('Selected venues:', venues);
                
                // Validate selections
                if (selectedMonths.length === 0) {
                    alert('Please select at least one month to export.');
                    return;
                }
                
                if (venues.length === 0) {
                    alert('Please select at least one venue to export.');
                    return;
                }
                
                // Show loading state
                const button = document.getElementById('exportBtn');
                const btnText = button.querySelector('.btn-text');
                const originalText = btnText.textContent;
                button.disabled = true;
                btnText.textContent = 'Exporting...';
                
                // Simulate export process
                setTimeout(() => {
                    try {
                        // Generate filename based on selected months
                        const monthsText = selectedMonths.length === 1 ? 
                            selectedMonths[0] : 
                            `${selectedMonths[0]}_to_${selectedMonths[selectedMonths.length - 1]}`;
                        
                        const timestamp = new Date().toISOString().slice(0, 16).replace(/[-:T]/g, '');
                        const filename = `referee-data-${monthsText}-${timestamp}.${selectedFormat}`;
                        
                        // Create export data for selected months and venues only
                        const exportData = generateSelectedMonthsExportData(dataTypes, venues, selectedMonths);
                        
                        // In a real application, this would download the file
                        downloadExportFile(exportData, filename, selectedFormat);
                        
                        // Store this export in previously exported month-venue combinations
                        // (Update only selected month-venue combinations)
                        selectedMonths.forEach(monthKey => {
                            venues.forEach(venue => {
                                const key = `${monthKey}-${venue}`;
                                PREVIOUSLY_EXPORTED_MONTHS.set(key, true);
                            });
                        });
                        
                        // Refresh the monthly view to show updated export status
                        generateMonthlyExportView();
                        
                        // Reset button
                        button.disabled = false;
                        btnText.textContent = originalText;
                        
                        // Close modal
                        closeExportDataModal();
                        
                        // Show success message
                        showSuccessMessage(`Export completed successfully! File: ${filename}`);
                        
                    } catch (exportError) {
                        console.error('Export error:', exportError);
                        alert('Export failed: ' + exportError.message);
                        
                        // Reset button on error
                        button.disabled = false;
                        btnText.textContent = originalText;
                    }
                }, 2000);
                
            } catch (error) {
                console.error('performExport error:', error);
                alert('Export function error: ' + error.message);
            }
        }

        function generateSelectedMonthsExportData(dataTypes, venues, selectedMonths) {
            const data = {
                metadata: {
                    exportDate: new Date().toISOString(),
                    selectedMonths: selectedMonths,
                    selectedVenues: venues,
                    dataTypes: dataTypes
                },
                referees: [],
                summary: {
                    totalReferees: 0,
                    totalMonths: selectedMonths.length,
                    totalVenueCombinations: selectedMonths.length * venues.length
                }
            };

            // Generate referee data for the selected months only
            MOCK_REFEREES_TABLE.forEach(referee => {
                const refereeVenues = referee.venues.filter(venue => venues.includes(venue));
                if (refereeVenues.length === 0) return;

                const refereeData = {
                    id: referee.id,
                    name: referee.name,
                    email: referee.email,
                    phone: referee.phone,
                    venues: refereeVenues,
                    monthlyData: []
                };

                // Generate data only for selected months
                selectedMonths.forEach(monthKey => {
                    const [year, month] = monthKey.split('-');
                    
                    // Calculate summary statistics for this month
                    let totalDaysWorked = 0;
                    let totalMatchesOfficiated = 0;
                    
                    refereeVenues.forEach(venue => {
                        if (dataTypes.includes('days-worked')) {
                            totalDaysWorked += Math.floor(Math.random() * 20) + 5;
                            totalMatchesOfficiated += Math.floor(Math.random() * 15) + 3;
                        }
                    });
                    
                    const monthData = {
                        month: monthKey,
                        monthName: new Date(parseInt(year), parseInt(month) - 1, 1).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }),
                        venues: refereeVenues, // Array of venue names
                        daysWorked: totalDaysWorked,
                        matchesOfficiated: totalMatchesOfficiated
                    };

                    refereeData.monthlyData.push(monthData);
                });

                data.referees.push(refereeData);
                data.summary.totalReferees++;
            });

            return data;
        }

        function downloadExportFile(data, filename, format) {
            switch (format) {
                case 'csv':
                    const csvContent = convertToCSV(data);
                    const csvBlob = new Blob([csvContent], { type: 'text/csv' });
                    downloadBlob(csvBlob, filename);
                    break;
                case 'excel':
                    // In a real application, this would generate an Excel file
                    const excelContent = convertToCSV(data);
                    const excelBlob = new Blob([excelContent], { type: 'application/vnd.ms-excel' });
                    downloadBlob(excelBlob, filename);
                    break;
                case 'pdf':
                    generatePDF(data, filename);
                    break;
                default:
                    const jsonContent = JSON.stringify(data, null, 2);
                    const jsonBlob = new Blob([jsonContent], { type: 'application/json' });
                    downloadBlob(jsonBlob, filename);
            }
        }

        function downloadBlob(blob, filename) {
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        function generatePDF(data, filename) {
            try {
                // Check if jsPDF is available
                if (!window.jspdf) {
                    console.error('jsPDF library not loaded');
                    alert('PDF library not loaded. Please refresh the page and try again.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Set document title and properties
                doc.setProperties({
                    title: 'Referee Export Report',
                    subject: 'Referee Management System - Performance Report',
                    creator: '5ive Trackr League Management System',
                    author: '5ive Trackr',
                    keywords: 'referee, performance, export, report'
                });
                
                let currentPage = 1;
                let yPosition = 20;
                
                // Function to add full header (first page only)
                function addFirstPageHeader() {
                    // Title
                    doc.setFontSize(24);
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(46, 100, 23); // Green color
                    doc.text('5ive Trackr - Referee Report', 20, yPosition);
                    yPosition += 12;
                    
                    // Subtitle
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(100, 100, 100);
                    doc.text('Performance Summary and Monthly Statistics', 20, yPosition);
                    yPosition += 8;
                    
                    // Export info
                    doc.setFontSize(10);
                    doc.setTextColor(60, 60, 60);
                    doc.text(`Generated: ${new Date().toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}`, 20, yPosition);
                    yPosition += 6;
                    
                    // Summary info
                    doc.text(`Total Referees: ${data.summary.totalReferees} | Report Period: ${data.summary.dateRange || 'Multiple Months'}`, 20, yPosition);
                    yPosition += 6;
                    
                    // Selected venues info
                    const selectedVenues = data.metadata && data.metadata.selectedVenues ? 
                        data.metadata.selectedVenues : 
                        ['Sports Arena West', 'Elite Sports Center', 'Premier League Complex']; // fallback
                    
                    const venuesText = selectedVenues.length <= 3 ? 
                        selectedVenues.join(', ') : 
                        `${selectedVenues.slice(0, 3).join(', ')} and ${selectedVenues.length - 3} more`;
                    
                    doc.text(`Selected Venues: ${venuesText}`, 20, yPosition);
                    yPosition += 15;
                    
                    // Draw separator line
                    doc.setDrawColor(46, 100, 23);
                    doc.setLineWidth(0.5);
                    doc.line(20, yPosition, 190, yPosition);
                    yPosition += 10;
                }
                
                // Function to add simple header (subsequent pages)
                function addSimpleHeader() {
                    // Just the title and page info
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(46, 100, 23);
                    doc.text('5ive Trackr - Referee Report (continued)', 20, yPosition);
                    yPosition += 8;
                    
                    // Draw a thin separator line
                    doc.setDrawColor(200, 200, 200);
                    doc.setLineWidth(0.3);
                    doc.line(20, yPosition, 190, yPosition);
                    yPosition += 8;
                }
                
                // Function to add footer
                function addPageFooter() {
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(100, 100, 100);
                    doc.text(`Page ${currentPage}`, 180, 285, { align: 'right' });
                    doc.text('5ive Trackr League Management System', 20, 285);
                }
                
                // Function to check if we need a new page
                function checkPageBreak(requiredSpace = 20) {
                    if (yPosition + requiredSpace > 260) {
                        addPageFooter();
                        doc.addPage();
                        currentPage++;
                        yPosition = 20;
                        // Only add simple header for subsequent pages
                        addSimpleHeader();
                        return true;
                    }
                    return false;
                }
                
                // Add first page header only
                addFirstPageHeader();
                
                // Add referee data
                data.referees.forEach((referee, index) => {
                    // Calculate space needed for this referee (header + monthly data)
                    const spaceNeeded = 40 + (referee.monthlyData.length * 6);
                    checkPageBreak(spaceNeeded);
                    
                    // Referee section header
                    doc.setFontSize(16);
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(46, 100, 23);
                    doc.text(`${index + 1}. ${referee.name}`, 20, yPosition);
                    yPosition += 10;
                    
                    // Contact information section
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(60, 60, 60);
                    doc.text('Contact Information:', 25, yPosition);
                    yPosition += 6;
                    
                    doc.setFontSize(10);
                    doc.setTextColor(80, 80, 80);
                    doc.text(`Email: ${referee.email}`, 30, yPosition);
                    yPosition += 5;
                    doc.text(`Phone: ${referee.phone}`, 30, yPosition);
                    yPosition += 8;
                    
                    // Venues section
                    doc.setFontSize(11);
                    doc.setTextColor(60, 60, 60);
                    doc.text('Assigned Venues:', 25, yPosition);
                    yPosition += 6;
                    
                    doc.setFontSize(10);
                    doc.setTextColor(80, 80, 80);
                    const venuesText = referee.venues.join(', ');
                    doc.text(venuesText, 30, yPosition);
                    yPosition += 10;
                    
                    // Monthly performance section
                    if (referee.monthlyData.length > 0) {
                        doc.setFontSize(11);
                        doc.setTextColor(60, 60, 60);
                        doc.text('Monthly Performance:', 25, yPosition);
                        yPosition += 8;
                        
                        // Table headers with better styling
                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'bold');
                        doc.setTextColor(40, 40, 40);
                        
                        // Header background
                        doc.setFillColor(240, 247, 237);
                        doc.rect(30, yPosition - 4, 140, 8, 'F');
                        
                        doc.text('Month', 35, yPosition);
                        doc.text('Days Worked', 85, yPosition);
                        doc.text('Matches Officiated', 130, yPosition);
                        yPosition += 6;
                        
                        // Table data
                        doc.setFont('helvetica', 'normal');
                        doc.setTextColor(60, 60, 60);
                        
                        referee.monthlyData.forEach((monthData, monthIndex) => {
                            checkPageBreak(8);
                            
                            // Alternate row colors for better readability
                            if (monthIndex % 2 === 0) {
                                doc.setFillColor(250, 250, 250);
                                doc.rect(30, yPosition - 3, 140, 6, 'F');
                            }
                            
                            doc.text(monthData.monthName, 35, yPosition);
                            doc.text(monthData.daysWorked.toString(), 95, yPosition, { align: 'center' });
                            doc.text(monthData.matchesOfficiated.toString(), 145, yPosition, { align: 'center' });
                            yPosition += 6;
                        });
                    }
                    
                    // Add separator between referees
                    yPosition += 8;
                    doc.setDrawColor(200, 200, 200);
                    doc.setLineWidth(0.3);
                    doc.line(20, yPosition, 190, yPosition);
                    yPosition += 15;
                });
                
                // Add footer to last page
                addPageFooter();
                
                // Save the PDF
                doc.save(filename);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF: ' + error.message);
            }
        }

        function convertToCSV(data) {
            const headers = ['Referee Name', 'Month', 'Venues', 'Days Worked', 'Matches Officiated'];
            const rows = [headers];
            
            data.referees.forEach(referee => {
                referee.monthlyData.forEach(monthData => {
                    rows.push([
                        referee.name,
                        monthData.month,
                        monthData.venues.join('; '),
                        monthData.daysWorked,
                        monthData.matchesOfficiated
                    ]);
                });
            });
            
            return rows.map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        }
    </script>
</body>
</html>



