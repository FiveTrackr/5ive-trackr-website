<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixtures - 5ive Trackr</title>
    <meta name="author" content="5ive Trackr">
    <meta name="copyright" content="Â© 2025 5ive Trackr. All rights reserved.">
    <meta name="robots" content="noarchive, noimageindex">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    
    <!-- Consolidated Dashboard Master CSS -->
    <link rel="stylesheet" href="../../css/dashboard-master.css?v=consolidated-2025">
    <style>
    /* Safe system font stack - no external dependencies */
    body, * {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, Roboto, "Noto Sans", "Liberation Sans", sans-serif;
    }
</style>
    <!-- League Manager Sidebar Styles - Load immediately to prevent layout shifts -->
    <link rel="stylesheet" href="../../css/league-manager-sidebar.css">
    <!-- League Manager Header Styles - Load immediately to prevent layout shifts -->
    <link rel="stylesheet" href="../../css/league-manager-header.css">
    
    <style>
        /* Header Template Styles */
        .main-header[data-loaded="league-manager"] {
            background-color: #ffffff !important;
            border-radius: 0 0 12px 12px !important;
            padding: 16px 24px !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            width: calc(100% - 250px) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            position: fixed !important;
            top: 0 !important;
            left: 250px !important;
            z-index: 999 !important;
            height: 70px !important;
            box-sizing: border-box !important;
        }

        .main-header .header-left {
            display: flex !important;
            align-items: center !important;
            justify-content: flex-start !important;
            flex: 1 !important;
            height: 100% !important;
            padding-left: 24px !important;
        }

        .main-header .page-title {
            font-size: 28px !important;
            font-weight: 800 !important;
            text-transform: uppercase !important;
            color: #2e6417 !important;
            margin: 0 !important;
        }

        .main-header .header-right {
            display: flex !important;
            align-items: center !important;
            gap: 16px !important;
            height: 100% !important;
        }

        .main-header .user-info {
            display: flex !important;
            align-items: center !important;
            gap: 12px !important;
        }

        .main-header .user-avatar {
            width: 40px !important;
            height: 40px !important;
            border-radius: 50% !important;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%) !important;
            color: white !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-weight: 600 !important;
            font-size: 14px !important;
        }

        .main-header .user-details {
            display: flex !important;
            flex-direction: column !important;
            align-items: flex-start !important;
        }

        .main-header .user-name {
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #333 !important;
            margin: 0 !important;
        }

        .main-header .user-role {
            font-size: 12px !important;
            color: #666 !important;
            margin: 0 !important;
        }

        .main-header .header-actions {
            display: flex !important;
            align-items: center !important;
            gap: 12px !important;
        }

        .main-header .header-btn {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            padding: 8px 16px !important;
            background: #2e6417 !important;
            color: white !important;
            border: none !important;
            border-radius: 8px !important;
            font-size: 14px !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            position: relative !important;
        }

        .main-header .header-btn:hover {
            background: #1e4009 !important;
            transform: translateY(-1px) !important;
        }

        /* Notifications Button Styling */
        .notifications-btn {
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            padding: 0;
            font-size: 10px;
            font-weight: 600;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }

        .notification-badge.hidden {
            display: none;
        }

        /* Notifications Panel Styling */
        .notifications-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 400px;
            max-width: 90vw;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1001;
            max-height: 70vh;
            display: none;
            flex-direction: column;
            border: 1px solid #e0e0e0;
        }

        .notifications-panel.active {
            display: flex;
        }

        .notifications-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }

        .notifications-overlay.active {
            display: block;
        }

        .notifications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .notifications-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .notifications-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mark-all-read {
            color: #2e6417;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }

        .mark-all-read:hover {
            text-decoration: underline;
        }

        .close-panel {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-panel:hover {
            color: #333;
        }

        .notifications-content {
            flex: 1;
            overflow-y: auto;
            max-height: calc(70vh - 80px);
        }

        .notifications-list {
            padding: 8px 0;
        }

        /* Fixtures Page Specific Styles */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f3f4f6;
        }
        
        .page-title-section {
            flex: 1;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 4px 0;
        }
        
        .page-subtitle {
            color: #6b7280;
            font-size: 16px;
            margin: 0;
        }
        
        .page-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            text-decoration: none;
            font-family: 'Inter', sans-serif;
        }
        
        .btn-primary {
            background-color: #2e6417;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e4009;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background-color: #e9ecef;
        }
        
        .btn-outline {
            background-color: transparent;
            color: #2e6417;
            border: 1px solid #2e6417;
        }
        
        .btn-outline:hover {
            background-color: #2e6417;
            color: white;
        }
        
        .btn-icon {
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
        }
        
        /* Professional CSS Icons */
        .btn-icon.icon-export::before {
            content: "ðŸ“‹";
            font-style: normal;
        }
        
        .btn-icon.icon-create::before {
            content: "ï¼‹";
            font-style: normal;
            font-weight: bold;
        }
        
        .btn-icon.icon-refresh::before {
            content: "â†»";
            font-style: normal;
            font-weight: bold;
        }
        
        .btn-icon.icon-search::before {
            content: "ðŸ”";
            font-style: normal;
        }
        
        .btn-icon.icon-settings::before {
            content: "âš™";
            font-style: normal;
        }
        
        /* Enhanced Button States */
        .btn {
            position: relative;
            overflow: hidden;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn:disabled:hover {
            transform: none !important;
            background-color: inherit;
        }
        
        .btn.loading {
            pointer-events: none;
        }
        
        .btn.loading .btn-text {
            opacity: 0.7;
        }
        
        .btn.loading .btn-icon::before {
            content: "â†»";
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Enhanced Primary Button */
        .btn-primary {
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            border: none;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1e4009 0%, #2e6417 100%);
            box-shadow: 0 4px 8px rgba(46, 100, 23, 0.3);
            transform: translateY(-2px);
        }
        
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2);
        }
        
        /* Enhanced Secondary Button */
        .btn-secondary:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary:active {
            transform: translateY(0);
            box-shadow: none;
        }
        
        /* Search and Filters Section */
        .search-filters-section {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .search-filters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1.2fr 120px;
            gap: 16px;
            align-items: end;
        }
        
        .search-container {
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        .search-container .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: #6b7280;
            pointer-events: none;
        }
        
        .search-container .search-input {
            padding-left: 40px;
        }
        
        .filter-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        /* Filters Section */
        .filters-section {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .filters-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1.2fr 120px;
            gap: 16px;
            align-items: end;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        .filter-select, .search-input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            font-family: 'Inter', sans-serif;
            height: 40px;
            box-sizing: border-box;
        }
        
        .filter-select:focus, .search-input:focus {
            outline: none;
            border-color: #2e6417;
            box-shadow: 0 0 0 3px rgba(46, 100, 23, 0.1);
        }
        
        /* Search filter group specific styling */
        .search-filter-group .search-group {
            position: relative;
            display: flex;
        }
        
        .search-filter-group .search-input {
            padding-right: 36px;
            flex: 1;
        }
        
        /* Filter actions styling */
        .filter-actions {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .btn-compact {
            padding: 6px 12px;
            font-size: 13px;
            height: auto;
            min-height: 32px;
        }
        
        .btn-compact .btn-text {
            font-size: 13px;
        }
        
        .btn-compact .btn-icon {
            width: 14px;
            height: 14px;
            font-size: 14px;
        }
        
        
        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            transition: all 0.2s;
        }
        
        .search-btn:hover {
            background-color: #f3f4f6;
        }
        
        .search-btn:active {
            background-color: #e5e7eb;
        }
        
        /* Action Required Section - MAXIMUM SPECIFICITY OVERRIDE */
        .action-required-section {
            margin-bottom: 32px;
            width: 100%;
        }
        
        /* Nuclear option - Override ALL global flex styles with maximum specificity */
        html body.fixtures-page[data-page="fixtures"][data-role="league-manager"] main.main-content div.content-area div.action-required-section div.action-cards-grid,
        body.fixtures-page[data-page="fixtures"] .action-required-section .action-cards-grid,
        .fixtures-page .action-required-section .action-cards-grid,
        .action-required-section .action-cards-grid {
            display: grid !important;
            grid-template-columns: repeat(4, 1fr) !important;
            grid-template-rows: auto !important;
            gap: 2px !important;
            row-gap: 2px !important;
            column-gap: 2px !important;
            width: 100% !important;
            max-width: 100% !important;
            min-width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            flex-direction: unset !important;
            flex-wrap: unset !important;
            justify-content: unset !important;
            align-items: unset !important;
            overflow-x: visible !important;
            box-sizing: border-box !important;
            grid-auto-columns: 1fr !important;
            grid-auto-rows: auto !important;
            flex: none !important;
            position: static !important;
        }
        
        /* Force action cards to be wider with maximum specificity */
        html body.fixtures-page[data-page="fixtures"][data-role="league-manager"] main.main-content div.content-area div.action-required-section div.action-cards-grid div.action-card,
        body.fixtures-page[data-page="fixtures"] .action-card,
        .fixtures-page .action-card,
        .action-required-section .action-card {
            background: white !important;
            border-radius: 8px !important;
            padding: 24px !important;
            border-left: 4px solid #e5e7eb !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
            transition: box-shadow 0.2s !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: space-between !important;
            min-height: 120px !important;
            max-height: 120px !important;
            min-width: 280px !important;
            width: 100% !important;
            box-sizing: border-box !important;
            flex: 1 !important;
            position: relative !important;
            margin: 0 auto !important;
            justify-self: center !important;
            align-self: center !important;
        }
        
        .action-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
        }
        
        .action-card.priority-high {
            border-left-color: #dc2626 !important;
        }
        
        .action-card.priority-medium {
            border-left-color: #f59e0b !important;
        }
        
        .action-card.priority-low {
            border-left-color: #10b981 !important;
        }
        
        .action-header {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 8px !important;
            margin-bottom: 12px !important;
        }
        
        .action-title-group {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 8px !important;
            flex: 1 !important;
        }
        
        .action-header h3 {
            font-size: 14px !important;
            font-weight: 600 !important;
            color: #374151 !important;
            margin: 0 !important;
            white-space: nowrap !important;
            text-align: center !important;
        }
        
        .action-icon {
            display: none !important;
        }
        
        .action-count {
            background: #dc2626 !important;
            color: white !important;
            border-radius: 50% !important;
            padding: 6px !important;
            font-size: 12px !important;
            font-weight: 600 !important;
            flex-shrink: 0 !important;
            position: absolute !important;
            right: 8px !important;
            top: 8px !important;
            width: 24px !important;
            height: 24px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            line-height: 1 !important;
            text-align: center !important;
            box-sizing: border-box !important;
            min-width: 24px !important;
            min-height: 24px !important;
        }
        
        .action-count.zero {
            background: #2e6417 !important;
        }
        
        .action-count.non-zero {
            background: #dc2626 !important;
        }
        
        .action-description {
            display: none; /* Hide description to save space */
        }
        
        .action-btn {
            background: #f3f4f6 !important;
            color: #374151 !important;
            border: 1px solid #d1d5db !important;
            padding: 8px 12px !important;
            border-radius: 6px !important;
            font-size: 12px !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.2s !important;
            white-space: nowrap !important;
            width: 100% !important;
            text-align: center !important;
            box-sizing: border-box !important;
        }
        
        .action-btn:hover {
            background: #e5e7eb !important;
        }
        
        /* Fixtures Section */
        .fixtures-section {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            background: #f8f9fa;
        }
        
        .section-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .view-select {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
        }
        
        /* Table Styles */
        .fixtures-table-container {
            overflow-x: auto;
        }
        
        .fixtures-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .fixtures-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap;
        }
        
        .fixtures-table th.sortable {
            cursor: pointer;
            user-select: none;
        }
        
        .fixtures-table th.sortable:hover {
            background: #e9ecef;
        }
        
        .sort-icon {
            margin-left: 4px;
            opacity: 0.5;
        }
        
        .fixtures-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            vertical-align: middle;
        }
        
        .fixtures-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .match-teams {
            font-weight: 600;
        }
        
        .team-home {
            color: #374151;
        }
        
        .team-away {
            color: #6b7280;
        }
        
        .vs-separator {
            margin: 0 8px;
            color: #9ca3af;
            font-weight: 400;
        }
        
        .fixture-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-confirmed {
            background: #d1fae5;
            color: #047857;
        }
        
        .status-scheduled {
            background: #d1fae5;
            color: #047857;
        }
        
        .status-unconfirmed {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-completed {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .status-cancelled {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .status-awaiting-approval {
            background: #f3e8ff;
            color: #7c2d12;
        }
        
        .status-in-progress {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-postponed {
            background: #f3e8ff;
            color: #7c2d12;
        }
        
        .fixture-actions {
            display: flex;
            gap: 4px;
        }
        
        .action-link {
            padding: 4px 8px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .action-edit {
            background: #fef3c7;
            color: #92400e;
        }
        
        .action-edit:hover {
            background: #fde68a;
        }
        
        .action-cancel {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .action-cancel:hover {
            background: #fecaca;
        }
        
        .action-result {
            background: #d1fae5;
            color: #047857;
        }
        
        .action-result:hover {
            background: #a7f3d0;
        }
        
        /* Pagination */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        .pagination-info {
            color: #6b7280;
            font-size: 14px;
        }
        
        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .pagination-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background: #f3f4f6;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-numbers {
            display: flex;
            gap: 4px;
        }
        
        .page-number {
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
        }
        
        .page-number:hover {
            background: #f3f4f6;
        }
        
        .page-number.active {
            background: #2e6417;
            color: white;
            border-color: #2e6417;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #2e6417;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #6b7280;
            padding: 4px;
        }
        
        .modal-close:hover {
            color: #374151;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        /* Contact Teams Dialog Specific Styles */
        .contact-teams-dialog .modal-content {
            max-width: 800px;
            width: 95%;
        }
        
        .awaiting-fixtures-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .fixture-contact-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }
        
        .fixture-contact-layout {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .contact-emoji {
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .contact-emoji:hover {
            background: #e5e7eb;
            transform: scale(1.1);
        }
        
        .status-emoji {
            font-size: 16px;
            padding: 2px;
        }
        
        .team-name {
            font-weight: 600;
            color: #374151;
            min-width: 120px;
            text-align: center;
        }
        
        .vs-separator {
            font-weight: 700;
            color: #6b7280;
            padding: 0 8px;
        }
        
        .fixture-details {
            font-size: 12px;
            color: #6b7280;
            margin-left: auto;
            text-align: right;
            min-width: 100px;
        }
        
        .email-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .email-dialog.hidden {
            display: none;
        }
        
        .email-content {
            background: white;
            border-radius: 8px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .email-preview {
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 16px;
            margin: 16px 0;
            background: #f9fafb;
        }
        
        .email-header {
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .email-field {
            display: flex;
            margin-bottom: 4px;
        }
        
        .email-field-label {
            font-weight: 600;
            width: 60px;
            color: #374151;
        }
        
        .email-field-value {
            color: #6b7280;
        }
        
        .email-body {
            line-height: 1.6;
            color: #374151;
        }
        
        .confirmation-buttons {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .confirm-btn.approve {
            background: #10b981;
            color: white;
        }
        
        .confirm-btn.approve:hover {
            background: #059669;
        }
        
        .confirm-btn.decline {
            background: #ef4444;
            color: white;
        }
        
        .confirm-btn.decline:hover {
            background: #dc2626;
        }
        
        .email-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
            font-size: 14px;
        }
        
        .form-input, .form-textarea {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
        }
        
        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #2e6417;
            box-shadow: 0 0 0 3px rgba(46, 100, 23, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        
        /* Responsive Design - with maximum specificity */
        @media (max-width: 1200px) {
            html body.fixtures-page[data-page="fixtures"][data-role="league-manager"] main.main-content div.content-area div.action-required-section div.action-cards-grid,
            body.fixtures-page[data-page="fixtures"] .action-required-section .action-cards-grid,
            .fixtures-page .action-required-section .action-cards-grid,
            .action-required-section .action-cards-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 4px !important;
            }
            
            .filters-row {
                grid-template-columns: 1fr 1fr 1fr 1fr;
                gap: 12px;
            }
            
            .search-filter-group {
                grid-column: 1 / -1;
            }
            
            .filter-actions {
                grid-column: 1 / -1;
                flex-direction: row;
                justify-content: flex-start;
                gap: 12px;
            }
        }
        
        @media (max-width: 768px) {
            html body.fixtures-page[data-page="fixtures"][data-role="league-manager"] main.main-content div.content-area div.action-required-section div.action-cards-grid,
            body.fixtures-page[data-page="fixtures"] .action-required-section .action-cards-grid,
            .fixtures-page .action-required-section .action-cards-grid,
            .action-required-section .action-cards-grid {
                grid-template-columns: 1fr !important;
                gap: 6px !important;
            }
            
            html body.fixtures-page[data-page="fixtures"][data-role="league-manager"] main.main-content div.content-area div.action-required-section div.action-cards-grid div.action-card,
            body.fixtures-page[data-page="fixtures"] .action-card,
            .fixtures-page .action-card,
            .action-required-section .action-card {
                padding: 20px !important;
                min-height: 100px !important;
                max-height: 100px !important;
            }
            
            .action-header h3 {
                font-size: 13px;
            }
            
            .action-btn {
                font-size: 11px;
                padding: 4px 8px;
            }
            
            .page-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }
            
            .page-actions {
                justify-content: flex-start;
            }
            
            .filters-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .filter-actions {
                flex-direction: row;
                justify-content: space-between;
            }
            
            .section-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }
            
            .pagination-container {
                flex-direction: column;
                gap: 12px;
                align-items: center;
            }
        }

        /* Venue Selector Styles */
        .venue-selector-container {
            padding: 0 15px 20px 15px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 16px;
            position: relative;
            overflow: visible;
        }

        .venue-selector-btn {
            width: 100% !important;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: none !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2);
            position: relative;
            box-sizing: border-box !important;
            margin: 0 !important;
            user-select: none !important;
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
        }

        .venue-selector-btn:hover {
            transform: none !important;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2) !important;
        }

        .venue-selector-btn:active {
            transform: none !important;
        }

        .venue-selector-content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
        }

        .venue-selector-label {
            font-size: 0.7rem;
            opacity: 0.9;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .venue-selector-name {
            font-size: 0.875rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .venue-selector-icon {
            font-size: 1rem;
            margin-left: 8px;
            transition: none !important;
        }

        .venue-selector-btn.active .venue-selector-icon {
            transform: rotate(180deg) !important;
            transition: none !important;
        }

        .venue-selector-btn.active {
            border-radius: 8px 8px 0 0 !important;
            border-bottom: none !important;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2) !important;
            transition: none !important;
        }

        .venue-dropdown {
            position: absolute;
            top: calc(100% - 1px);
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            border: none !important;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            z-index: 9999 !important;
            margin-top: 0;
            transform: none !important;
            transition: none !important;
            display: none;
            max-height: 300px;
            overflow-y: auto;
            color: white;
            outline: none !important;
        }

        .venue-dropdown.show {
            display: block !important;
            transition: none !important;
        }

        /* Venue Selector Overlay - Only darken area outside dropdown */
        .venue-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            z-index: 9998 !important;
            display: none;
            transition: none !important;
        }

        .venue-selector-overlay.show {
            display: block !important;
            transition: none !important;
        }

        .venue-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: none !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
            background: transparent;
        }

        .venue-option:last-child {
            border-bottom: none;
        }

        .venue-option:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            transition: none !important;
        }

        .venue-option.selected {
            background: rgba(255, 255, 255, 0.2) !important;
            color: white;
            font-weight: 700;
            transition: none !important;
        }

        .venue-option-details {
            display: flex;
            flex-direction: column;
        }

        .venue-option-name {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 2px;
            color: white;
        }

        .venue-option-address {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.8);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .venue-option-check {
            color: white;
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Navigation Icon Fixes */
        body[data-role="league-manager"] .sidebar .nav-icon[data-icon="referee"],
        .sidebar .nav-icon[data-icon="referee"] {
            background-image: url('../../img/referee-icon.svg') !important;
            background-size: 18px 18px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            width: 20px !important;
            height: 20px !important;
            display: inline-block !important;
        }

        body[data-role="league-manager"] .sidebar .nav-icon[data-icon="shirt"],
        .sidebar .nav-icon[data-icon="shirt"] {
            background-image: url('../../img/shirt-icon.svg') !important;
            background-size: 18px 18px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            width: 20px !important;
            height: 20px !important;
            display: inline-block !important;
        }

        /* Navigation Sizing Fix Applied: Consistent padding (14px 20px) for all nav items via league-manager-sidebar.css */
    </style>
    <\!-- SPA Redirect Handler -->
    <script src="../../js/core/spa-redirect.js"></script>
</head>
<body data-page="fixtures" data-role="league-manager" class="fixtures-page">
    <!-- Sidebar - Static content with dynamic enhancement -->
    <aside class="sidebar">
        <!-- Static sidebar content that loads immediately -->
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="../../img/header-logo.svg" alt="5ive Trackr" class="logo">
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="sidebar-nav">
            <!-- Venue Selector -->
            <div class="venue-selector-container">
                <div class="venue-selector-btn" id="venue-selector-btn" onclick="toggleVenueDropdown()">
                    <div class="venue-selector-content">
                        <div class="venue-selector-label">Current Venue</div>
                        <div class="venue-selector-name" id="selected-venue-name">Loading...</div>
                    </div>
                    <span class="venue-selector-icon">â–¼</span>
                    <div class="venue-dropdown" id="venue-dropdown">
                        <!-- Data will be loaded dynamically based on logged-in user -->
                        <div class="venue-option" data-venue-id="VEN002" onclick="selectVenue('VEN002', 'Elite Sports Center', '456 Championship Drive', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Elite Sports Center</div>
                                <div class="venue-option-address">456 Championship Drive</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <div class="venue-option" data-venue-id="VEN003" onclick="selectVenue('VEN003', 'Premier League Complex', '789 Victory Boulevard', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Premier League Complex</div>
                                <div class="venue-option-address">789 Victory Boulevard</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <div class="venue-option" data-venue-id="VEN001" onclick="selectVenue('VEN001', 'Sports Arena West', '123 Athletic Avenue', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Sports Arena West</div>
                                <div class="venue-option-address">123 Athletic Avenue</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <!-- END MOCK DATA -->
                    </div>
                </div>
            </div>

            <!-- Venue Selector Overlay -->
            <div class="venue-selector-overlay" id="venue-selector-overlay" onclick="closeVenueDropdown()"></div>

            <ul class="nav-menu">
                <li class="nav-item" data-page="dashboard">
                    <a href="dashboard.html" class="nav-link">
                        <span class="nav-icon">ðŸ“Š</span>
                        <span class="link-text">Dashboard</span>
                    </a>
                </li>
                
                <li class="nav-item active" data-page="fixtures">
                    <a href="fixtures.html" class="nav-link">
                        <span class="nav-icon">ðŸ“…</span>
                        <span class="link-text">Fixtures</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="referees">
                    <a href="referees.html" class="nav-link">
                        <span class="nav-icon" data-icon="referee"></span>
                        <span class="link-text">Referees</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="divisions">
                    <a href="divisions.html" class="nav-link">
                        <span class="nav-icon">ðŸ“‹</span>
                        <span class="link-text">Divisions</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="leagues">
                    <a href="leagues.html" class="nav-link">
                        <span class="nav-icon">ðŸ†</span>
                        <span class="link-text">Leagues</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="teams">
                    <a href="teams.html" class="nav-link">
                        <span class="nav-icon" data-icon="shirt"></span>
                        <span class="link-text">Teams</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="pitches">
                    <a href="pitches.html" class="nav-link">
                        <span class="nav-icon">ðŸ¥…</span>
                        <span class="link-text">Pitches</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="venues">
                    <a href="venues.html" class="nav-link">
                        <span class="nav-icon">ðŸŸï¸</span>
                        <span class="link-text">Venues</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="payments">
                    <a href="team-payments.html" class="nav-link">
                        <span class="nav-icon">ðŸ’³</span>
                        <span class="link-text">Team Payments</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
            <div class="footer-section footer-actions">
                <a href="settings.html" class="footer-link">
                    <span class="footer-icon">âš™ï¸</span>
                    <span class="footer-text">Settings</span>
                </a>
                <a href="#" class="footer-link" onclick="handleLogout(event)">
                    <span class="footer-icon">ðŸšª</span>
                    <span class="footer-text">Logout</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- League Manager Header Template -->
    <div class="main-header" data-loaded="league-manager">
        <div class="header-left">
            <h1 class="page-title" data-page-title>Fixtures</h1>
        </div>

        <div class="header-right">
            <!-- User Info Section -->
            <div class="user-info"> data-user-name
                <div class="user-avatar" data-user-initials> data-user-name--</div>
                <div class="user-details"> data-user-name
                    <div class="user-name" data-user-name> data-user-nameLoading...</div>
                    <div class="user-role" data-user-role> data-user-role data-user-nameLoading...</div>
                </div>
            </div>

            <!-- Header Actions -->
            <div class="header-actions">
                <button class="header-btn notifications-btn" onclick="toggleNotificationsPanel()">
                    <span class="btn-icon">ðŸ””</span>
                    <span class="btn-text">Notifications</span>
                    <span class="notification-badge" id="notification-count">3</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notifications-panel">
        <div class="notifications-header">
            <h3>Notifications</h3>
            <div class="notifications-actions">
                <button class="btn-text mark-all-read" onclick="markAllNotificationsRead()">Mark all as read</button>
                <button class="close-panel" onclick="closeNotificationsPanel()">&times;</button>
            </div>
        </div>
        <div class="notifications-content">
            <div class="notifications-list" id="notifications-list">
                <!-- Notifications will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notifications Panel Overlay -->
    <div class="notifications-overlay" id="notifications-overlay" onclick="closeNotificationsPanel()"></div>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="content-area">
            
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-title-section">
                    <h1 class="page-title">Fixtures Management</h1>
                    <p class="page-subtitle">Manage match schedules, results, and fixture administration</p>
                </div>
                <div class="page-actions">
                    <button class="btn btn-secondary" id="export-fixtures" 
                            aria-label="Export fixtures to spreadsheet"
                            title="Export all fixtures to Excel/CSV format">
                        <span class="btn-icon icon-export" aria-hidden="true"></span>
                        <span class="btn-text">Export Fixtures</span>
                    </button>
                    <button class="btn btn-primary" id="create-fixture"
                            aria-label="Create new fixture"
                            title="Schedule a new match fixture">
                        <span class="btn-icon icon-create" aria-hidden="true"></span>
                        <span class="btn-text">Create Fixture</span>
                    </button>
                </div>
            </div>

            <!-- Action Required Section -->
            <div class="action-required-section">
                <div class="action-cards-grid" style="display: grid !important; grid-template-columns: repeat(4, 1fr) !important; gap: 2px !important; width: 100% !important; flex-direction: unset !important; flex-wrap: unset !important; justify-content: unset !important; align-items: unset !important;">
                    <div class="action-card priority-high" id="referee-assignments" style="width: 100% !important; flex: 1 !important; padding: 24px !important; min-width: 280px !important; min-height: 120px !important; max-height: 120px !important; margin: 0 auto !important; justify-self: center !important; position: relative !important;">
                        <div class="action-header">
                            <div class="action-title-group">
                                <h3>Referee Assignments</h3>
                            </div>
                            <span class="action-count non-zero">3</span>
                        </div>
                        <button class="action-btn">Assign Referees</button>
                    </div>
                    
                    <div class="action-card priority-medium" id="pending-results" style="width: 100% !important; flex: 1 !important; padding: 24px !important; min-width: 280px !important; min-height: 120px !important; max-height: 120px !important; margin: 0 auto !important; justify-self: center !important; position: relative !important;">
                        <div class="action-header">
                            <div class="action-title-group">
                                <h3>Pending Results</h3>
                            </div>
                            <span class="action-count non-zero">2</span>
                        </div>
                        <button class="action-btn">Review Results</button>
                    </div>
                    
                    <div class="action-card priority-low" id="pitch-conflicts" style="width: 100% !important; flex: 1 !important; padding: 24px !important; min-width: 280px !important; min-height: 120px !important; max-height: 120px !important; margin: 0 auto !important; justify-self: center !important; position: relative !important;">
                        <div class="action-header">
                            <div class="action-title-group">
                                <h3>Pitch Conflicts</h3>
                            </div>
                            <span class="action-count zero">0</span>
                        </div>
                        <button class="action-btn">Resolve Conflicts</button>
                    </div>
                    
                    <div class="action-card priority-medium" id="teams-unconfirmed" style="width: 100% !important; flex: 1 !important; padding: 24px !important; min-width: 280px !important; min-height: 120px !important; max-height: 120px !important; margin: 0 auto !important; justify-self: center !important; position: relative !important;">
                        <div class="action-header">
                            <div class="action-title-group">
                                <h3>Awaiting Confirmation</h3>
                            </div>
                            <span class="action-count non-zero">4</span>
                        </div>
                        <button class="action-btn">Contact Teams</button>
                    </div>
                </div>
            </div>

            <!-- Search and Filters Section -->
            <div class="search-filters-section">
                <div class="search-filters-grid">
                    <!-- Search Bar -->
                    <div class="search-container">
                        <span class="search-icon">ðŸ”</span>
                        <input type="text" id="search-input" placeholder="Search teams, venues, or referee..." class="search-input">
                    </div>

                    <!-- Status Filter -->
                    <div class="filter-group">
                        <label class="filter-label">Status</label>
                        <select id="status-filter" class="filter-select">
                            <option value="all">Show All</option>
                            <option value="upcoming">Upcoming (All)</option>
                            <option value="upcoming-confirmed">Upcoming (Confirmed)</option>
                            <option value="upcoming-unconfirmed">Upcoming (Un-Confirmed)</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                            <option value="awaiting-approval">Awaiting Approval</option>
                        </select>
                    </div>

                    <!-- Date Range Filter -->
                    <div class="filter-group">
                        <label class="filter-label">Date Range</label>
                        <select id="date-filter" class="filter-select">
                            <option value="all">All Dates</option>
                            <option value="today">Today</option>
                            <option value="week-1">Within 1 Week</option>
                            <option value="week-2" selected>Within 2 Weeks</option>
                            <option value="week-3">Within 3 Weeks</option>
                            <option value="season">This Season</option>
                        </select>
                    </div>

                    <!-- Team Filter -->
                    <div class="filter-group">
                        <label class="filter-label">Team</label>
                        <select id="team-filter" class="filter-select">
                            <option value="">All Teams</option>
                            <option value="ravens">Ravens FC</option>
                            <option value="eagles">Eagles United</option>
                            <option value="hawks">Hawks Athletic</option>
                            <option value="lions">Lions FC</option>
                            <option value="tigers">Tigers United</option>
                            <option value="wolves">Wolves SC</option>
                        </select>
                    </div>

                    <!-- Filter Actions -->
                    <div class="filter-actions">
                        <button type="button" class="btn btn-outline btn-clear" id="clear-filters">Clear</button>
                    </div>
                </div>
            </div>

            <!-- Fixtures Table -->
            <div class="fixtures-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">ðŸ“…</span>
                        Fixtures Schedule
                    </h2>
                    <div class="section-actions">
                        <select id="view-mode" class="view-select">
                            <option value="list">List View</option>
                            <option value="calendar">Calendar View</option>
                            <option value="week">Week View</option>
                        </select>
                        <button class="btn btn-outline" id="generate-fixtures">
                            <span class="btn-icon">âš™ï¸</span>
                            Generate Fixtures
                        </button>
                    </div>
                </div>

                <div class="fixtures-table-container">
                    <table class="fixtures-table" id="fixtures-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-column="date">
                                    Date & Time
                                    <span class="sort-icon">â†•ï¸</span>
                                </th>
                                <th class="sortable" data-column="league">
                                    League
                                    <span class="sort-icon">â†•ï¸</span>
                                </th>
                                <th class="sortable" data-column="teams">
                                    Match
                                    <span class="sort-icon">â†•ï¸</span>
                                </th>
                                <th class="sortable" data-column="venue">
                                    Venue
                                    <span class="sort-icon">â†•ï¸</span>
                                </th>
                                <th class="sortable" data-column="referee">
                                    Referee
                                    <span class="sort-icon">â†•ï¸</span>
                                </th>
                                <th class="sortable" data-column="status">
                                    Status
                                    <span class="sort-icon">â†•ï¸</span>
                                </th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fixtures-tbody">
                            <!-- Fixtures will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination-container">
                    <div class="pagination-info">
                        Showing <span id="showing-start">1</span>-<span id="showing-end">20</span> of <span id="total-fixtures">0</span> fixtures
                    </div>
                    <div class="pagination-controls">
                        <button class="pagination-btn" id="prev-page" disabled>Â« Previous</button>
                        <div class="pagination-numbers" id="pagination-numbers">
                            <!-- Page numbers will be inserted here -->
                        </div>
                        <button class="pagination-btn" id="next-page">Next Â»</button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Create/Edit Fixture Modal -->
    <div class="modal" id="fixture-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Create New Fixture</h3>
                <button class="modal-close" id="modal-close">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="fixture-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fixture-league">League *</label>
                            <select id="fixture-league" name="league" required class="form-input">
                                <option value="">Select League</option>
                                <option value="league-001">Monday Night Premier</option>
                                <option value="league-002">Wednesday Champions</option>
                                <option value="league-003">Thursday Night Division</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fixture-home-team">Home Team *</label>
                            <select id="fixture-home-team" name="homeTeam" required class="form-input">
                                <option value="">Select Home Team</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fixture-away-team">Away Team *</label>
                            <select id="fixture-away-team" name="awayTeam" required class="form-input">
                                <option value="">Select Away Team</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fixture-date">Date *</label>
                            <input type="date" id="fixture-date" name="date" required class="form-input">
                        </div>
                        
                        <div class="form-group">
                            <label for="fixture-time">Time *</label>
                            <input type="time" id="fixture-time" name="time" required class="form-input" value="19:00">
                        </div>
                        
                        <div class="form-group">
                            <label for="fixture-venue">Venue *</label>
                            <select id="fixture-venue" name="venue" required class="form-input">
                                <option value="">Select Venue</option>
                                <option value="venue-1">SportCity Indoor</option>
                                <option value="venue-2">Riverside Courts</option>
                                <option value="venue-3">Central Pitches</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fixture-referee">Referee</label>
                            <select id="fixture-referee" name="referee" class="form-input">
                                <option value="">No referee assigned</option>
                                <option value="ref-001">John Smith</option>
                                <option value="ref-002">Sarah Johnson</option>
                                <option value="ref-003">Mike Brown</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fixture-round">Round</label>
                            <input type="number" id="fixture-round" name="round" min="1" class="form-input" placeholder="e.g. 1">
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="fixture-notes">Notes</label>
                            <textarea id="fixture-notes" name="notes" class="form-textarea" rows="3" placeholder="Additional notes about this fixture..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancel-fixture">Cancel</button>
                <button type="submit" form="fixture-form" class="btn btn-primary" id="save-fixture">Create Fixture</button>
            </div>
        </div>
    </div>

    <!-- Contact Teams Dialog -->
    <div class="modal contact-teams-dialog" id="contact-teams-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Contact Teams - Awaiting Approval</h3>
                <button class="modal-close" id="contact-teams-close">âœ•</button>
            </div>
            <div class="modal-body">
                <p style="color: #6b7280; margin-bottom: 16px;">
                    The following fixtures require team approval. Click the contact icons (ðŸ“§) to send approval emails to teams.
                </p>
                <div class="awaiting-fixtures-list" id="awaiting-fixtures-list">
                    <!-- Fixtures awaiting approval will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Email Preview Dialog -->
    <div class="email-dialog hidden" id="email-dialog"> data-user-email
        <div class="email-content"> data-user-email
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0; color: #374151;">Email Preview</h3>
                <button style="background: none; border: none; font-size: 18px; cursor: pointer; color: #6b7280;" id="close-email-dialog">âœ•</button>
            </div>
            
            <div class="email-preview" id="email-preview"> data-user-email
                <!-- Email content will be populated here -->
            </div>
            
            <div class="email-actions"> data-user-email
                <button type="button" class="btn btn-secondary" id="cancel-email">Cancel</button>
                <button type="button" class="btn btn-primary" id="send-email">Send Email</button>
            </div>
        </div>
    </div>

    <!-- Dynamic Template Scripts -->
    <script src="../../js/core/auth.js"></script>`n    <script src="../../js/core/session-manager.js"></script>
    <!-- <script src="../../js/core/session-protection.js"></script> -->
    <script src="../../js/components/league-manager-sidebar.js?v=<?php echo time(); ?>"></script>
    <script src="../../js/components/league-manager-header.js?v=<?php echo time(); ?>"></script>
    <script src="../../js/header-template-loader.js?v=<?php echo time(); ?>"></script>
    
    <script>
        // Header Template JavaScript Functionality
        // Page titles mapping for each league manager page
        const PAGE_TITLES = {
            'dashboard': 'Dashboard',
            'teams': 'Teams',
            'leagues': 'Leagues', 
            'divisions': 'Divisions',
            'fixtures': 'Fixtures',
            'referees': 'Referees',
            'pitches': 'Pitches',
            'team-payments': 'Team Payments',
            'settings': 'Settings'
        };
        
        // Load user data and update header
        async function loadUserData() {
            try {
                // Check if UserDataManager is available
                if (typeof window.UserDataManager !== 'undefined') {
                    const userData = await window.UserDataManager.load();
                    if (userData && userData.currentUser) {
                        updateUserDisplay(userData.currentUser);
                        return;
                    }
                }
                
                // Try SessionManager if available
                if (typeof window.SessionManager !== 'undefined' && window.SessionManager.isLoggedIn()) {
                    const currentUser = window.SessionManager.getCurrentUser();
                    if (currentUser) {
                        updateUserDisplay(currentUser);
                        return;
                    }
                }
                
                // Fallback: Try to load from localStorage
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    updateUserDisplay(user);
                    return;
                }
                
                // Final fallback: Use session data or default
                const sessionData = localStorage.getItem('sessionData');
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    if (session.user) {
                        updateUserDisplay(session.user);
                        return;
                    }
                }
                
                // Default fallback data
                updateUserDisplay({
                    name: 'League Manager',
                    role: 'Administrator',
                    initials: 'LM'
                });
                
            } catch (error) {
                console.error('Error loading user data in header template:', error);
                // Use default data on error
                updateUserDisplay({
                    name: 'League Manager',
                    role: 'Administrator', 
                    initials: 'LM'
                });
            }
        }
        
        // Update user display elements
        function updateUserDisplay(user) {
            // Update user name - prioritize full name over email
            const userNameElements = document.querySelectorAll('[data-user-name]');
            userNameElements.forEach(element => {
                // Look for full name first, then fallback to username, avoid showing email as name
                const displayName = user.fullName || user.name || user.firstName || user.username || 'League Manager';
                element.textContent = displayName;
            });
            
            // Update user role - use the actual assigned role
            const userRoleElements = document.querySelectorAll('[data-user-role]');
            userRoleElements.forEach(element => {
                // Look for various role field names and clean up the display
                let displayRole = user.role || user.userRole || user.accountType || 'Administrator';
                
                // Clean up role display (convert snake_case to proper case)
                if (displayRole === 'league_manager') {
                    displayRole = 'League Manager';
                } else if (displayRole === 'team_manager') {
                    displayRole = 'Team Manager';
                } else if (displayRole === 'referee') {
                    displayRole = 'Referee';
                } else if (displayRole === 'admin') {
                    displayRole = 'Administrator';
                }
                
                element.textContent = displayRole;
            });
            
            // Update user initials - use full name for initials, not email
            const userInitialsElements = document.querySelectorAll('[data-user-initials]');
            userInitialsElements.forEach(element => {
                const nameForInitials = user.fullName || user.name || user.firstName || user.username || 'League Manager';
                const initials = user.initials || generateInitials(nameForInitials);
                element.textContent = initials;
            });
        }
        
        // Generate initials from name
        function generateInitials(name) {
            if (!name) return 'LM';
            
            // Don't generate initials from email addresses
            if (name.includes('@')) {
                return 'LM'; // Default to League Manager initials for email addresses
            }
            
            const nameParts = name.trim().split(' ');
            if (nameParts.length === 1) {
                return nameParts[0].substring(0, 2).toUpperCase();
            } else {
                return (nameParts[0].charAt(0) + nameParts[nameParts.length - 1].charAt(0)).toUpperCase();
            }
        }
        
        // Simple Notifications System - Placeholder for future implementation
        function toggleNotificationsPanel() {
            console.log('Notifications panel clicked - feature coming soon');
            alert('Notifications feature coming soon!');
        }

        function closeNotificationsPanel() {
            console.log('Close notifications panel');
        }

        function markAllNotificationsRead() {
            console.log('Mark all notifications as read');
        }

        // Venue Selector JavaScript Functions
        let currentVenueId = null;
        let currentVenueName = null;

        // Data loaded from server based on user permissions`n        const mockVenues = [
            { id: 'VEN001', name: 'Sports Arena West', address: '123 Athletic Avenue' },
            { id: 'VEN002', name: 'Elite Sports Center', address: '456 Championship Drive' },
            { id: 'VEN003', name: 'Premier League Complex', address: '789 Victory Boulevard' }
        ];

        function initializeVenueSelector() {
            console.log('Initializing venue selector for fixtures page');
            // Data loaded from server based on user permissions`n            const sortedVenues = mockVenues.sort((a, b) => a.name.localeCompare(b.name));
            if (sortedVenues.length > 0) {
                const firstVenue = sortedVenues[0];
                selectVenue(firstVenue.id, firstVenue.name, firstVenue.address, null, false);
            }
        }

        function toggleVenueDropdown() {
            const dropdown = document.getElementById('venue-dropdown');
            const btn = document.getElementById('venue-selector-btn');
            const overlay = document.getElementById('venue-selector-overlay');
            
            console.log('Toggle clicked', dropdown, btn, overlay); // Debug log
            
            if (dropdown && dropdown.classList.contains('show')) {
                console.log('Closing dropdown'); // Debug log
                closeVenueDropdown();
            } else {
                console.log('Opening dropdown'); // Debug log
                if (dropdown) dropdown.classList.add('show');
                if (btn) btn.classList.add('active');
                if (overlay) overlay.classList.add('show');
            }
        }

        function closeVenueDropdown() {
            const dropdown = document.getElementById('venue-dropdown');
            const btn = document.getElementById('venue-selector-btn');
            const overlay = document.getElementById('venue-selector-overlay');
            
            console.log('Closing dropdown function called'); // Debug log
            
            if (dropdown) dropdown.classList.remove('show');
            if (btn) btn.classList.remove('active');
            if (overlay) overlay.classList.remove('show');
        }

        function selectVenue(venueId, venueName, venueAddress, event, closeDropdown = true) {
            // Prevent event bubbling to parent button
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            // Update selected venue
            currentVenueId = venueId;
            currentVenueName = venueName;
            
            // Update button text
            document.getElementById('selected-venue-name').textContent = venueName;
            
            // Update option selection states
            document.querySelectorAll('.venue-option').forEach(option => {
                const checkmark = option.querySelector('.venue-option-check');
                if (option.dataset.venueId === venueId) {
                    option.classList.add('selected');
                    checkmark.style.display = 'block';
                } else {
                    option.classList.remove('selected');
                    checkmark.style.display = 'none';
                }
            });
            
            // Close dropdown if requested
            if (closeDropdown) {
                closeVenueDropdown();
            }
            
            // Filter data based on selected venue
            filterDataByVenue(venueId);
            
            console.log('Venue changed to:', venueName, '(ID:', venueId, ')');
        }

        function filterDataByVenue(venueId) {
            // This function would filter the fixtures data based on selected venue
            // Data loaded from server based on user permissions`n            console.log('Filtering fixtures data for venue:', venueId);
            
            // Example: Show/hide fixture rows based on venue
            // In a real implementation, this would filter the fixtures data
            console.log('Showing fixtures data for venue:', venueId);
            
            // You could update the fixtures table here to show only relevant data
            // updateFixturesTable(venueId);
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('venue-dropdown');
            const btn = document.getElementById('venue-selector-btn');
            const overlay = document.getElementById('venue-selector-overlay');
            
            if (dropdown && btn && overlay &&
                !dropdown.contains(event.target) && 
                !btn.contains(event.target) &&
                !overlay.contains(event.target)) {
                closeVenueDropdown();
            }
        });

        // Fixtures page initialization
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize venue selector first
            initializeVenueSelector();
            
            // Load user data for header
            await loadUserData();
            
            console.log('Fixtures page loaded');
            
            // Listen for sidebar load completion
            document.addEventListener('sidebarLoaded', function(e) {
                console.log('Dynamic sidebar loaded successfully:', e.detail);
                
                // Set active page for fixtures
                if (window.leagueManagerSidebar) {
                    setTimeout(() => {
                        window.leagueManagerSidebar.setActive('fixtures');
                        console.log('Fixtures set as active');
                    }, 100);
                }
            });
            
            // Listen for header load completion
            document.addEventListener('headerLoaded', function(e) {
                console.log('Dynamic header loaded successfully:', e.detail);
                
                // Update header page title for fixtures
                if (window.leagueManagerHeader) {
                    setTimeout(() => {
                        window.leagueManagerHeader.updatePageTitle('fixtures');
                        console.log('Header title set to Fixtures');
                    }, 100);
                }
            });
            
            // Initialize fixtures functionality
            initializeFixtures();
        });
        
        // Fixtures data management
        let fixturesData = [];
        let filteredFixtures = [];
        let currentPage = 1;
        const itemsPerPage = 20;
        let sortColumn = 'date';
        let sortDirection = 'asc';
        
        function initializeFixtures() {
            // Load mock fixtures data
            loadFixturesData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Apply default filters (Within 2 Weeks is already selected in HTML)
            applyFilters();
            
            // Force grid layout for action cards (nuclear option)
            forceActionCardsGrid();
            
            console.log('Fixtures functionality initialized with default filters');
        }
        
        function updateActionCounts() {
            const today = new Date('2025-07-24'); // Current date
            const sixDaysFromNow = new Date(today);
            sixDaysFromNow.setDate(today.getDate() + 6);
            
            // Calculate teams awaiting approval within next 6 days
            let teamsAwaitingApproval = 0;
            fixturesData.forEach(fixture => {
                if (fixture.status !== 'awaiting-approval') return;
                
                const fixtureDate = new Date(fixture.date);
                const withinTimeframe = fixtureDate >= today && fixtureDate <= sixDaysFromNow;
                
                if (withinTimeframe) {
                    // Count each team that hasn't approved
                    if (!fixture.homeTeamApproved) teamsAwaitingApproval++;
                    if (!fixture.awayTeamApproved) teamsAwaitingApproval++;
                }
            });
            
            // Calculate referee assignments needed
            const refereeAssignmentsCount = fixturesData.filter(fixture => {
                const fixtureDate = new Date(fixture.date);
                const withinTimeframe = fixtureDate >= today && fixtureDate <= sixDaysFromNow;
                const needsReferee = !fixture.referee || fixture.referee === '';
                const isUpcoming = fixture.status === 'confirmed' || fixture.status === 'awaiting-approval';
                
                return needsReferee && withinTimeframe && isUpcoming;
            }).length;
            
            // Calculate pending results
            const pendingResultsCount = fixturesData.filter(fixture => {
                return fixture.status === 'completed' && (fixture.homeScore === null || fixture.awayScore === null);
            }).length;
            
            // Calculate pitch conflicts (for demo, set to 0)
            const pitchConflictsCount = 0;
            
            // Update the action count elements
            const awaitingApprovalElement = document.querySelector('#teams-unconfirmed .action-count');
            const refereeAssignmentsElement = document.querySelector('#referee-assignments .action-count');
            const pendingResultsElement = document.querySelector('#pending-results .action-count');
            const pitchConflictsElement = document.querySelector('#pitch-conflicts .action-count');
            
            if (awaitingApprovalElement) {
                awaitingApprovalElement.textContent = teamsAwaitingApproval;
                awaitingApprovalElement.className = teamsAwaitingApproval === 0 ? 'action-count zero' : 'action-count non-zero';
            }
            
            if (refereeAssignmentsElement) {
                refereeAssignmentsElement.textContent = refereeAssignmentsCount;
                refereeAssignmentsElement.className = refereeAssignmentsCount === 0 ? 'action-count zero' : 'action-count non-zero';
            }
            
            if (pendingResultsElement) {
                pendingResultsElement.textContent = pendingResultsCount;
                pendingResultsElement.className = pendingResultsCount === 0 ? 'action-count zero' : 'action-count non-zero';
            }
            
            if (pitchConflictsElement) {
                pitchConflictsElement.textContent = pitchConflictsCount;
                pitchConflictsElement.className = pitchConflictsCount === 0 ? 'action-count zero' : 'action-count non-zero';
            }
            
            console.log('Action counts updated:', {
                teamsAwaitingApproval: teamsAwaitingApproval,
                refereeAssignments: refereeAssignmentsCount,
                pendingResults: pendingResultsCount,
                pitchConflicts: pitchConflictsCount
            });
        }
        
        function loadFixturesData() {
            // Mock fixtures data - in real app this would come from API
            fixturesData = [
                {
                    id: 'fix-001',
                    date: '2025-07-30',
                    time: '19:00',
                    league: 'Monday Night Premier',
                    leagueId: 'league-001',
                    homeTeam: 'Red Dragons FC',
                    awayTeam: 'Blue Lions United',
                    venue: 'SportCity Indoor',
                    venueId: 'venue-1',
                    referee: 'John Smith',
                    refereeId: 'ref-001',
                    status: 'confirmed',
                    round: 5,
                    homeScore: null,
                    awayScore: null,
                    homeTeamApproved: true,
                    awayTeamApproved: true,
                    homeTeamEmail: 'manager@reddragonsfc.com',
                    awayTeamEmail: 'contact@bluelionsunited.com'
                },
                {
                    id: 'fix-002',
                    date: '2025-07-28',
                    time: '15:30',
                    league: 'Wednesday Champions',
                    leagueId: 'league-002',
                    homeTeam: 'Green Tigers',
                    awayTeam: 'Yellow Eagles',
                    venue: 'Riverside Courts',
                    venueId: 'venue-2',
                    referee: '',
                    refereeId: '',
                    status: 'awaiting-approval',
                    round: 3,
                    homeScore: null,
                    awayScore: null,
                    homeTeamApproved: false,
                    awayTeamApproved: true,
                    homeTeamEmail: 'team@greentigers.com',
                    awayTeamEmail: 'manager@yelloweagles.com'
                },
                {
                    id: 'fix-003',
                    date: '2025-07-22',
                    time: '20:00',
                    league: 'Thursday Night Division',
                    leagueId: 'league-003',
                    homeTeam: 'Purple Panthers',
                    awayTeam: 'Orange Wolves',
                    venue: 'Central Pitches',
                    venueId: 'venue-3',
                    referee: 'Sarah Johnson',
                    refereeId: 'ref-002',
                    status: 'completed',
                    round: 4,
                    homeScore: 3,
                    awayScore: 1,
                    homeTeamApproved: true,
                    awayTeamApproved: true,
                    homeTeamEmail: 'contact@purplepanthers.com',
                    awayTeamEmail: 'info@orangewolves.com'
                },
                {
                    id: 'fix-004',
                    date: '2025-07-29',
                    time: '18:00',
                    league: 'Monday Night Premier',
                    leagueId: 'league-001',
                    homeTeam: 'Black Hawks',
                    awayTeam: 'White Sharks',
                    venue: 'SportCity Indoor',
                    venueId: 'venue-1',
                    referee: '',
                    refereeId: '',
                    status: 'awaiting-approval',
                    round: 5,
                    homeScore: null,
                    awayScore: null,
                    homeTeamApproved: true,
                    awayTeamApproved: false,
                    homeTeamEmail: 'admin@blackhawks.com',
                    awayTeamEmail: 'team@whitesharks.com'
                },
                {
                    id: 'fix-005',
                    date: '2025-07-26',
                    time: '16:00',
                    league: 'Weekend Warriors',
                    leagueId: 'league-004',
                    homeTeam: 'Silver Bullets',
                    awayTeam: 'Gold Rush FC',
                    venue: 'Riverside Courts',
                    venueId: 'venue-2',
                    referee: 'Mike Brown',
                    refereeId: 'ref-003',
                    status: 'awaiting-approval',
                    round: 2,
                    homeScore: null,
                    awayScore: null,
                    homeTeamApproved: false,
                    awayTeamApproved: false,
                    homeTeamEmail: 'manager@silverbullets.com',
                    awayTeamEmail: 'contact@goldrushfc.com'
                },
                {
                    id: 'fix-006',
                    date: '2025-08-15',
                    time: '20:30',
                    league: 'Wednesday Champions',
                    leagueId: 'league-002',
                    homeTeam: 'Crystal Eagles',
                    awayTeam: 'Thunder Bolts',
                    venue: 'Central Pitches',
                    venueId: 'venue-3',
                    referee: '',
                    refereeId: '',
                    status: 'awaiting-approval',
                    round: 6,
                    homeScore: null,
                    awayScore: null,
                    homeTeamApproved: false,
                    awayTeamApproved: true,
                    homeTeamEmail: 'team@crystaleagles.com',
                    awayTeamEmail: 'admin@thunderbolts.com'
                }
            ];
            
            filteredFixtures = [...fixturesData];
            
            // Update action counts after loading data
            updateActionCounts();
        }
        
        function forceActionCardsGrid() {
            // Force the grid layout with JavaScript as final fallback
            const grid = document.querySelector('.action-cards-grid');
            const cards = document.querySelectorAll('.action-card');
            
            if (grid) {
                // Reset any conflicting styles
                grid.style.cssText = `
                    display: grid !important;
                    grid-template-columns: repeat(4, 1fr) !important;
                    gap: 2px !important;
                    width: 100% !important;
                    max-width: 100% !important;
                    margin: 0 !important;
                    padding: 0 !important;
                    flex-direction: unset !important;
                    flex-wrap: unset !important;
                    justify-content: unset !important;
                    align-items: unset !important;
                    box-sizing: border-box !important;
                `;
                
                // Force card styles
                cards.forEach(card => {
                    card.style.cssText += `
                        width: 100% !important;
                        padding: 24px !important;
                        min-width: 280px !important;
                        min-height: 120px !important;
                        max-height: 120px !important;
                        box-sizing: border-box !important;
                        flex: 1 !important;
                        margin: 0 auto !important;
                        justify-self: center !important;
                        align-self: center !important;
                    `;
                });
                
                console.log('Forced action cards grid layout with shorter height and centered alignment');
            }
        }
        
        function setupEventListeners() {
            // Filter controls
            document.getElementById('league-filter')?.addEventListener('change', applyFilters);
            document.getElementById('status-filter')?.addEventListener('change', applyFilters);
            document.getElementById('date-filter')?.addEventListener('change', applyFilters);
            
            // Search
            document.getElementById('search-fixtures')?.addEventListener('input', handleSearch);
            document.getElementById('search-btn')?.addEventListener('click', handleSearch);
            
            // Action buttons
            document.getElementById('clear-filters')?.addEventListener('click', clearFilters);
            document.getElementById('refresh-fixtures')?.addEventListener('click', refreshFixtures);
            document.getElementById('create-fixture')?.addEventListener('click', openCreateFixtureModal);
            document.getElementById('export-fixtures')?.addEventListener('click', exportFixtures);
            document.getElementById('generate-fixtures')?.addEventListener('click', generateFixtures);
            
            // Modal controls
            document.getElementById('modal-close')?.addEventListener('click', closeModal);
            document.getElementById('cancel-fixture')?.addEventListener('click', closeModal);
            document.getElementById('fixture-form')?.addEventListener('submit', handleFixtureSubmit);
            
            // Contact Teams functionality
            const contactTeamsBtn = document.querySelector('#teams-unconfirmed .action-btn');
            if (contactTeamsBtn) {
                contactTeamsBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent event bubbling to parent card
                    openContactTeamsDialog();
                });
            }
            document.getElementById('contact-teams-close')?.addEventListener('click', closeContactTeamsDialog);
            document.getElementById('close-email-dialog')?.addEventListener('click', closeEmailDialog);
            document.getElementById('cancel-email')?.addEventListener('click', closeEmailDialog);
            document.getElementById('send-email')?.addEventListener('click', sendConfirmationEmail);
            
            // Table sorting
            document.querySelectorAll('.sortable').forEach(th => {
                th.addEventListener('click', () => handleSort(th.dataset.column));
            });
            
            // Pagination
            document.getElementById('prev-page')?.addEventListener('click', () => changePage(currentPage - 1));
            document.getElementById('next-page')?.addEventListener('click', () => changePage(currentPage + 1));
            
            // Action required cards
            document.getElementById('referee-assignments')?.addEventListener('click', () => {
                // Filter to show upcoming unconfirmed fixtures needing referees
                document.getElementById('status-filter').value = 'upcoming-unconfirmed';
                applyFilters();
                // Scroll to table
                document.querySelector('.fixtures-section').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('pending-results')?.addEventListener('click', () => {
                // Filter to show completed fixtures
                document.getElementById('status-filter').value = 'completed';
                applyFilters();
                document.querySelector('.fixtures-section').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('pitch-conflicts')?.addEventListener('click', () => {
                // Filter to show awaiting approval fixtures
                document.getElementById('status-filter').value = 'awaiting-approval';
                applyFilters();
                document.querySelector('.fixtures-section').scrollIntoView({ behavior: 'smooth' });
            });
            
            document.getElementById('teams-unconfirmed')?.addEventListener('click', () => {
                // Filter to show awaiting approval fixtures
                document.getElementById('status-filter').value = 'awaiting-approval';
                applyFilters();
                document.querySelector('.fixtures-section').scrollIntoView({ behavior: 'smooth' });
            });
        }
        
        function applyFilters() {
            const leagueFilter = document.getElementById('league-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const dateFilter = document.getElementById('date-filter').value;
            
            filteredFixtures = fixturesData.filter(fixture => {
                let matchesFilters = true;
                
                if (leagueFilter && fixture.leagueId !== leagueFilter) {
                    matchesFilters = false;
                }
                
                // Enhanced status filtering
                if (statusFilter) {
                    const fixtureDate = new Date(fixture.date);
                    const today = new Date();
                    const isUpcoming = fixtureDate >= today;
                    
                    switch (statusFilter) {
                        case 'upcoming-all':
                            if (!isUpcoming || fixture.status === 'completed' || fixture.status === 'cancelled') {
                                matchesFilters = false;
                            }
                            break;
                        case 'upcoming-confirmed':
                            if (!isUpcoming || fixture.status !== 'confirmed' && fixture.status !== 'scheduled') {
                                matchesFilters = false;
                            }
                            break;
                        case 'upcoming-unconfirmed':
                            if (!isUpcoming || fixture.status !== 'unconfirmed' && fixture.status !== 'pending') {
                                matchesFilters = false;
                            }
                            break;
                        case 'completed':
                            if (fixture.status !== 'completed') {
                                matchesFilters = false;
                            }
                            break;
                        case 'cancelled':
                            if (fixture.status !== 'cancelled') {
                                matchesFilters = false;
                            }
                            break;
                        case 'awaiting-approval':
                            if (fixture.status !== 'awaiting-approval' && fixture.status !== 'pending-approval') {
                                matchesFilters = false;
                            }
                            break;
                    }
                }
                
                // Enhanced date filtering
                if (dateFilter && dateFilter !== 'all') {
                    const fixtureDate = new Date(fixture.date);
                    const today = new Date();
                    
                    switch (dateFilter) {
                        case 'today':
                            if (fixtureDate.toDateString() !== today.toDateString()) {
                                matchesFilters = false;
                            }
                            break;
                        case 'within-1-week':
                            const oneWeekFromNow = new Date(today);
                            oneWeekFromNow.setDate(today.getDate() + 7);
                            if (fixtureDate < today || fixtureDate > oneWeekFromNow) {
                                matchesFilters = false;
                            }
                            break;
                        case 'within-2-weeks':
                            const twoWeeksFromNow = new Date(today);
                            twoWeeksFromNow.setDate(today.getDate() + 14);
                            if (fixtureDate < today || fixtureDate > twoWeeksFromNow) {
                                matchesFilters = false;
                            }
                            break;
                        case 'within-3-weeks':
                            const threeWeeksFromNow = new Date(today);
                            threeWeeksFromNow.setDate(today.getDate() + 21);
                            if (fixtureDate < today || fixtureDate > threeWeeksFromNow) {
                                matchesFilters = false;
                            }
                            break;
                        case 'this-season':
                            // Assuming a season runs from August to May
                            const currentYear = today.getFullYear();
                            const seasonStart = new Date(currentYear, 7, 1); // August 1st
                            let seasonEnd = new Date(currentYear + 1, 4, 31); // May 31st next year
                            
                            // If we're before August, use previous season
                            if (today.getMonth() < 7) {
                                seasonStart.setFullYear(currentYear - 1);
                                seasonEnd.setFullYear(currentYear);
                            }
                            
                            if (fixtureDate < seasonStart || fixtureDate > seasonEnd) {
                                matchesFilters = false;
                            }
                            break;
                    }
                }
                
                return matchesFilters;
            });
            
            currentPage = 1;
            renderFixtures();
        }
        
        function handleSearch() {
            const searchTerm = document.getElementById('search-fixtures').value.toLowerCase();
            
            if (!searchTerm) {
                applyFilters();
                return;
            }
            
            filteredFixtures = filteredFixtures.filter(fixture => 
                fixture.homeTeam.toLowerCase().includes(searchTerm) ||
                fixture.awayTeam.toLowerCase().includes(searchTerm) ||
                fixture.venue.toLowerCase().includes(searchTerm) ||
                fixture.league.toLowerCase().includes(searchTerm) ||
                (fixture.referee && fixture.referee.toLowerCase().includes(searchTerm))
            );
            
            currentPage = 1;
            renderFixtures();
        }
        
        function clearFilters() {
            document.getElementById('league-filter').value = '';
            document.getElementById('status-filter').value = '';
            document.getElementById('date-filter').value = 'within-2-weeks'; // Set default to within 2 weeks
            document.getElementById('search-fixtures').value = '';
            
            filteredFixtures = [...fixturesData];
            currentPage = 1;
            applyFilters(); // Apply filters to respect the default date setting
        }
        
        function refreshFixtures() {
            // In real app, this would fetch fresh data from the server
            const refreshBtn = document.getElementById('refresh-fixtures');
            const originalHtml = refreshBtn.innerHTML;
            
            // Show loading state
            refreshBtn.classList.add('loading');
            refreshBtn.disabled = true;
            
            // Simulate async operation
            setTimeout(() => {
                loadFixturesData();
                applyFilters();
                
                // Show success state
                refreshBtn.classList.remove('loading');
                refreshBtn.innerHTML = '<span class="btn-icon" style="color: #10b981;">âœ“</span><span class="btn-text">Refreshed</span>';
                
                // Reset to original state
                setTimeout(() => {
                    refreshBtn.innerHTML = originalHtml;
                    refreshBtn.disabled = false;
                }, 1500);
            }, 800);
        }
        
        function handleSort(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            
            filteredFixtures.sort((a, b) => {
                let aValue = a[column];
                let bValue = b[column];
                
                // Handle team names for match column
                if (column === 'teams') {
                    aValue = a.homeTeam;
                    bValue = b.homeTeam;
                }
                
                // Handle date comparison
                if (column === 'date') {
                    aValue = new Date(a.date + ' ' + a.time);
                    bValue = new Date(b.date + ' ' + b.time);
                }
                
                if (aValue < bValue) return sortDirection === 'asc' ? -1 : 1;
                if (aValue > bValue) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
            
            renderFixtures();
            updateSortIcons();
        }
        
        function updateSortIcons() {
            document.querySelectorAll('.sortable .sort-icon').forEach(icon => {
                icon.textContent = 'â†•ï¸';
            });
            
            const activeHeader = document.querySelector(`[data-column="${sortColumn}"] .sort-icon`);
            if (activeHeader) {
                activeHeader.textContent = sortDirection === 'asc' ? 'â†‘' : 'â†“';
            }
        }
        
        function renderFixtures() {
            const tbody = document.getElementById('fixtures-tbody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageFixtures = filteredFixtures.slice(startIndex, endIndex);
            
            tbody.innerHTML = '';
            
            if (pageFixtures.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #6b7280;">
                            No fixtures found matching your criteria
                        </td>
                    </tr>
                `;
                return;
            }
            
            pageFixtures.forEach(fixture => {
                const row = document.createElement('tr');
                
                const dateTime = formatDateTime(fixture.date, fixture.time);
                const matchDisplay = getMatchDisplay(fixture);
                const statusDisplay = getStatusDisplay(fixture.status);
                const actionsDisplay = getActionsDisplay(fixture);
                
                row.innerHTML = `
                    <td>${dateTime}</td>
                    <td>${fixture.league}</td>
                    <td>${matchDisplay}</td>
                    <td>${fixture.venue}</td>
                    <td>${fixture.referee || '<em style="color: #9ca3af;">Not assigned</em>'}</td>
                    <td>${statusDisplay}</td>
                    <td>${actionsDisplay}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            updatePagination();
        }
        
        function formatDateTime(date, time) {
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            return `
                <div style="font-weight: 600;">${formattedDate}</div>
                <div style="color: #6b7280; font-size: 13px;">${time}</div>
            `;
        }
        
        function getMatchDisplay(fixture) {
            if (fixture.status === 'completed') {
                return `
                    <div class="match-teams">
                        <span class="team-home">${fixture.homeTeam}</span>
                        <span class="vs-separator">${fixture.homeScore} - ${fixture.awayScore}</span>
                        <span class="team-away">${fixture.awayTeam}</span>
                    </div>
                `;
            } else {
                return `
                    <div class="match-teams">
                        <span class="team-home">${fixture.homeTeam}</span>
                        <span class="vs-separator">vs</span>
                        <span class="team-away">${fixture.awayTeam}</span>
                    </div>
                `;
            }
        }
        
        function getStatusDisplay(status) {
            const statusClasses = {
                'confirmed': 'status-confirmed',
                'scheduled': 'status-confirmed', // Legacy support
                'unconfirmed': 'status-unconfirmed',
                'pending': 'status-unconfirmed', // Maps to unconfirmed style
                'completed': 'status-completed',
                'cancelled': 'status-cancelled',
                'awaiting-approval': 'status-awaiting-approval',
                'pending-approval': 'status-awaiting-approval'
            };
            
            const statusLabels = {
                'confirmed': 'Confirmed',
                'scheduled': 'Confirmed', // Legacy support
                'unconfirmed': 'Un-Confirmed',
                'pending': 'Un-Confirmed',
                'completed': 'Completed',
                'cancelled': 'Cancelled',
                'awaiting-approval': 'Awaiting Approval',
                'pending-approval': 'Awaiting Approval'
            };
            
            const statusClass = statusClasses[status] || 'status-scheduled';
            const statusLabel = statusLabels[status] || status;
            
            return `<span class="fixture-status ${statusClass}">${statusLabel}</span>`;
        }
        
        function getActionsDisplay(fixture) {
            let actions = [];
            
            if (fixture.status === 'scheduled') {
                actions.push(`<a href="#" class="action-link action-edit" onclick="editFixture('${fixture.id}')">Edit</a>`);
                actions.push(`<a href="#" class="action-link action-cancel" onclick="cancelFixture('${fixture.id}')">Cancel</a>`);
            }
            
            if (fixture.status === 'completed') {
                actions.push(`<a href="#" class="action-link action-result" onclick="viewResult('${fixture.id}')">View</a>`);
            }
            
            if (fixture.status === 'in-progress') {
                actions.push(`<a href="#" class="action-link action-result" onclick="enterResult('${fixture.id}')">Result</a>`);
            }
            
            return `<div class="fixture-actions">${actions.join('')}</div>`;
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(filteredFixtures.length / itemsPerPage);
            const startItem = (currentPage - 1) * itemsPerPage + 1;
            const endItem = Math.min(currentPage * itemsPerPage, filteredFixtures.length);
            
            // Update info
            document.getElementById('showing-start').textContent = filteredFixtures.length > 0 ? startItem : 0;
            document.getElementById('showing-end').textContent = endItem;
            document.getElementById('total-fixtures').textContent = filteredFixtures.length;
            
            // Update buttons
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages || totalPages === 0;
            
            // Update page numbers
            const numbersContainer = document.getElementById('pagination-numbers');
            numbersContainer.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-number ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => changePage(i);
                numbersContainer.appendChild(pageBtn);
            }
        }
        
        function changePage(page) {
            const totalPages = Math.ceil(filteredFixtures.length / itemsPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderFixtures();
        }
        
        function openCreateFixtureModal() {
            document.getElementById('modal-title').textContent = 'Create New Fixture';
            document.getElementById('save-fixture').textContent = 'Create Fixture';
            document.getElementById('fixture-form').reset();
            document.getElementById('fixture-modal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('fixture-modal').classList.remove('active');
        }
        
        function handleFixtureSubmit(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const fixtureData = {
                id: 'fix-' + Date.now(),
                date: formData.get('date'),
                time: formData.get('time'),
                leagueId: formData.get('league'),
                league: document.querySelector(`#fixture-league option[value="${formData.get('league')}"]`).textContent,
                homeTeam: document.querySelector(`#fixture-home-team option[value="${formData.get('homeTeam')}"]`).textContent,
                awayTeam: document.querySelector(`#fixture-away-team option[value="${formData.get('awayTeam')}"]`).textContent,
                venueId: formData.get('venue'),
                venue: document.querySelector(`#fixture-venue option[value="${formData.get('venue')}"]`).textContent,
                refereeId: formData.get('referee'),
                referee: formData.get('referee') ? document.querySelector(`#fixture-referee option[value="${formData.get('referee')}"]`).textContent : '',
                status: 'scheduled',
                round: parseInt(formData.get('round')) || 1,
                homeScore: null,
                awayScore: null
            };
            
            // Add to fixtures data
            fixturesData.unshift(fixtureData);
            
            // Refresh display
            applyFilters();
            closeModal();
            
            // Show success message
            alert('Fixture created successfully!');
        }
        
        function editFixture(id) {
            const fixture = fixturesData.find(f => f.id === id);
            if (!fixture) return;
            
            // Populate form with fixture data
            document.getElementById('fixture-league').value = fixture.leagueId;
            document.getElementById('fixture-date').value = fixture.date;
            document.getElementById('fixture-time').value = fixture.time;
            document.getElementById('fixture-venue').value = fixture.venueId;
            document.getElementById('fixture-referee').value = fixture.refereeId;
            document.getElementById('fixture-round').value = fixture.round;
            
            document.getElementById('modal-title').textContent = 'Edit Fixture';
            document.getElementById('save-fixture').textContent = 'Save Changes';
            document.getElementById('fixture-modal').classList.add('active');
        }
        
        function cancelFixture(id) {
            if (confirm('Are you sure you want to cancel this fixture?')) {
                const fixture = fixturesData.find(f => f.id === id);
                if (fixture) {
                    fixture.status = 'cancelled';
                    renderFixtures();
                    alert('Fixture cancelled successfully.');
                }
            }
        }
        
        function viewResult(id) {
            const fixture = fixturesData.find(f => f.id === id);
            if (fixture) {
                alert(`Match Result:\n${fixture.homeTeam} ${fixture.homeScore} - ${fixture.awayScore} ${fixture.awayTeam}`);
            }
        }
        
        function enterResult(id) {
            const fixture = fixturesData.find(f => f.id === id);
            if (fixture) {
                const homeScore = prompt(`Enter home team score for ${fixture.homeTeam}:`);
                const awayScore = prompt(`Enter away team score for ${fixture.awayTeam}:`);
                
                if (homeScore !== null && awayScore !== null) {
                    fixture.homeScore = parseInt(homeScore);
                    fixture.awayScore = parseInt(awayScore);
                    fixture.status = 'completed';
                    renderFixtures();
                    alert('Result recorded successfully!');
                }
            }
        }
        
        function exportFixtures() {
            // Mock export functionality
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Date,Time,League,Home Team,Away Team,Venue,Referee,Status\n" +
                filteredFixtures.map(f => 
                    `${f.date},${f.time},${f.league},${f.homeTeam},${f.awayTeam},${f.venue},${f.referee},${f.status}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "fixtures.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Fixtures exported successfully!');
        }
        
        function generateFixtures() {
            if (confirm('This will generate fixtures for all active leagues. Continue?')) {
                // Mock generation - in real app this would call backend
                alert('Fixture generation started. This may take a few moments...');
                
                setTimeout(() => {
                    alert('Fixtures generated successfully for all active leagues!');
                    refreshFixtures();
                }, 2000);
            }
        }
        
        // Contact Teams Dialog Functions
        function openContactTeamsDialog() {
            // Use the same filtering logic as updateActionCounts for consistency
            const sixDaysFromNow = new Date();
            sixDaysFromNow.setDate(sixDaysFromNow.getDate() + 6);
            
            const awaitingFixtures = fixturesData.filter(fixture => {
                const fixtureDate = new Date(fixture.date);
                return fixture.status === 'awaiting-approval' &&
                       fixtureDate <= sixDaysFromNow &&
                       fixtureDate >= new Date() &&
                       (!fixture.homeTeamApproved || !fixture.awayTeamApproved);
            });
            
            const listContainer = document.getElementById('awaiting-fixtures-list');
            
            if (awaitingFixtures.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px;">No fixtures currently awaiting approval.</p>';
            } else {
                listContainer.innerHTML = awaitingFixtures.map(fixture => {
                    const homeApproved = fixture.homeTeamApproved;
                    const awayApproved = fixture.awayTeamApproved;
                    
                    return `
                        <div class="fixture-contact-item">
                            <div class="fixture-contact-layout">
                                ${homeApproved ? '<span class="contact-emoji" style="visibility: hidden;">ðŸ“§</span>' : `<span class="contact-emoji" onclick="openEmailDialog('${fixture.id}', 'home')" title="Contact ${fixture.homeTeam}">ðŸ“§</span>`}
                                <span class="status-emoji" title="${homeApproved ? 'Approved' : 'Awaiting Approval'}">${homeApproved ? 'âœ…' : 'âš ï¸'}</span>
                                <span class="team-name">${fixture.homeTeam}</span>
                                <span class="vs-separator">v</span>
                                <span class="team-name">${fixture.awayTeam}</span>
                                <span class="status-emoji" title="${awayApproved ? 'Approved' : 'Awaiting Approval'}">${awayApproved ? 'âœ…' : 'âš ï¸'}</span>
                                ${awayApproved ? '<span class="contact-emoji" style="visibility: hidden;">ðŸ“§</span>' : `<span class="contact-emoji" onclick="openEmailDialog('${fixture.id}', 'away')" title="Contact ${fixture.awayTeam}">ðŸ“§</span>`}
                            </div>
                            <div class="fixture-details">
                                ${new Date(fixture.date).toLocaleDateString()}<br>
                                ${fixture.time} - ${fixture.venue}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            document.getElementById('contact-teams-modal').classList.add('active');
        }
        
        function closeContactTeamsDialog() {
            document.getElementById('contact-teams-modal').classList.remove('active');
        }
        
        function openEmailDialog(fixtureId, teamType) {
            const fixture = fixturesData.find(f => f.id === fixtureId);
            if (!fixture) return;
            
            const isHome = teamType === 'home';
            const teamName = isHome ? fixture.homeTeam : fixture.awayTeam;
            const teamEmail = isHome ? fixture.homeTeamEmail : fixture.awayTeamEmail;
            const opposingTeam = isHome ? fixture.awayTeam : fixture.homeTeam;
            
            const emailContent = generateConfirmationEmail(fixture, teamName, opposingTeam);
            
            document.getElementById('email-preview').innerHTML = emailContent;
            document.getElementById('email-dialog').classList.remove('hidden');
            
            // Store current context for sending
            window.currentEmailContext = {
                fixtureId: fixtureId,
                teamType: teamType,
                teamEmail: teamEmail,
                teamName: teamName
            };
        }
        
        function closeEmailDialog() {
            document.getElementById('email-dialog').classList.add('hidden');
            window.currentEmailContext = null;
        }
        
        function generateConfirmationEmail(fixture, teamName, opposingTeam) {
            const approvalLink = `mailto:league@5ivetrackr.com?subject=Fixture%20Approval%20-%20${encodeURIComponent(fixture.id)}&body=APPROVE`;
            const declineLink = `mailto:league@5ivetrackr.com?subject=Fixture%20Decline%20-%20${encodeURIComponent(fixture.id)}&body=DECLINE`;
            
            return `
                <div class="email-header"> data-user-email
                    <div class="email-field"> data-user-email
                        <span class="email-field-label"> data-user-emailTo:</span>
                        <span class="email-field-value"> data-user-email${window.currentEmailContext?.teamEmail || 'team@example.com'}</span>
                    </div>
                    <div class="email-field"> data-user-email
                        <span class="email-field-label"> data-user-emailFrom:</span>
                        <span class="email-field-value"> data-user-emailleague@5ivetrackr.com</span>
                    </div>
                    <div class="email-field"> data-user-email
                        <span class="email-field-label"> data-user-emailSubject:</span>
                        <span class="email-field-value"> data-user-emailFixture Confirmation Required - ${fixture.homeTeam} vs ${fixture.awayTeam}</span>
                    </div>
                </div>
                
                <div class="email-body"> data-user-email
                    <p>Dear ${teamName} Team Manager,</p>
                    
                    <p>You have a fixture that requires your confirmation:</p>
                    
                    <p><strong>Match Details:</strong><br>
                    ðŸ† <strong>League:</strong> ${fixture.league}<br>
                    âš½ <strong>Teams:</strong> ${fixture.homeTeam} vs ${fixture.awayTeam}<br>
                    ðŸ“… <strong>Date:</strong> ${new Date(fixture.date).toLocaleDateString()}<br>
                    ðŸ• <strong>Time:</strong> ${fixture.time}<br>
                    ðŸ“ <strong>Venue:</strong> ${fixture.venue}</p>
                    
                    <p>Please confirm your team's participation by clicking one of the buttons below:</p>
                    
                    <div class="confirmation-buttons">
                        <a href="https://5ivetrackr.com/confirm-fixture?id=${fixture.id}&team=${teamName}&action=approve&token=abc123" 
                           class="confirm-btn approve" 
                           onclick="handleFixtureResponse('${fixture.id}', '${window.currentEmailContext?.teamType}', 'approve')">
                           âœ… CONFIRM PARTICIPATION
                        </a>
                        <a href="https://5ivetrackr.com/confirm-fixture?id=${fixture.id}&team=${teamName}&action=decline&token=abc123" 
                           class="confirm-btn decline"
                           onclick="handleFixtureResponse('${fixture.id}', '${window.currentEmailContext?.teamType}', 'decline')">
                           âŒ DECLINE FIXTURE
                        </a>
                    </div>
                    
                    <p style="margin-top: 20px; font-size: 12px; color: #6b7280;">
                        If the buttons above don't work, you can reply to this email with "APPROVE" or "DECLINE" in the subject line.
                    </p>
                    
                    <p>Thank you,<br>
                    5ive Trackr League Management</p>
                </div>
            `;
        }
        
        function sendConfirmationEmail() {
            if (!window.currentEmailContext) return;
            
            const { teamEmail, teamName, fixtureId } = window.currentEmailContext;
            const fixture = fixturesData.find(f => f.id === fixtureId);
            
            // Create mailto link with the email content
            const subject = `Fixture Confirmation Required - ${fixture.homeTeam} vs ${fixture.awayTeam}`;
            const body = `Dear ${teamName} Team Manager,

You have a fixture that requires your confirmation:

Match Details:
ðŸ† League: ${fixture.league}
âš½ Teams: ${fixture.homeTeam} vs ${fixture.awayTeam}
ðŸ“… Date: ${new Date(fixture.date).toLocaleDateString()}
ðŸ• Time: ${fixture.time}
ðŸ“ Venue: ${fixture.venue}

To confirm your participation, please visit:
https://5ivetrackr.com/confirm-fixture?id=${fixture.id}&team=${encodeURIComponent(teamName)}&action=approve&token=abc123

To decline this fixture, please visit:
https://5ivetrackr.com/confirm-fixture?id=${fixture.id}&team=${encodeURIComponent(teamName)}&action=decline&token=abc123

Alternatively, reply to this email with "APPROVE" or "DECLINE" in the subject line.

Thank you,
5ive Trackr League Management`;

            const mailtoLink = `mailto:${teamEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Open email client
            window.location.href = mailtoLink;
            
            // Close the dialog
            closeEmailDialog();
            
            // Show confirmation
            alert(`Email prepared for ${teamName}. Your default email client should open with the confirmation email ready to send.`);
        }
        
        function handleFixtureResponse(fixtureId, teamType, action) {
            const fixture = fixturesData.find(f => f.id === fixtureId);
            if (!fixture) return;
            
            const isApproval = action === 'approve';
            
            if (teamType === 'home') {
                fixture.homeTeamApproved = isApproval;
            } else {
                fixture.awayTeamApproved = isApproval;
            }
            
            // If both teams approved, change status to confirmed
            if (fixture.homeTeamApproved && fixture.awayTeamApproved) {
                fixture.status = 'confirmed';
            } else if (!isApproval) {
                fixture.status = 'cancelled';
            }
            
            // Update the UI
            updateActionCounts();
            renderFixtures();
            
            // Refresh contact dialog if open
            if (document.getElementById('contact-teams-modal').classList.contains('active')) {
                openContactTeamsDialog();
            }
            
            const teamName = teamType === 'home' ? fixture.homeTeam : fixture.awayTeam;
            alert(`${teamName} has ${isApproval ? 'approved' : 'declined'} the fixture.`);
        }
    </script>
</body>
</html>


