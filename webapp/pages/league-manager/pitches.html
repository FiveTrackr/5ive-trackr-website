<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitches - 5ive Trackr</title>
    <meta name="author" content="5ive Trackr">
    <meta name="copyright" content="Â© 2025 5ive Trackr. All rights reserved.">
    <meta name="robots" content="noarchive, noimageindex">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    
    <!-- Mobile Detection & Redirect - Load First -->
    <script src="../../js/mobile-redirect-config.js?v=<?php echo time(); ?>"></script>
    <script src="../../js/mobile-redirect.js?v=<?php echo time(); ?>"></script>
    
    <!-- Authentication System -->
    <script src="../../js/core/auth.js"></script>
    <script src="../../js/core/session-manager.js"></script>
    <script src="../../js/core/session-protection.js"></script>
    <script src="../../js/core/user-data-manager.js"></script>
    <script src="../../js/core/file-data-manager.js"></script>
    <script src="../../js/core/venue-selector.js"></script>
    
    <!-- Consolidated Dashboard Master CSS -->
    <link rel="stylesheet" href="../../css/dashboard-master.css?v=consolidated-2025">
    <style>
    /* Safe system font stack - no external dependencies */
    body, * {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, Roboto, "Noto Sans", "Liberation Sans", sans-serif;
    }
</style>
    <!-- League Manager Sidebar Styles - Load immediately to prevent layout shifts -->
    <link rel="stylesheet" href="../../css/league-manager-sidebar.css">
    <!-- League Manager Header Styles - Load immediately to prevent layout shifts -->
    <link rel="stylesheet" href="../../css/league-manager-header.css">
    
    <style>
        /* Header Template Styles */
        .main-header[data-loaded="league-manager"] {
            background-color: #ffffff !important;
            border-radius: 0 0 12px 12px !important;
            padding: 16px 24px !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            width: calc(100% - 250px) !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            position: fixed !important;
            top: 0 !important;
            left: 250px !important;
            z-index: 999 !important;
            height: 70px !important;
            box-sizing: border-box !important;
        }

        /* Notifications Button Styling */
        .notifications-btn {
            position: relative;
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc2626;
            color: white;
            border-radius: 50%;
            padding: 0;
            font-size: 10px;
            font-weight: 600;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }

        .notification-badge.hidden {
            display: none;
        }

        /* Notifications Panel Styling */
        .notifications-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 400px;
            max-width: 90vw;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1001;
            max-height: 70vh;
            display: none;
            flex-direction: column;
            border: 1px solid #e0e0e0;
        }

        .notifications-panel.active {
            display: flex;
        }

        .notifications-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }

        .notifications-overlay.active {
            display: block;
        }

        .notifications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }

        .notifications-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .notifications-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mark-all-read {
            color: #2e6417;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }

        .mark-all-read:hover {
            text-decoration: underline;
        }

        .close-panel {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-panel:hover {
            color: #333;
        }

        .notifications-content {
            flex: 1;
            overflow-y: auto;
            max-height: calc(70vh - 80px);
        }

        .notifications-list {
            padding: 8px 0;
        }

        /* Pitches Page Specific Styles */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f3f4f6;
        }
        
        .page-title-section {
            flex: 1;
        }
        
        .page-title, .content-title {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0 0 4px 0;
        }
        
        .page-subtitle {
            color: #6b7280;
            font-size: 16px;
            margin: 0;
        }
        
        .page-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            text-decoration: none;
            font-family: 'Inter', sans-serif;
        }
        
        .btn-primary {
            background-color: #2e6417;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1e4009;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background-color: #e9ecef;
        }
        
        .btn-icon {
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
        }
        
        /* Professional CSS Icons */
        .btn-icon.icon-export::before {
            content: "ðŸ“‹";
            font-style: normal;
        }
        
        .btn-icon.icon-create::before {
            content: "ï¼‹";
            font-style: normal;
            font-weight: bold;
        }
        
        /* Enhanced Primary Button */
        .btn-primary {
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            border: none;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1e4009 0%, #2e6417 100%);
            box-shadow: 0 4px 8px rgba(46, 100, 23, 0.3);
            transform: translateY(-2px);
        }
        
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2);
        }
        
        /* Enhanced Secondary Button */
        .btn-secondary:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary:active {
            transform: translateY(0);
            box-shadow: none;
        }
        
        /* Danger Button */
        .btn-danger {
            background-color: #dc2626;
            color: white;
            border: none;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }
        
        .btn-danger:hover {
            background-color: #b91c1c;
            box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);
            transform: translateY(-1px);
        }
        
        .btn-danger:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }
        
        /* Subscription Banner */
        .subscription-banner {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .subscription-info {
            flex: 1;
        }
        
        .subscription-details {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .subscription-tier {
            background: #2e6417;
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .pitch-count {
            color: #6b7280;
            font-weight: 500;
        }
        
        .progress-bar {
            width: 200px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2e6417 0%, #10b981 100%);
            transition: width 0.3s ease;
        }
        
        .upgrade-btn {
            background: transparent;
            color: #2e6417;
            border: 1px solid #2e6417;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .upgrade-btn:hover {
            background: #2e6417;
            color: white;
        }
        
        /* Pitches Grid */
        .pitches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        /* Loading state for pitches */
        .pitches-loading {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            background: #f8f9fa;
            border-radius: 16px;
            border: 2px dashed #dee2e6;
        }
        
        .loading-content {
            text-align: center;
            color: #2e6417;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 3px solid rgba(46, 100, 23, 0.2);
            border-top: 3px solid #2e6417;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-content p {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #2e6417;
        }
        
        /* Pitch Card */
        .pitch-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: grid;
            grid-template-rows: 1fr auto;
            min-height: 400px;
        }
        
        .pitch-card:hover {
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .pitch-main-content {
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .pitch-calendar-section {
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
        }
        
        /* Calendar Container */
        .calendar-container {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
            flex: 1;
            margin-bottom: 16px;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 180px;
            padding: 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.5);
        }
        
        .calendar-grid::-webkit-scrollbar {
            width: 6px;
        }
        
        .calendar-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .calendar-grid::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .calendar-grid::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .calendar-day {
            width: 100%;
            height: 42px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border: 1px solid transparent;
            margin: 1px;
        }
        
        .calendar-day.unavailable {
            background: #f3f4f6;
            color: #9ca3af;
        }
        
        .calendar-day.available {
            background: #d1fae5;
            color: #047857;
            border-color: #10b981;
        }
        
        .calendar-day.booked {
            background: #fed7aa;
            color: #ea580c;
            border-color: #fb923c;
        }
        
        .calendar-day.today {
            box-shadow: 0 0 0 2px #2e6417;
        }
        
        .calendar-day:hover:not(.unavailable) {
            transform: scale(1.03);
            z-index: 10;
        }
        
        .day-number {
            font-weight: 700;
            margin-bottom: 1px;
            font-size: 9px;
        }
        
        .day-name {
            font-size: 7px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        /* Tooltip for kick-off times */
        .calendar-day .tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #374151;
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 20;
            margin-top: 6px;
            font-weight: 500;
        }
        
        .calendar-day .tooltip::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-bottom-color: #374151;
        }
        
        .calendar-day:hover .tooltip {
            opacity: 1;
            transition-delay: 0.5s;
        }
        
        .calendar-day:not(:hover) .tooltip {
            transition-delay: 0s;
        }
        
        /* Special positioning for top rows to show tooltip below */
        .calendar-day .tooltip {
            top: 100%;
            margin-top: 6px;
        }
        
        .calendar-day .tooltip::before {
            bottom: 100%;
            border-bottom-color: #374151;
            border-top-color: transparent;
        }
        
        .calendar-legend {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 9px;
            color: #6b7280;
        }
        
        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .legend-dot.unavailable {
            background: #9ca3af;
        }
        
        .legend-dot.available {
            background: #10b981;
        }
        
        .legend-dot.booked {
            background: #fb923c;
        }
        
        .pitch-header {
            padding: 16px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pitch-name {
            font-size: 18px;
            font-weight: 700;
            color: #374151;
            margin: 0;
        }
        
        .pitch-header-btn {
            background: transparent;
            color: #9ca3af;
            border: 1px solid #e5e7eb;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pitch-header-btn:hover {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
        }
        
        /* Football Pitch Graphic - SVG Based */
        .pitch-graphic {
            position: relative;
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            margin: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pitch-svg {
            width: 90%;
            height: 85%;
            object-fit: contain;
        }
        
        /* Pitch Info */
        .pitch-info {
            padding: 20px;
        }
        
        .pitch-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0;
            margin-bottom: 20px;
            padding: 0 4px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0;
        }
        
        .detail-value {
            font-size: 14px;
            color: #374151;
            font-weight: 600;
            text-align: right;
            max-width: 60%;
            line-height: 1.3;
        }
        
        .pitch-actions {
            display: none;
        }
        
        .btn-edit {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-edit:hover {
            background: #d97706;
        }
        
        .btn-delete {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-delete:hover {
            background: #dc2626;
        }
        
        /* Add Pitch Card */
        .add-pitch-card {
            background: #f8f9fa;
            border: 2px dashed #d1d5db;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .add-pitch-card:hover {
            border-color: #2e6417;
            background: #f0f9ff;
        }
        
        .add-pitch-icon {
            font-size: 48px;
            color: #9ca3af;
            margin-bottom: 12px;
        }
        
        .add-pitch-card:hover .add-pitch-icon {
            color: #2e6417;
        }
        
        .add-pitch-text {
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
        }
        
        .add-pitch-card:hover .add-pitch-text {
            color: #2e6417;
        }
        
        .add-pitch-subtitle {
            font-size: 14px;
            color: #9ca3af;
            margin-top: 4px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .pitches-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .subscription-banner {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }
            
            .subscription-details {
                justify-content: center;
            }
            
            .pitch-details {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .detail-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            
            .detail-value {
                max-width: 100%;
                text-align: left;
            }
            
            .controls-panel {
                min-width: 250px;
                padding: 16px;
            }
        }
        
        /* Day View Modal */
        .day-view-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        
        .day-view-modal.active {
            display: flex;
        }
        
        .day-view-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .day-view-header {
            padding: 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .day-view-title {
            font-size: 20px;
            font-weight: 700;
            color: #374151;
            margin: 0;
        }
        
        .day-view-date {
            font-size: 14px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s;
        }
        
        .close-modal:hover {
            color: #374151;
        }
        
        .day-view-body {
            padding: 24px;
        }
        
        .fixtures-section {
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-indicator.booked {
            background: #fb923c;
        }
        
        .status-indicator.available {
            background: #10b981;
        }
        
        .fixture-item {
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 12px;
            border-left: 4px solid #e5e7eb;
        }
        
        .fixture-item.confirmed {
            border-left-color: #10b981;
        }
        
        .fixture-item.pending {
            border-left-color: #f59e0b;
        }
        
        .fixture-item.unconfirmed {
            border-left-color: #ef4444;
        }
        
        .fixture-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .fixture-time {
            font-weight: 700;
            color: #374151;
            font-size: 16px;
        }
        
        .fixture-type {
            background: #e5e7eb;
            color: #6b7280;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .fixture-type.friendly {
            background: #e0f2fe;
            color: #0369a1;
        }
        
        .fixture-type.league {
            background: #f0fdf4;
            color: #15803d;
        }
        
        .fixture-teams {
            margin: 8px 0;
        }
        
        .team-matchup {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }
        
        .league-info {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
        }
        
        .confirmation-status {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .team-status {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        .team-status.confirmed {
            background: #d1fae5;
            color: #047857;
        }
        
        .team-status.pending {
            background: #fef3c7;
            color: #d97706;
        }
        
        .status-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-icon.confirmed {
            background: #10b981;
        }
        
        .status-icon.pending {
            background: #f59e0b;
        }
        
        .fixture-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .fixture-status.booked {
            background: #fed7aa;
            color: #ea580c;
        }
        
        .fixture-status.available {
            background: #d1fae5;
            color: #047857;
        }
        
        .no-fixtures {
            text-align: center;
            color: #9ca3af;
            font-style: italic;
            padding: 20px;
        }

        /* General Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 0 24px;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }
        
        .modal-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
            margin: 0;
        }
        
        .modal-body {
            padding: 0 24px 24px 24px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            padding: 20px 24px 24px 24px;
            border-top: 1px solid #e5e7eb;
        }
        
        .modal-footer-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }
        

        
        /* Form Styles */
        .form-row {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
            box-sizing: border-box;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2e6417;
            box-shadow: 0 0 0 3px rgba(46, 100, 23, 0.1);
        }
        
        .checkbox-group {
            margin-top: 8px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 400;
            cursor: pointer;
        }
        
        .checkbox-label input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        /* Multiple Pitches Styles */
        .multiple-pitches-toggle {
            margin-bottom: 16px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .multiple-options {
            padding: 16px;
            background: #f9fafb;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            margin-top: 12px;
        }
        
        .duplicate-settings {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }
        
        .duplicate-settings .checkbox-label {
            padding: 6px 0;
        }
        
        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .day-checkbox {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .day-checkbox:hover {
            background: #f9fafb;
        }
        
        .day-checkbox input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .day-checkbox input[type="checkbox"]:checked + .day-name {
            color: #2e6417;
            font-weight: 600;
        }
        
        .day-name {
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
        }
        
        .times-input {
            position: relative;
        }
        
        .form-hint {
            display: block;
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        /* Kick-off Times Styles */
        .kickoff-times-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        #selected-times {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 40px;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: #f9fafb;
        }
        
        #selected-times:empty::before {
            content: "No kick-off times selected";
            color: #9ca3af;
            font-style: italic;
        }
        
        .time-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #2e6417;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .time-chip .remove-time {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            margin: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .time-chip .remove-time:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .add-time-section {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }
        
        .time-selectors {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            flex: 1;
        }
        
        .time-selector-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .time-selector-group label {
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            margin: 0;
        }
        
        .time-separator {
            font-size: 20px;
            font-weight: bold;
            color: #374151;
            padding-bottom: 2px;
            margin: 0 4px;
        }
        
        .time-dropdown {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: white;
            min-width: 70px;
        }
        
        .time-dropdown:focus {
            outline: none;
            border-color: #2e6417;
            box-shadow: 0 0 0 3px rgba(46, 100, 23, 0.1);
        }
        
        .time-dropdown:disabled {
            background-color: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        .add-time-btn {
            padding: 10px 16px;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        /* Upgrade Modal Styles */
        .upgrade-content {
            max-width: 100%;
        }
        
        .current-plan {
            background: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }
        
        .current-plan h4 {
            margin: 0 0 8px 0;
            color: #111827;
        }
        
        .current-plan p {
            margin: 0;
            color: #6b7280;
        }
        
        .plan-name {
            color: #2e6417;
            font-weight: 700;
        }
        
        .upgrade-options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .plan-option {
            flex: 1;
            min-width: 250px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            position: relative;
            transition: all 0.3s;
        }
        
        .plan-option:hover {
            border-color: #2e6417;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(46, 100, 23, 0.1);
        }
        
        .plan-option.recommended {
            border-color: #2e6417;
            background: linear-gradient(135deg, #f0f7ed 0%, #ffffff 100%);
        }
        
        .plan-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #2e6417;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .plan-header {
            margin-bottom: 16px;
        }
        
        .plan-header h5 {
            margin: 0 0 8px 0;
            font-size: 18px;
            color: #111827;
        }
        
        .plan-price {
            font-size: 24px;
            font-weight: 700;
            color: #2e6417;
        }
        
        .plan-features {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
        }
        
        .plan-features li {
            padding: 6px 0;
            color: #6b7280;
            position: relative;
            padding-left: 20px;
        }
        
        .plan-features li::before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #16a34a;
            font-weight: bold;
        }

        /* Delete Confirmation Modal Styles */
        .delete-warning {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 24px;
        }

        .warning-icon {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            background: #fef2f2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #dc2626;
        }

        .warning-content {
            flex: 1;
        }

        .warning-content h4 {
            margin: 0 0 12px 0;
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }

        .warning-text {
            margin: 0 0 16px 0;
            color: #6b7280;
            font-size: 14px;
            line-height: 1.5;
        }

        .consequences-list {
            list-style: none;
            padding: 0;
            margin: 0 0 16px 0;
        }

        .consequences-list li {
            padding: 6px 0;
            font-size: 14px;
            color: #374151;
            position: relative;
            padding-left: 20px;
        }

        .consequences-list li:before {
            content: "â€¢";
            color: #dc2626;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .impact-notice {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 12px;
            font-size: 13px;
            color: #92400e;
        }

        .impact-notice strong {
            color: #78350f;
        }

        #delete-confirmation-modal .btn-danger {
            background: #dc2626;
            border: 1px solid #dc2626;
            color: white;
        }

        #delete-confirmation-modal .btn-danger:hover {
            background: #b91c1c;
            border-color: #b91c1c;
        }

        /* Individual Pitches Section Styles */
        .section-header {
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .section-header h4 {
            margin: 0 0 4px 0;
            font-size: 16px;
            font-weight: 600;
            color: #111827;
        }

        .section-description {
            margin: 0;
            font-size: 14px;
            color: #6b7280;
        }

        .individual-pitch-entry {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .individual-pitch-entry h5 {
            margin: 0 0 16px 0;
            font-size: 15px;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pitch-number {
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .individual-pitch-entry .form-row {
            margin-bottom: 12px;
        }

        .individual-pitch-entry .form-group {
            margin-bottom: 12px;
        }

        .individual-pitch-entry .days-grid {
            margin-top: 8px;
        }

        .individual-pitch-entry .kickoff-times-container {
            margin-top: 8px;
        }

        .conditional-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
        }

        .conditional-section label {
            font-size: 13px;
            color: #6b7280;
        }
        
        /* Professional Validation Tooltip */
        .validation-tooltip {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            min-width: 280px;
            max-width: 400px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            animation: tooltipFadeIn 0.2s ease-out;
        }
        
        .validation-tooltip::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #ffffff;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .tooltip-header {
            background: #f8fafc;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tooltip-icon {
            font-size: 16px;
            opacity: 0.8;
        }
        
        .tooltip-title {
            font-weight: 600;
            font-size: 14px;
            color: #374151;
        }
        
        .tooltip-content {
            padding: 16px;
        }
        
        .tooltip-subtitle {
            margin: 0 0 12px 0;
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .tooltip-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        
        .tooltip-list li {
            padding: 6px 0;
            font-size: 13px;
            color: #374151;
            position: relative;
            padding-left: 20px;
        }
        
        .tooltip-list li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: #f59e0b;
            font-weight: bold;
            font-size: 16px;
            line-height: 1;
        }
        
        .tooltip-list li:last-child {
            padding-bottom: 0;
        }
        
        @keyframes tooltipFadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-100%) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(-100%) scale(1);
            }
        }

        /* Export Modal Styles */
        .export-modal {
            max-width: 650px;
            width: 95%;
            max-height: 90vh;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .export-modal .modal-header {
            background: linear-gradient(135deg, #ff6b35 0%, #e85a2b 100%);
            color: white;
            padding: 20px 24px;
            border-bottom: none;
            position: relative;
        }

        .export-modal .modal-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .export-modal .modal-header h2::before {
            content: 'ðŸ“Š';
            font-size: 24px;
        }

        .export-modal .close-btn {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .export-modal .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .export-modal .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: #ffffff;
        }

        .export-modal .modal-footer {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .export-section {
            margin-bottom: 28px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .export-section:last-child {
            margin-bottom: 0;
        }

        .export-section h3 {
            margin: 0 0 18px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-section h3::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #ff6b35, #e85a2b);
            border-radius: 2px;
        }

        .pitch-selection-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            background: #ffffff;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-small:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        .pitch-selection-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            max-height: 240px;
            overflow-y: auto;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
        }

        .pitch-selection-checkboxes::-webkit-scrollbar {
            width: 8px;
        }

        .pitch-selection-checkboxes::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        .pitch-selection-checkboxes::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .pitch-selection-checkboxes::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .checkbox-option:hover {
            background: #f1f5f9;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
        }

        .checkbox-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
            cursor: pointer;
            accent-color: #ff6b35;
        }

        .checkbox-text {
            font-size: 14px;
            color: #374151;
            font-weight: 500;
        }

        .date-range-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 16px;
            background: #ffffff;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .date-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .date-input-group label {
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .date-input-group label::before {
            content: 'ðŸ“…';
            font-size: 16px;
        }

        .date-input {
            padding: 12px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: #ffffff;
        }

        .date-input:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
            transform: translateY(-1px);
        }

        .format-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 16px;
            background: #ffffff;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .format-option {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #ffffff;
            position: relative;
            overflow: hidden;
        }

        .format-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.05), rgba(232, 90, 43, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .format-option:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .format-option:hover::before {
            opacity: 1;
        }

        .format-option input[type="radio"] {
            margin: 4px 0 0 0;
            width: 18px;
            height: 18px;
            accent-color: #ff6b35;
            cursor: pointer;
        }

        .format-option input[type="radio"]:checked + .format-details .format-name {
            color: #ff6b35;
            font-weight: 700;
        }

        .format-option:has(input[type="radio"]:checked) {
            background: linear-gradient(135deg, #fff7ed, #fef3e7);
            border-color: #ff6b35;
            box-shadow: 0 0 0 1px rgba(255, 107, 53, 0.2), 0 4px 12px rgba(255, 107, 53, 0.15);
            transform: translateY(-2px);
        }

        .format-option:has(input[type="radio"]:checked)::before {
            opacity: 1;
        }

        .format-details {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
        }

        .format-name {
            font-weight: 600;
            font-size: 15px;
            color: #1e293b;
            transition: all 0.2s ease;
        }

        .format-description {
            font-size: 13px;
            color: #64748b;
            line-height: 1.5;
        }

        /* Enhanced button styles for export modal */
        .export-modal .btn-primary {
            background: linear-gradient(135deg, #ff6b35 0%, #e85a2b 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(255, 107, 53, 0.2);
        }

        .export-modal .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .export-modal .btn-secondary {
            background: #ffffff;
            color: #64748b;
            border: 1px solid #d1d5db;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .export-modal .btn-secondary:hover {
            background: #f8fafc;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        /* Responsive adjustments for export modal */
        @media (max-width: 768px) {
            .export-modal {
                width: 98%;
                margin: 10px;
                max-height: 95vh;
            }

            .export-modal .modal-header {
                padding: 16px 20px;
            }

            .export-modal .modal-body {
                padding: 20px;
            }

            .export-modal .modal-footer {
                padding: 16px 20px;
                flex-direction: column;
                gap: 12px;
            }

            .export-modal .modal-footer .btn {
                width: 100%;
                justify-content: center;
            }

            .date-range-container {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .pitch-selection-checkboxes {
                grid-template-columns: 1fr;
                max-height: 200px;
            }

            .export-section {
                padding: 16px;
                margin-bottom: 20px;
            }
        }

        /* Venue Selector Styles */
        .venue-selector-container {
            padding: 0 15px 20px 15px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 16px;
            position: relative;
            overflow: visible;
        }

        .venue-selector-btn {
            width: 100% !important;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: none !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2);
            position: relative;
            box-sizing: border-box !important;
            margin: 0 !important;
            user-select: none !important;
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
        }

        .venue-selector-btn:hover {
            transform: none !important;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2) !important;
        }

        .venue-selector-btn:active {
            transform: none !important;
        }

        .venue-selector-content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
        }

        .venue-selector-label {
            font-size: 0.7rem;
            opacity: 0.9;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .venue-selector-name {
            font-size: 0.875rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .venue-selector-icon {
            font-size: 1rem;
            margin-left: 8px;
            transition: none !important;
        }

        .venue-selector-btn.active .venue-selector-icon {
            transform: rotate(180deg) !important;
            transition: none !important;
        }

        .venue-selector-btn.active {
            border-radius: 8px 8px 0 0 !important;
            border-bottom: none !important;
            box-shadow: 0 2px 4px rgba(46, 100, 23, 0.2) !important;
            transition: none !important;
        }

        .venue-dropdown {
            position: absolute;
            top: calc(100% - 1px);
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #2e6417 0%, #1e4009 100%);
            border: none !important;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
            z-index: 9999 !important;
            margin-top: 0;
            transform: none !important;
            transition: none !important;
            display: none;
            max-height: 300px;
            overflow-y: auto;
            color: white;
            outline: none !important;
        }

        .venue-dropdown.show {
            display: block !important;
            transition: none !important;
        }

        /* Venue Selector Overlay - Only darken area outside dropdown */
        .venue-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            z-index: 9998 !important;
            display: none;
            transition: none !important;
        }

        .venue-selector-overlay.show {
            display: block !important;
            transition: none !important;
        }

        .venue-option {
            padding: 12px 16px;
            cursor: pointer;
            transition: none !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
            background: transparent;
        }

        .venue-option:last-child {
            border-bottom: none;
        }

        .venue-option:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            transition: none !important;
        }

        .venue-option.selected {
            background: rgba(255, 255, 255, 0.2) !important;
            color: white;
            font-weight: 700;
            transition: none !important;
        }

        .venue-option-details {
            display: flex;
            flex-direction: column;
        }

        .venue-option-name {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 2px;
            color: white;
        }

        .venue-option-address {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.8);
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .venue-option-check {
            color: white;
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Navigation Icon Fixes */
        body[data-role="league-manager"] .sidebar .nav-icon[data-icon="referee"],
        .sidebar .nav-icon[data-icon="referee"] {
            background-image: url('../../img/referee-icon.svg') !important;
            background-size: 18px 18px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            width: 20px !important;
            height: 20px !important;
            display: inline-block !important;
        }

        body[data-role="league-manager"] .sidebar .nav-icon[data-icon="shirt"],
        .sidebar .nav-icon[data-icon="shirt"] {
            background-image: url('../../img/shirt-icon.svg') !important;
            background-size: 18px 18px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            width: 20px !important;
            height: 20px !important;
            display: inline-block !important;
        }

        /* Navigation Sizing Fix Applied: Consistent padding (14px 20px) for all nav items via league-manager-sidebar.css */
    </style>
    <\!-- SPA Redirect Handler -->
    <script src="../../js/core/spa-redirect.js"></script>
</head>
<body data-page="pitches" data-role="league-manager" class="pitches-page">
    <!-- Sidebar - Static content with dynamic enhancement -->
    <aside class="sidebar">
        <!-- Static sidebar content that loads immediately -->
        <div class="sidebar-header">
            <div class="logo-container">
                <img src="../../img/header-logo.svg" alt="5ive Trackr" class="logo">
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="sidebar-nav">
            <!-- Venue Selector -->
            <div class="venue-selector-container">
                <div class="venue-selector-btn" id="venue-selector-btn" onclick="toggleVenueDropdown()">
                    <div class="venue-selector-content">
                        <div class="venue-selector-label">Current Venue</div>
                        <div class="venue-selector-name" id="selected-venue-name">Loading...</div>
                    </div>
                    <span class="venue-selector-icon">â–¼</span>
                    <div class="venue-dropdown" id="venue-dropdown">
                        <!-- Data will be loaded dynamically based on logged-in user -->
                        <div class="venue-option" data-venue-id="VEN002" onclick="selectVenue('VEN002', 'Elite Sports Center', '456 Championship Drive', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Elite Sports Center</div>
                                <div class="venue-option-address">456 Championship Drive</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <div class="venue-option" data-venue-id="VEN003" onclick="selectVenue('VEN003', 'Premier League Complex', '789 Victory Boulevard', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Premier League Complex</div>
                                <div class="venue-option-address">789 Victory Boulevard</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <div class="venue-option" data-venue-id="VEN001" onclick="selectVenue('VEN001', 'Sports Arena West', '123 Athletic Avenue', event)">
                            <div class="venue-option-details">
                                <div class="venue-option-name">Sports Arena West</div>
                                <div class="venue-option-address">123 Athletic Avenue</div>
                            </div>
                            <span class="venue-option-check" style="display: none;">âœ“</span>
                        </div>
                        <!-- END MOCK DATA -->
                    </div>
                </div>
            </div>

            <!-- Venue Selector Overlay -->
            <div class="venue-selector-overlay" id="venue-selector-overlay" onclick="closeVenueDropdown()"></div>

            <ul class="nav-menu">
                <li class="nav-item" data-page="dashboard">
                    <a href="dashboard.html" class="nav-link">
                        <span class="nav-icon">ðŸ“Š</span>
                        <span class="link-text">Dashboard</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="fixtures">
                    <a href="fixtures.html" class="nav-link">
                        <span class="nav-icon">ðŸ“…</span>
                        <span class="link-text">Fixtures</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="referees">
                    <a href="referees.html" class="nav-link">
                        <span class="nav-icon" data-icon="referee"></span>
                        <span class="link-text">Referees</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="divisions">
                    <a href="divisions.html" class="nav-link">
                        <span class="nav-icon">ðŸ“‹</span>
                        <span class="link-text">Divisions</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="leagues">
                    <a href="leagues.html" class="nav-link">
                        <span class="nav-icon">ðŸ†</span>
                        <span class="link-text">Leagues</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="teams">
                    <a href="teams.html" class="nav-link">
                        <span class="nav-icon" data-icon="shirt"></span>
                        <span class="link-text">Teams</span>
                    </a>
                </li>
                
                <li class="nav-item active" data-page="pitches">
                    <a href="pitches.html" class="nav-link">
                        <span class="nav-icon">ðŸ¥…</span>
                        <span class="link-text">Pitches</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="venues">
                    <a href="venues.html" class="nav-link">
                        <span class="nav-icon">ðŸŸï¸</span>
                        <span class="link-text">Venues</span>
                    </a>
                </li>
                
                <li class="nav-item" data-page="payments">
                    <a href="team-payments.html" class="nav-link">
                        <span class="nav-icon">ðŸ’³</span>
                        <span class="link-text">Team Payments</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
            <div class="footer-section footer-actions">
                <a href="settings.html" class="footer-link">
                    <span class="footer-icon">âš™ï¸</span>
                    <span class="footer-text">Settings</span>
                </a>
                <a href="#" class="footer-link" onclick="handleLogout(event)">
                    <span class="footer-icon">ðŸšª</span>
                    <span class="footer-text">Logout</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- League Manager Header Template -->
    <header class="main-header" data-loaded="league-manager">
        <div class="header-left">
            <h1 class="page-title" data-page-title>Pitches</h1>
        </div>

        <div class="header-right">
            <!-- User Info Section -->
            <div class="user-info"> data-user-name
                <div class="user-avatar" data-user-initials> data-user-name--</div>
                <div class="user-details"> data-user-name
                    <div class="user-name" data-user-name> data-user-nameLoading...</div>
                    <div class="user-role" data-user-role> data-user-role data-user-nameLoading...</div>
                </div>
            </div>

            <!-- Header Actions -->
            <div class="header-actions">
                <button class="header-btn notifications-btn" onclick="toggleNotificationsPanel()">
                    <span class="btn-icon">ðŸ””</span>
                    <span class="btn-text">Notifications</span>
                    <span class="notification-badge" id="notification-count">3</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notifications-panel">
        <div class="notifications-header">
            <h3>Notifications</h3>
            <div class="notifications-actions">
                <button class="btn-text mark-all-read" onclick="markAllNotificationsRead()">Mark all as read</button>
                <button class="close-panel" onclick="closeNotificationsPanel()">&times;</button>
            </div>
        </div>
        <div class="notifications-content">
            <div class="notifications-list" id="notifications-list">
                <!-- Notifications will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notifications Panel Overlay -->
    <div class="notifications-overlay" id="notifications-overlay" onclick="closeNotificationsPanel()"></div>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="content-area">
            
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-title-section">
                    <h1 class="content-title">Pitch Management</h1>
                    <p class="page-subtitle">Manage your football pitches, availability and kick-off times</p>
                </div>
                <div class="page-actions">
                    <button class="btn btn-secondary" id="export-pitches" 
                            aria-label="Export pitch data"
                            title="Export pitch information to spreadsheet">
                        <span class="btn-icon icon-export" aria-hidden="true"></span>
                        <span class="btn-text">Export Data</span>
                    </button>
                    <button class="btn btn-primary" id="create-multiple-pitches"
                            onclick="openMultiplePitchesModal()"
                            aria-label="Create multiple pitches"
                            title="Add multiple football pitches at once">
                        <span class="btn-icon icon-create" aria-hidden="true"></span>
                        <span class="btn-text">Add Multiple Pitches</span>
                    </button>
                    <button class="btn btn-primary" id="create-pitch"
                            onclick="showAddPitchDialog()"
                            aria-label="Create new pitch"
                            title="Add a new football pitch">
                        <span class="btn-icon icon-create" aria-hidden="true"></span>
                        <span class="btn-text">Add New Pitch</span>
                    </button>
                </div>
            </div>

            <!-- Subscription Info Banner -->
            <div class="subscription-banner">
                <div class="subscription-info">
                    <div class="subscription-details">
                        <span class="subscription-tier">Premium Plan</span>
                        <span class="pitch-count">3 of 5 pitches used</span>
                    </div>
                    <div class="subscription-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%;"></div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-outline upgrade-btn">Upgrade Plan</button>
            </div>

            <!-- Pitches Grid -->
            <div class="pitches-grid" id="pitches-grid">
                <!-- Loading state -->
                <div class="pitches-loading" id="pitches-loading">
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <p>Loading pitches...</p>
                    </div>
                </div>
                <!-- Pitches will be rendered here -->
            </div>

        </div>
    </main>

    <!-- Day View Modal -->
    <div class="day-view-modal" id="day-view-modal">
        <div class="day-view-content">
            <div class="day-view-header">
                <div>
                    <h3 class="day-view-title" id="modal-pitch-name">Pitch Schedule</h3>
                    <div class="day-view-date" id="modal-date">Selected Date</div>
                </div>
                <button class="close-modal" onclick="closeDayView()">&times;</button>
            </div>
            <div class="day-view-body">
                <div class="fixtures-section">
                    <h4 class="section-title">
                        <span class="status-indicator booked"></span>
                        Booked Fixtures
                    </h4>
                    <div id="booked-fixtures">
                        <!-- Booked fixtures will be rendered here -->
                    </div>
                </div>
                <div class="fixtures-section">
                    <h4 class="section-title">
                        <span class="status-indicator available"></span>
                        Available Time Slots
                    </h4>
                    <div id="available-slots">
                        <!-- Available slots will be rendered here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Pitch Modal -->
    <div class="modal-overlay" id="pitch-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pitch-modal-title">Add New Pitch</h3>
                <button class="close-modal" onclick="closePitchModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pitch-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pitch-name">Pitch Name *</label>
                            <input type="text" id="pitch-name" name="pitchName" required placeholder="e.g., Main Stadium Pitch">
                        </div>
                        <div class="form-group">
                            <label for="pitch-size">Pitch Size *</label>
                            <select id="pitch-size" name="pitchSize" required>
                                <option value="">Select pitch size</option>
                                <option value="5-a-side">5-a-side</option>
                                <option value="6-a-side">6-a-side</option>
                                <option value="7-a-side">7-a-side</option>
                            </select>
                        </div>
                    </div>
                    

                    
                    <div class="form-group">
                        <label>Available Days *</label>
                        <div class="days-grid">
                            <label class="day-checkbox">
                                <input type="checkbox" name="availability" value="monday" checked>
                                <span class="day-name">Mon</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="availability" value="tuesday" checked>
                                <span class="day-name">Tue</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="availability" value="wednesday" checked>
                                <span class="day-name">Wed</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="availability" value="thursday" checked>
                                <span class="day-name">Thu</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="availability" value="friday" checked>
                                <span class="day-name">Fri</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="availability" value="saturday" checked>
                                <span class="day-name">Sat</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="availability" value="sunday" checked>
                                <span class="day-name">Sun</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="kick-off-times">Kick-off Times *</label>
                        <div class="kickoff-times-container">
                            <div id="selected-times">
                                <!-- Selected times will appear here -->
                            </div>
                            <div class="add-time-section">
                                <div class="time-selectors">
                                    <div class="time-selector-group">
                                        <label for="hours-select">Hours</label>
                                        <select id="hours-select" class="time-dropdown">
                                            <option value="">Hour</option>
                                            <!-- Hour options will be populated by JavaScript -->
                                        </select>
                                    </div>
                                    <div class="time-separator">:</div>
                                    <div class="time-selector-group">
                                        <label for="minutes-select">Minutes</label>
                                        <select id="minutes-select" class="time-dropdown">
                                            <option value="">Min</option>
                                            <!-- Minute options will be populated by JavaScript -->
                                        </select>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary add-time-btn" onclick="addKickOffTime()">
                                    Add Time
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closePitchModal()">Cancel</button>
                <div class="modal-footer-actions">
                    <button type="button" id="delete-pitch-btn" class="btn btn-danger" onclick="showDeleteConfirmation()" style="display: none;">
                        Delete Pitch
                    </button>
                    <button type="submit" class="btn btn-primary" onclick="savePitch()">
                        <span id="save-btn-text">Add Pitch</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Multiple Pitches Modal -->
    <div class="modal-overlay" id="multiple-pitches-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Multiple Pitches</h3>
                <button class="close-modal" onclick="closeMultiplePitchesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="multiple-pitches-form">
                    <!-- Step 1: Number of Pitches -->
                    <div class="form-group">
                        <label for="multiple-pitch-count">Select number of Pitches to add *</label>
                        <select id="multiple-pitch-count" name="multiplePitchCount" required onchange="handlePitchCountChange()">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                        <small class="form-hint" id="pitch-limit-info">
                            <!-- Limit information will be shown here -->
                        </small>
                    </div>
                        <!-- Step 2: Duplicate Available Days -->
                        <div class="form-group">
                            <label for="duplicate-days-option">Duplicate available days for all Pitches? *</label>
                            <select id="duplicate-days-option" name="duplicateDays" required onchange="toggleDaysSection()">
                                <option value="">Select option</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        
                        <!-- Available Days (shown immediately if "Yes" selected) -->
                        <div class="form-group" id="duplicate-days-section" style="display: none;">
                            <label>Available Days *</label>
                            <div class="days-grid">
                                <label class="day-checkbox">
                                    <input type="checkbox" name="multiple-availability" value="monday" checked>
                                    <span class="day-name">Mon</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="multiple-availability" value="tuesday" checked>
                                    <span class="day-name">Tue</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="multiple-availability" value="wednesday" checked>
                                    <span class="day-name">Wed</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="multiple-availability" value="thursday" checked>
                                    <span class="day-name">Thu</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="multiple-availability" value="friday" checked>
                                    <span class="day-name">Fri</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="multiple-availability" value="saturday" checked>
                                    <span class="day-name">Sat</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="multiple-availability" value="sunday" checked>
                                    <span class="day-name">Sun</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Step 3: Duplicate Kick-off Times -->
                        <div class="form-group">
                            <label for="duplicate-times-option">Duplicate kick-off times for all Pitches? *</label>
                            <select id="duplicate-times-option" name="duplicateTimes" required onchange="toggleTimesSection()">
                                <option value="">Select option</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        
                        <!-- Kick-off Times (shown immediately if "Yes" selected) -->
                        <div class="form-group" id="duplicate-times-section" style="display: none;">
                            <label for="multiple-kick-off-times">Kick-off Times *</label>
                            <div class="kickoff-times-container">
                                <div id="multiple-selected-times">
                                    <!-- Selected times will appear here -->
                                </div>
                                <div class="add-time-section">
                                    <div class="time-selectors">
                                        <div class="time-selector-group">
                                            <label for="multiple-hours-select">Hours</label>
                                            <select id="multiple-hours-select" class="time-dropdown">
                                                <option value="">Hour</option>
                                                <!-- Hour options will be populated by JavaScript -->
                                            </select>
                                        </div>
                                        <div class="time-separator">:</div>
                                        <div class="time-selector-group">
                                            <label for="multiple-minutes-select">Minutes</label>
                                            <select id="multiple-minutes-select" class="time-dropdown">
                                                <option value="">Min</option>
                                                <!-- Minute options will be populated by JavaScript -->
                                            </select>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-secondary add-time-btn" onclick="addMultipleKickOffTime()">
                                        Add Time
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Individual Pitch Entry Section (shown when count > 1) -->
                        <div id="individual-pitches-section" style="display: none;">
                            <div class="section-header">
                                <h4>Configure Each Pitch</h4>
                                <p class="section-description">Enter the details for each pitch you want to create.</p>
                            </div>
                            <div id="individual-pitch-entries">
                                <!-- Individual pitch entries will be generated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Available Days (shown later if "No" was selected) -->
                    <div class="form-group" id="individual-days-section" style="display: none;">
                        <label>Available Days *</label>
                        <p class="form-hint">You'll be able to set different availability for each pitch individually after creation.</p>
                        <div class="days-grid">
                            <label class="day-checkbox">
                                <input type="checkbox" name="individual-availability" value="monday">
                                <span class="day-name">Mon</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="individual-availability" value="tuesday">
                                <span class="day-name">Tue</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="individual-availability" value="wednesday">
                                <span class="day-name">Wed</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="individual-availability" value="thursday">
                                <span class="day-name">Thu</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="individual-availability" value="friday">
                                <span class="day-name">Fri</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="individual-availability" value="saturday">
                                <span class="day-name">Sat</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" name="individual-availability" value="sunday">
                                <span class="day-name">Sun</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Kick-off Times (shown later if "No" was selected) -->
                    <div class="form-group" id="individual-times-section" style="display: none;">
                        <label for="individual-kick-off-times">Kick-off Times *</label>
                        <p class="form-hint">You'll be able to set different kick-off times for each pitch individually after creation.</p>
                        <div class="kickoff-times-container">
                            <div id="individual-selected-times">
                                <!-- Selected times will appear here -->
                            </div>
                            <div class="add-time-section">
                                <div class="time-selectors">
                                    <div class="time-selector-group">
                                        <label for="individual-hours-select">Hours</label>
                                        <select id="individual-hours-select" class="time-dropdown">
                                            <option value="">Hour</option>
                                            <!-- Hour options will be populated by JavaScript -->
                                        </select>
                                    </div>
                                    <div class="time-separator">:</div>
                                    <div class="time-selector-group">
                                        <label for="individual-minutes-select">Minutes</label>
                                        <select id="individual-minutes-select" class="time-dropdown">
                                            <option value="">Min</option>
                                            <!-- Minute options will be populated by JavaScript -->
                                        </select>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary add-time-btn" onclick="addIndividualKickOffTime()">
                                    Add Time
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Actions at bottom of form -->
                    <div class="form-actions" style="margin-top: 24px; padding: 24px; display: flex; justify-content: flex-end;">
                        <div style="display: inline-flex; gap: 12px;">
                            <button type="button" class="btn btn-secondary" onclick="closeMultiplePitchesModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="create-multiple-pitches-btn" onclick="saveMultiplePitches()" disabled>
                                Create Pitches
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Upgrade Plan Modal -->
    <div class="modal-overlay" id="upgrade-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Upgrade Your Plan</h3>
                <button class="close-modal" onclick="closeUpgradeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upgrade-content">
                    <div class="current-plan">
                        <h4>Current Plan: <span class="plan-name">${currentPlan.charAt(0).toUpperCase() + currentPlan.slice(1)}</span></h4>
                        <p>You're currently using <strong>${pitchesData.length} of ${subscriptionLimits[currentPlan]} pitches</strong></p>
                    </div>
                    
                    <div class="upgrade-options">
                        <div class="plan-option" data-plan="premium">
                            <div class="plan-header">
                                <h5>Premium Plan</h5>
                                <div class="plan-price">Â£29.99/month</div>
                            </div>
                            <ul class="plan-features">
                                <li>Up to 5 pitches</li>
                                <li>Advanced scheduling</li>
                                <li>Match statistics</li>
                                <li>Email notifications</li>
                            </ul>
                            <button class="btn btn-outline" onclick="selectPlan('premium')">
                                ${currentPlan === 'premium' ? 'Current Plan' : 'Upgrade to Premium'}
                            </button>
                        </div>
                        
                        <div class="plan-option recommended" data-plan="professional">
                            <div class="plan-badge">Recommended</div>
                            <div class="plan-header">
                                <h5>Professional Plan</h5>
                                <div class="plan-price">Â£49.99/month</div>
                            </div>
                            <ul class="plan-features">
                                <li>Up to 10 pitches</li>
                                <li>Multi-league support</li>
                                <li>Referee management</li>
                                <li>Advanced analytics</li>
                                <li>Priority support</li>
                            </ul>
                            <button class="btn btn-primary" onclick="selectPlan('professional')">
                                ${currentPlan === 'professional' ? 'Current Plan' : 'Upgrade to Professional'}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeUpgradeModal()">Maybe Later</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="delete-confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="delete-modal-title">Delete Pitch</h3>
                <button class="close-modal" onclick="closeDeleteConfirmationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="delete-warning">
                    <div class="warning-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7v10c0 5.55 3.84 9 8 9s8-3.45 8-9V7l-10-5z"/>
                            <path d="M12 8v4"/>
                            <path d="M12 16h.01"/>
                        </svg>
                    </div>
                    <div class="warning-content">
                        <h4 id="delete-pitch-name">Are you sure you want to delete this pitch?</h4>
                        <p class="warning-text">This action cannot be undone and will permanently remove:</p>
                        <ul class="consequences-list">
                            <li>The pitch from your system</li>
                            <li>All associated bookings and matches</li>
                            <li>All historical data for this pitch</li>
                            <li>Any upcoming scheduled fixtures</li>
                        </ul>
                        <div class="impact-notice">
                            <strong>Note:</strong> Teams and leagues that have matches scheduled on this pitch will need to be reassigned to other venues.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeDeleteConfirmationModal()">Cancel</button>
                <div class="modal-footer-actions">
                    <button type="button" class="btn btn-danger" id="confirm-delete-btn" onclick="confirmPitchDeletion()">
                        Delete Pitch
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div class="modal-overlay" id="export-modal">
        <div class="modal export-modal">
            <div class="modal-header">
                <h2>Export Pitch Data</h2>
                <button type="button" class="close-btn" onclick="closeExportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-section">
                    <h3>Select Pitches</h3>
                    <div class="pitch-selection-controls">
                        <button type="button" class="btn btn-outline btn-small" onclick="selectAllPitches()">Select All</button>
                        <button type="button" class="btn btn-outline btn-small" onclick="deselectAllPitches()">Clear All</button>
                    </div>
                    <div class="pitch-selection-checkboxes" id="pitch-selection-checkboxes">
                        <!-- Checkboxes will be populated dynamically -->
                    </div>
                </div>

                <div class="export-section">
                    <h3>Date Range</h3>
                    <div class="date-range-container">
                        <div class="date-input-group">
                            <label for="export-from-date">From Date:</label>
                            <input type="date" id="export-from-date" class="date-input">
                        </div>
                        <div class="date-input-group">
                            <label for="export-to-date">To Date:</label>
                            <input type="date" id="export-to-date" class="date-input">
                        </div>
                    </div>
                </div>

                <div class="export-section">
                    <h3>File Format</h3>
                    <div class="format-options">
                        <label class="format-option">
                            <input type="radio" name="export-format" value="csv" checked>
                            <div class="format-details">
                                <span class="format-name">CSV (Comma Separated Values)</span>
                                <span class="format-description">Compatible with Excel and Google Sheets</span>
                            </div>
                        </label>
                        <label class="format-option">
                            <input type="radio" name="export-format" value="json">
                            <div class="format-details">
                                <span class="format-name">JSON (JavaScript Object Notation)</span>
                                <span class="format-description">For developers and API integration</span>
                            </div>
                        </label>
                        <label class="format-option">
                            <input type="radio" name="export-format" value="html">
                            <div class="format-details">
                                <span class="format-name">HTML Report</span>
                                <span class="format-description">Professional report for websites and viewing</span>
                            </div>
                        </label>
                        <label class="format-option">
                            <input type="radio" name="export-format" value="xml">
                            <div class="format-details">
                                <span class="format-name">XML (eXtensible Markup Language)</span>
                                <span class="format-description">Universal data exchange format</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeExportModal()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="performExport()">
                    <span>ðŸ“Š Export Data</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Dynamic Template Scripts -->
    <script src="../../js/components/league-manager-sidebar.js?v=<?php echo time(); ?>&fix=2"></script>
    <script src="../../js/components/league-manager-header.js?v=<?php echo time(); ?>&fix=2"></script>
    
    <script>
        // Global logout handler function
        function handleLogout(event) {
            event.preventDefault();
            console.log('Logout requested');
            
            // Use SessionManager if available
            if (window.SessionManager && typeof SessionManager.logout === 'function') {
                SessionManager.logout();
                return;
            }
            
            // Fallback logout logic
            console.log('Performing logout...');
            // Clear any stored authentication data
            localStorage.removeItem('authToken');
            localStorage.removeItem('userEmail');
            sessionStorage.clear();
            
            // Redirect to home page
            window.location.href = '../../home.html';
        }
        
        // Header Template JavaScript Functionality
        // Load user data and update header
        async function loadUserData() {
            try {
                // Check if UserDataManager is available
                if (typeof window.UserDataManager !== 'undefined') {
                    const userData = await window.UserDataManager.load();
                    if (userData && userData.currentUser) {
                        updateUserDisplay(userData.currentUser);
                        return;
                    }
                }
                
                // Try SessionManager if available
                if (typeof window.SessionManager !== 'undefined' && window.SessionManager.isLoggedIn()) {
                    const currentUser = window.SessionManager.getCurrentUser();
                    if (currentUser) {
                        updateUserDisplay(currentUser);
                        return;
                    }
                }
                
                // Fallback: Try to load from localStorage
                const currentUser = localStorage.getItem('currentUser');
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    updateUserDisplay(user);
                    return;
                }
                
                // Final fallback: Use session data or default
                const sessionData = localStorage.getItem('sessionData');
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    if (session.user) {
                        updateUserDisplay(session.user);
                        return;
                    }
                }
                
                // Default fallback data
                updateUserDisplay({
                    name: 'League Manager',
                    role: 'Administrator',
                    initials: 'LM'
                });
                
            } catch (error) {
                console.error('Error loading user data in header template:', error);
                updateUserDisplay({
                    name: 'League Manager',
                    role: 'Administrator', 
                    initials: 'LM'
                });
            }
        }
        
        // Update user display elements
        function updateUserDisplay(user) {
            // Update user name
            const userNameElements = document.querySelectorAll('[data-user-name]');
            userNameElements.forEach(element => {
                const displayName = user.fullName || user.name || user.firstName || user.username || 'League Manager';
                element.textContent = displayName;
            });
            
            // Update user role
            const userRoleElements = document.querySelectorAll('[data-user-role]');
            userRoleElements.forEach(element => {
                let displayRole = user.role || user.userRole || user.accountType || 'Administrator';
                if (displayRole === 'league_manager') {
                    displayRole = 'League Manager';
                } else if (displayRole === 'team_manager') {
                    displayRole = 'Team Manager';
                } else if (displayRole === 'referee') {
                    displayRole = 'Referee';
                } else if (displayRole === 'admin') {
                    displayRole = 'Administrator';
                }
                element.textContent = displayRole;
            });
            
            // Update user initials
            const userInitialsElements = document.querySelectorAll('[data-user-initials]');
            userInitialsElements.forEach(element => {
                const nameForInitials = user.fullName || user.name || user.firstName || user.username || 'League Manager';
                const initials = user.initials || generateInitials(nameForInitials);
                element.textContent = initials;
            });
        }
        
        // Generate initials from name
        function generateInitials(name) {
            if (!name) return 'LM';
            if (name.includes('@')) {
                return 'LM';
            }
            const nameParts = name.trim().split(' ');
            if (nameParts.length === 1) {
                return nameParts[0].substring(0, 2).toUpperCase();
            } else {
                return (nameParts[0].charAt(0) + nameParts[nameParts.length - 1].charAt(0)).toUpperCase();
            }
        }
        
        // Simple Notifications System - Placeholder for future implementation
        function toggleNotificationsPanel() {
            console.log('Notifications panel clicked - feature coming soon');
            alert('Notifications feature coming soon!');
        }

        function closeNotificationsPanel() {
            console.log('Close notifications panel');
        }

        function markAllNotificationsRead() {
            console.log('Mark all notifications as read');
        }

        // Venue Selector JavaScript Functions
        let currentVenueId = null;
        let currentVenueName = null;

        // Data loaded from server based on user permissions`n        const mockVenues = [
            { id: 'VEN001', name: 'Sports Arena West', address: '123 Athletic Avenue' },
            { id: 'VEN002', name: 'Elite Sports Center', address: '456 Championship Drive' },
            { id: 'VEN003', name: 'Premier League Complex', address: '789 Victory Boulevard' }
        ];

        async function initializeVenueSelector() {
            console.log('Initializing venue selector for pitches page');
            
            // Use the centralized VenueSelector
            if (window.VenueSelector) {
                await window.VenueSelector.initialize((venueData) => {
                    console.log('Venue changed, filtering pitches for:', venueData);
                    filterPitchesByVenue(venueData.id);
                });
            }
        }
        
        // Filter pitches by selected venue
        function filterPitchesByVenue(venueId) {
            currentVenueId = venueId;
            console.log(`Filtering pitches for venue: ${venueId}`);
            
            // Re-render pitches grid with filter
            renderPitchesGrid();
        }

        // Old venue selector functions removed - now using centralized VenueSelector class

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('venue-dropdown');
            const btn = document.getElementById('venue-selector-btn');
            const overlay = document.getElementById('venue-selector-overlay');
            
            if (dropdown && btn && overlay &&
                !dropdown.contains(event.target) && 
                !btn.contains(event.target) &&
                !overlay.contains(event.target)) {
                closeVenueDropdown();
            }
        });
        
        // Pitches page initialization
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize venue selector first
            initializeVenueSelector();
            
            // Load user data for header first
            await loadUserData();
            
            console.log('Pitches page loaded');
            
            // Initialize FileDataManager first
            if (typeof FileDataManager !== 'undefined') {
                await FileDataManager.initialize();
                console.log('FileDataManager initialized');
            }
            
            // Check authentication first
            if (typeof SessionManager !== 'undefined') {
                if (!SessionManager.isLoggedIn()) {
                    console.log('User not logged in, redirecting to home');
                    window.location.href = '../../home.html';
                    return;
                }
                console.log('User authenticated:', SessionManager.getCurrentUser().email);
                
                // Initialize pitches functionality after authentication is verified
                await initializePitches();
            }
            
            // UserDataManager is ready for use - no initialization needed
            if (typeof UserDataManager !== 'undefined') {
                console.log('UserDataManager available for data persistence');
            }
            
            // Auto-refresh disabled to prevent UI jitter
            // Listen for file data refresh events
            // document.addEventListener('fileDataRefreshed', async function(event) {
            //     if (event.detail.type === 'userData') {
            //         console.log('Data file was updated by another source, refreshing UI...');
            //         // Reload pitches data and refresh the grid
            //         await loadPitchesData();
            //         renderPitchesGrid();
            //     }
            // });
            
            // Listen for sidebar load completion
            document.addEventListener('sidebarLoaded', function(e) {
                console.log('Dynamic sidebar loaded successfully:', e.detail);
                
                // Set active page for pitches
                if (window.leagueManagerSidebar) {
                    setTimeout(() => {
                        window.leagueManagerSidebar.setActive('pitches');
                        console.log('Pitches set as active');
                    }, 100);
                }
            });
            
            // Listen for header load completion
            document.addEventListener('headerLoaded', function(e) {
                console.log('Dynamic header loaded successfully:', e.detail);
                
                // Update header page title for pitches
                if (window.leagueManagerHeader) {
                    setTimeout(() => {
                        window.leagueManagerHeader.updatePageTitle('pitches');
                        console.log('Header title set to Pitches');
                    }, 100);
                }
            });
        });
        
        async function initializePitches() {
            console.log('Pitches functionality initialized');
            
            // Load pitches data
            await loadPitchesData();
            
            // Set up event listeners
            setupPitchEventListeners();
            
            // Render pitches grid
            renderPitchesGrid();
        }
        
        // Initialize pitches data as empty array to prevent showing default data during loading
        let pitchesData = [];
        
        // Default pitches data for fallback when no saved data exists
        const defaultPitchesData = [
            {
                id: 'pitch-001',
                name: 'Main Stadium Pitch',
                status: 'available',
                pitchSize: '5-a-side',
                kickOffTimes: ['09:00', '11:00', '13:00', '15:00', '17:00', '19:00'],
                availability: {
                    monday: true,
                    tuesday: true,
                    wednesday: true,
                    thursday: true,
                    friday: true,
                    saturday: true,
                    sunday: true
                }
            },
            {
                id: 'pitch-002',
                name: 'Training Ground A',
                status: 'available',
                pitchSize: '6-a-side',
                kickOffTimes: ['08:00', '10:00', '12:00', '14:00', '16:00', '18:00'],
                availability: {
                    monday: true,
                    tuesday: true,
                    wednesday: false,
                    thursday: true,
                    friday: true,
                    saturday: true,
                    sunday: false
                }
            },
            {
                id: 'pitch-003',
                name: 'Community Pitch',
                status: 'maintenance',
                pitchSize: '7-a-side',
                kickOffTimes: ['10:00', '14:00', '16:00'],
                availability: {
                    monday: false,
                    tuesday: false,
                    wednesday: false,
                    thursday: false,
                    friday: false,
                    saturday: true,
                    sunday: true
                }
            }
        ];
        
        let subscriptionLimits = {
            'basic': 2,
            'premium': 5,
            'professional': 10
        };
        
        let currentPlan = 'premium';
        
        async function loadPitchesData() {
            // Load from UserDataManager first, fallback to default data
            const savedPitches = await UserDataManager.load('pitches');
            console.log('Raw saved pitches data:', savedPitches);
            
            // Handle both array format and object format from server
            let pitchesArray = null;
            if (savedPitches) {
                if (Array.isArray(savedPitches)) {
                    pitchesArray = savedPitches;
                } else if (savedPitches.data && Array.isArray(savedPitches.data)) {
                    pitchesArray = savedPitches.data;
                }
            }
            
            if (pitchesArray && pitchesArray.length > 0) {
                pitchesData = pitchesArray;
                console.log('Loaded saved pitches data:', pitchesData);
            } else {
                // Start with empty pitches - no default data
                pitchesData = [];
                console.log('No saved pitches found - starting with empty array');
            }
            updateSubscriptionInfo();
        }
        
        // Helper function to save pitches data with conflict detection
        async function savePitchesDataWithConflictCheck(forceOverwrite = false) {
            console.log('savePitchesDataWithConflictCheck called, forceOverwrite:', forceOverwrite);
            
            if (typeof UserDataManager !== 'undefined' && typeof UserDataManager.saveWithConflictCheck === 'function') {
                console.log('Using UserDataManager.saveWithConflictCheck');
                try {
                    const result = await UserDataManager.saveWithConflictCheck('pitches', pitchesData, forceOverwrite);
                    console.log('saveWithConflictCheck result:', result);
                    
                    if (result.conflict && !forceOverwrite) {
                        console.log('Conflict detected, showing dialog');
                        // Show conflict warning dialog
                        const userChoice = await showConflictDialog(result.message, result.conflictInfo);
                        console.log('User choice:', userChoice);
                        if (userChoice === 'overwrite') {
                            // User chose to overwrite, save with force
                            return await savePitchesDataWithConflictCheck(true);
                        } else if (userChoice === 'cancel') {
                            // User cancelled, reload fresh data
                            await loadPitchesData();
                            renderPitchesGrid();
                            return { success: false, cancelled: true };
                        }
                        // If user chose 'merge', they would handle it manually
                        return { success: false, needsMerge: true };
                    }
                    
                    return result;
                } catch (error) {
                    console.error('Error in saveWithConflictCheck:', error);
                    return { success: false, error: error.message };
                }
            } else {
                console.log('Fallback to regular UserDataManager.save');
                // Fallback to regular save
                try {
                    const success = UserDataManager.save('pitches', pitchesData);
                    console.log('Regular save result:', success);
                    return { success: success, conflict: false };
                } catch (error) {
                    console.error('Error in regular save:', error);
                    return { success: false, error: error.message };
                }
            }
        }
        
        // Show conflict resolution dialog
        function showConflictDialog(message, conflictInfo) {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal conflict-dialog">
                        <div class="modal-header">
                            <h3><i class="fas fa-exclamation-triangle"></i> Data Conflict Detected</h3>
                        </div>
                        <div class="modal-body">
                            <p><strong>Warning:</strong> ${message}</p>
                            <p>What would you like to do?</p>
                            <div class="conflict-options">
                                <button class="btn btn-primary" data-action="overwrite">
                                    <i class="fas fa-save"></i> Overwrite with My Changes
                                </button>
                                <button class="btn btn-secondary" data-action="cancel">
                                    <i class="fas fa-refresh"></i> Cancel & Reload Fresh Data
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Handle button clicks
                modal.addEventListener('click', (e) => {
                    if (e.target.hasAttribute('data-action')) {
                        const action = e.target.getAttribute('data-action');
                        document.body.removeChild(modal);
                        resolve(action);
                    }
                });
                
                // Add conflict dialog specific styles
                const style = document.createElement('style');
                style.textContent = `
                    .conflict-dialog {
                        max-width: 500px;
                        width: 90%;
                    }
                    .conflict-dialog .modal-header {
                        background: #ff6b35;
                        color: white;
                        padding: 1rem;
                        border-radius: 8px 8px 0 0;
                    }
                    .conflict-dialog .modal-header h3 {
                        margin: 0;
                        font-size: 1.2rem;
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                    }
                    .conflict-dialog .modal-body {
                        padding: 1.5rem;
                    }
                    .conflict-options {
                        display: flex;
                        gap: 1rem;
                        margin-top: 1.5rem;
                        justify-content: center;
                    }
                    .conflict-options .btn {
                        padding: 0.75rem 1.5rem;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: 500;
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                        transition: all 0.2s ease;
                    }
                    .conflict-options .btn:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                    }
                    .conflict-options .btn-primary {
                        background: #ff6b35;
                        color: white;
                    }
                    .conflict-options .btn-secondary {
                        background: #6c757d;
                        color: white;
                    }
                `;
                document.head.appendChild(style);
            });
        }
        
        function setupPitchEventListeners() {
            // Create pitch button
            document.getElementById('create-pitch')?.addEventListener('click', showAddPitchDialog);
            
            // Export button
            document.getElementById('export-pitches')?.addEventListener('click', exportPitchData);
            
            // Upgrade plan button
            document.querySelector('.upgrade-btn')?.addEventListener('click', showUpgradeDialog);
        }
        
        function renderPitchesGrid() {
            const grid = document.getElementById('pitches-grid');
            const loadingElement = document.getElementById('pitches-loading');
            const maxPitches = subscriptionLimits[currentPlan];
            const canAddMore = pitchesData.length < maxPitches;
            
            // Hide loading state
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
            
            grid.innerHTML = '';
            
            // Render existing pitches
            pitchesData.forEach(pitch => {
                const pitchCard = createPitchCard(pitch);
                grid.appendChild(pitchCard);
            });
            
            // Add "Create New Pitch" card if user can add more
            if (canAddMore) {
                const addCard = createAddPitchCard();
                grid.appendChild(addCard);
            }
        }
        
        function createPitchCard(pitch) {
            const card = document.createElement('div');
            card.className = 'pitch-card';
            card.dataset.pitchId = pitch.id;
            
            const availableDays = Object.entries(pitch.availability)
                .filter(([day, available]) => available)
                .map(([day]) => day.charAt(0).toUpperCase() + day.slice(1).substring(0, 2))
                .join(', ');
            
            card.innerHTML = `
                <div class="pitch-main-content">
                    <div class="pitch-header">
                        <h3 class="pitch-name">${pitch.name}</h3>
                        <button class="pitch-header-btn" onclick="editPitch('${pitch.id}')">Edit Details</button>
                    </div>
                    
                    <div class="pitch-graphic">
                        <img src="../../img/pitches-graphic.svg" alt="Five-a-side Football Pitch" class="pitch-svg">
                    </div>
                    
                    <div class="pitch-info">
                        <div class="pitch-details">
                            <div class="detail-item">
                                <span class="detail-label">Pitch Size</span>
                                <span class="detail-value">${pitch.pitchSize}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Available Days</span>
                                <span class="detail-value">${availableDays}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Kick Off Times</span>
                                <span class="detail-value">${pitch.kickOffTimes.join(', ')}</span>
                            </div>
                        </div>
                        
                        <div class="pitch-actions">
                            <button class="btn-edit" onclick="editPitch('${pitch.id}')">Edit Details</button>
                            <button class="btn-delete" onclick="deletePitch('${pitch.id}')">Delete</button>
                        </div>
                    </div>
                </div>
                
                <div class="pitch-calendar-section">
                    <div class="calendar-container">
                        <div class="calendar-grid" id="calendar-${pitch.id}">
                            <!-- Calendar will be generated here -->
                        </div>
                        <div class="calendar-legend">
                            <div class="legend-item">
                                <div class="legend-dot unavailable"></div>
                                <span>Unavailable</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot available"></div>
                                <span>Available</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot booked"></div>
                                <span>Fully Booked</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Generate calendar after creating the card
            setTimeout(() => generateTwoWeekCalendar(pitch.id, pitch.availability, pitch.kickOffTimes), 0);
            
            return card;
        }
        
        function createAddPitchCard() {
            const card = document.createElement('div');
            card.className = 'add-pitch-card';
            card.onclick = showAddPitchDialog;
            
            card.innerHTML = `
                <div class="add-pitch-icon">ðŸ¥…</div>
                <div class="add-pitch-text">Add New Pitch</div>
                <div class="add-pitch-subtitle">Create a new football pitch</div>
            `;
            
            return card;
        }
        
        function updateSubscriptionInfo() {
            const tierElement = document.querySelector('.subscription-tier');
            const countElement = document.querySelector('.pitch-count');
            const progressElement = document.querySelector('.progress-fill');
            
            const maxPitches = subscriptionLimits[currentPlan];
            const usedPitches = pitchesData.length;
            const percentage = (usedPitches / maxPitches) * 100;
            
            if (tierElement) tierElement.textContent = currentPlan.charAt(0).toUpperCase() + currentPlan.slice(1) + ' Plan';
            if (countElement) countElement.textContent = `${usedPitches} of ${maxPitches} pitches used`;
            if (progressElement) progressElement.style.width = percentage + '%';
        }
        
                // Mock booking data for demonstration - covering 6 months with detailed fixture information
        let mockBookings = {
            'pitch-001': {
                // July 2025
                '2025-07-25': [
                    {
                        time: '09:00',
                        homeTeam: 'Arsenal FC',
                        awayTeam: 'Chelsea FC',
                        league: 'Premier League',
                        division: 'Division 1',
                        homeConfirmed: true,
                        awayConfirmed: true,
                        matchType: 'League Match'
                    },
                    {
                        time: '11:00',
                        homeTeam: 'Liverpool FC',
                        awayTeam: 'Manchester United',
                        league: 'Premier League',
                        division: 'Division 1',
                        homeConfirmed: true,
                        awayConfirmed: false,
                        matchType: 'League Match'
                    }
                ],
                '2025-07-26': [
                    {
                        time: '09:00',
                        homeTeam: 'Tottenham',
                        awayTeam: 'West Ham',
                        league: 'Championship',
                        division: 'Division 2',
                        homeConfirmed: true,
                        awayConfirmed: true,
                        matchType: 'League Match'
                    },
                    {
                        time: '11:00',
                        homeTeam: 'Brighton',
                        awayTeam: 'Crystal Palace',
                        league: 'Championship',
                        division: 'Division 2',
                        homeConfirmed: false,
                        awayConfirmed: true,
                        matchType: 'League Match'
                    },
                    {
                        time: '13:00',
                        homeTeam: 'Leicester City',
                        awayTeam: 'Everton',
                        league: 'Premier League',
                        division: 'Division 1',
                        homeConfirmed: true,
                        awayConfirmed: true,
                        matchType: 'Friendly'
                    },
                    {
                        time: '15:00',
                        homeTeam: 'Newcastle',
                        awayTeam: 'Aston Villa',
                        league: 'Premier League',
                        division: 'Division 1',
                        homeConfirmed: true,
                        awayConfirmed: false,
                        matchType: 'League Match'
                    },
                    {
                        time: '17:00',
                        homeTeam: 'Wolves',
                        awayTeam: 'Southampton',
                        league: 'Championship',
                        division: 'Division 2',
                        homeConfirmed: false,
                        awayConfirmed: false,
                        matchType: 'League Match'
                    },
                    {
                        time: '19:00',
                        homeTeam: 'Burnley',
                        awayTeam: 'Sheffield United',
                        league: 'Championship',
                        division: 'Division 2',
                        homeConfirmed: true,
                        awayConfirmed: true,
                        matchType: 'Friendly'
                    }
                ],
                '2025-07-28': [
                    {
                        time: '09:00',
                        homeTeam: 'Manchester City',
                        awayTeam: 'Liverpool FC',
                        league: 'Premier League',
                        division: 'Division 1',
                        homeConfirmed: true,
                        awayConfirmed: true,
                        matchType: 'League Match'
                    },
                    {
                        time: '13:00',
                        homeTeam: 'Arsenal FC',
                        awayTeam: 'Tottenham',
                        league: 'Premier League',
                        division: 'Division 1',
                        homeConfirmed: true,
                        awayConfirmed: false,
                        matchType: 'League Match'
                    }
                ]
            },
            'pitch-002': {
                // July 2025
                '2025-07-25': [
                    {
                        time: '08:00',
                        homeTeam: 'Cardiff City',
                        awayTeam: 'Swansea City',
                        league: 'League One',
                        division: 'Division 3',
                        homeConfirmed: true,
                        awayConfirmed: true,
                        matchType: 'League Match'
                    },
                    {
                        time: '10:00',
                        homeTeam: 'Bristol City',
                        awayTeam: 'Bristol Rovers',
                        league: 'League One',
                        division: 'Division 3',
                        homeConfirmed: false,
                        awayConfirmed: true,
                        matchType: 'Friendly'
                    }
                ]
            },
            'pitch-003': {
                // July 2025
                '2025-07-27': [
                    {
                        time: '10:00',
                        homeTeam: 'Youth Team A',
                        awayTeam: 'Youth Team B',
                        league: 'Youth League',
                        division: 'Under-18',
                        homeConfirmed: true,
                        awayConfirmed: true,
                        matchType: 'Friendly'
                    }
                ]
            }
        };        function generateTwoWeekCalendar(pitchId, availability, kickOffTimes) {
            const calendarGrid = document.getElementById(`calendar-${pitchId}`);
            if (!calendarGrid) return;
            
            const today = new Date();
            const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const fullDayNames = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            let calendarHTML = '';
            
            // Calculate the start of the week (Monday)
            const startDate = new Date(today);
            const dayOfWeek = today.getDay();
            const daysFromMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Sunday = 0, so 6 days back to Monday
            startDate.setDate(today.getDate() - daysFromMonday);
            
            // Generate 6 months worth of calendar (approximately 26 weeks)
            const totalWeeks = 26;
            const totalDays = totalWeeks * 7;
            
            for (let i = 0; i < totalDays; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayOfWeek = date.getDay();
                const dayName = fullDayNames[dayOfWeek === 0 ? 6 : dayOfWeek - 1]; // Convert Sunday=0 to Sunday=6 in our array
                const dateString = date.toISOString().split('T')[0];
                const dayNumber = date.getDate();
                const shortDayName = dayNames[dayOfWeek === 0 ? 6 : dayOfWeek - 1];
                
                let dayClass = 'calendar-day';
                let statusClass = 'unavailable';
                let tooltipContent = '';
                
                // Check if this is today
                const isToday = date.toDateString() === today.toDateString();
                if (isToday) {
                    dayClass += ' today';
                }
                
                // Check if this day of week is available
                if (availability[dayName]) {
                    const bookedSlots = mockBookings[pitchId]?.[dateString] || [];
                    const bookedTimes = bookedSlots.map(slot => slot.time || slot);
                    const availableSlots = kickOffTimes.filter(time => !bookedTimes.includes(time));
                    
                    if (bookedTimes.length === kickOffTimes.length) {
                        // Fully booked
                        statusClass = 'booked';
                        tooltipContent = 'View selected date';
                    } else if (bookedTimes.length > 0) {
                        // Partially booked - show as available with some slots taken
                        statusClass = 'available';
                        tooltipContent = 'View selected date';
                    } else {
                        // Fully available
                        statusClass = 'available';
                        tooltipContent = 'View selected date';
                    }
                } else {
                    tooltipContent = 'View selected date';
                }
                
                calendarHTML += `
                    <div class="${dayClass} ${statusClass}" 
                         data-date="${dateString}"
                         data-pitch-id="${pitchId}"
                         onclick="openDayView('${pitchId}', '${dateString}')">
                        <div class="day-number">${dayNumber}</div>
                        <div class="day-name">${shortDayName}</div>
                        <div class="tooltip">${tooltipContent}</div>
                    </div>
                `;
            }
            
            calendarGrid.innerHTML = calendarHTML;
        }
        
        function editPitch(pitchId) {
            console.log('Edit pitch:', pitchId);
            const pitch = pitchesData.find(p => p.id === pitchId);
            if (!pitch) {
                showNotification('Pitch not found', 'error');
                return;
            }
            
            // Update modal title
            document.getElementById('pitch-modal-title').textContent = 'Edit Pitch';
            document.getElementById('save-btn-text').textContent = 'Update Pitch';
            
            // Show delete button for editing
            document.getElementById('delete-pitch-btn').style.display = 'inline-flex';
            
            // Populate form with pitch data
            document.getElementById('pitch-name').value = pitch.name;
            document.getElementById('pitch-size').value = pitch.pitchSize;
            
            // Set selected kick-off times from the current pitch being edited
            selectedKickOffTimes = [...(pitch.kickOffTimes || [])];
            renderSelectedTimes();
            populateTimeDropdown();
            // Update time availability to reflect current pitch's times
            updateTimeAvailability();
            
            // Set availability checkboxes
            Object.keys(pitch.availability).forEach(day => {
                const checkbox = document.querySelector(`input[name="availability"][value="${day}"]`);
                if (checkbox) {
                    checkbox.checked = pitch.availability[day];
                }
            });
            
            // Store pitch ID for saving
            document.getElementById('pitch-form').dataset.pitchId = pitchId;
            
            // Show modal
            document.getElementById('pitch-modal').classList.add('active');
        }
        
        function deletePitch(pitchId) {
            const pitch = pitchesData.find(p => p.id === pitchId);
            if (!pitch) {
                showNotification('Pitch not found', 'error');
                return;
            }
            
            // Set up the delete confirmation modal
            document.getElementById('delete-pitch-name').textContent = `Are you sure you want to delete "${pitch.name}"?`;
            document.getElementById('confirm-delete-btn').setAttribute('data-pitch-id', pitchId);
            
            // Show the modal
            document.getElementById('delete-confirmation-modal').style.display = 'flex';
        }
        
        function showDeleteConfirmation() {
            const form = document.getElementById('pitch-form');
            const pitchId = form.dataset.pitchId;
            
            if (!pitchId) {
                showNotification('No pitch selected for deletion', 'error');
                return;
            }
            
            const pitch = pitchesData.find(p => p.id === pitchId);
            if (!pitch) {
                showNotification('Pitch not found', 'error');
                return;
            }
            
            // Set up the delete confirmation modal
            document.getElementById('delete-pitch-name').textContent = `Are you sure you want to delete "${pitch.name}"?`;
            document.getElementById('confirm-delete-btn').setAttribute('data-pitch-id', pitchId);
            
            // Show the modal
            document.getElementById('delete-confirmation-modal').style.display = 'flex';
        }

        function closeDeleteConfirmationModal() {
            document.getElementById('delete-confirmation-modal').style.display = 'none';
            document.getElementById('confirm-delete-btn').removeAttribute('data-pitch-id');
        }

        function confirmPitchDeletion() {
            const pitchId = document.getElementById('confirm-delete-btn').getAttribute('data-pitch-id');
            if (!pitchId) {
                showNotification('No pitch selected for deletion', 'error');
                return;
            }

            const pitch = pitchesData.find(p => p.id === pitchId);
            if (!pitch) {
                showNotification('Pitch not found', 'error');
                return;
            }

            // Remove from data
            pitchesData = pitchesData.filter(p => p.id !== pitchId);
            
            // Save updated data with conflict detection
            savePitchesDataWithConflictCheck().then(result => {
                if (result.success) {
                    // Remove from mock bookings
                    delete mockBookings[pitchId];
                    
                    // Close modals
                    closeDeleteConfirmationModal();
                    closePitchModal();
                    
                    // Re-render grid and update subscription info
                    renderPitchesGrid();
                    updateSubscriptionInfo();
                    
                    showNotification('Pitch deleted successfully!', 'success');
                } else if (result.cancelled) {
                    showNotification('Delete cancelled - data refreshed from server', 'info');
                } else {
                    showNotification('Failed to delete pitch', 'error');
                }
            });
            
            return; // Exit early to let the async operation complete
            
            // Update UI
            renderPitchesGrid();
            updateSubscriptionInfo();
            showNotification(`"${pitch.name}" has been deleted successfully`, 'success');
        }
        
        function showAddPitchDialog() {
            const maxPitches = subscriptionLimits[currentPlan];
            if (pitchesData.length >= maxPitches) {
                showNotification(`You've reached your plan limit of ${maxPitches} pitches. Please upgrade to add more.`, 'warning');
                showUpgradeDialog();
                return;
            }
            
            // Reset form and modal title
            document.getElementById('pitch-modal-title').textContent = 'Add New Pitch';
            document.getElementById('save-btn-text').textContent = 'Add Pitch';
            document.getElementById('pitch-form').reset();
            document.getElementById('pitch-form').removeAttribute('data-pitch-id');
            
            // Hide delete button for adding new pitch
            document.getElementById('delete-pitch-btn').style.display = 'none';
            
            // IMPORTANT: Clear selected times array completely for new pitch
            selectedKickOffTimes = [];
            renderSelectedTimes();
            
            // Populate time dropdown after clearing times
            populateTimeDropdown();
            // Update time availability after clearing to reset dropdown states
            updateTimeAvailability();
            
            // Check all days by default
            document.querySelectorAll('input[name="availability"]').forEach(checkbox => {
                checkbox.checked = true;
            });
            
            // Show modal
            document.getElementById('pitch-modal').classList.add('active');
        }
        
        function savePitch() {
            const form = document.getElementById('pitch-form');
            const pitchId = form.dataset.pitchId;
            const isEditing = !!pitchId;
            
            // Validate form
            const name = document.getElementById('pitch-name').value.trim();
            const size = document.getElementById('pitch-size').value;
            
            if (!name) {
                showNotification('Please enter a pitch name', 'error');
                return;
            }
            
            if (!size) {
                showNotification('Please select a pitch size', 'error');
                return;
            }
            
            if (selectedKickOffTimes.length === 0) {
                showNotification('Please add at least one kick-off time', 'error');
                return;
            }
            
            // Get availability
            const availability = {};
            ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'].forEach(day => {
                const checkbox = document.querySelector(`input[name="availability"][value="${day}"]`);
                availability[day] = checkbox ? checkbox.checked : false;
            });
            
            // Check if at least one day is selected
            if (!Object.values(availability).some(day => day)) {
                showNotification('Please select at least one available day', 'error');
                return;
            }
            
            if (isEditing) {
                // Update existing pitch
                const existingPitch = pitchesData.find(p => p.name.toLowerCase() === name.toLowerCase() && p.id !== pitchId);
                if (existingPitch) {
                    showNotification('A pitch with this name already exists', 'error');
                    return;
                }
                
                const pitchData = {
                    id: pitchId,
                    name: name,
                    status: 'available',
                    pitchSize: size,
                    kickOffTimes: [...selectedKickOffTimes].sort(),
                    availability: availability
                };
                
                const index = pitchesData.findIndex(p => p.id === pitchId);
                if (index !== -1) {
                    pitchesData[index] = pitchData;
                    
                    // Save with conflict detection
                    savePitchesDataWithConflictCheck().then(result => {
                        if (result.success) {
                            showNotification(`"${pitchData.name}" has been updated successfully`, 'success');
                            renderPitchesGrid();
                            updateSubscriptionInfo();
                            closePitchModal();
                        } else if (result.cancelled) {
                            showNotification('Update cancelled - data refreshed from server', 'info');
                        } else {
                            showNotification('Failed to update pitch', 'error');
                        }
                    });
                    return; // Exit early to let async operation complete
                }
            } else {
                // Single pitch creation
                const existingPitch = pitchesData.find(p => p.name.toLowerCase() === name.toLowerCase());
                if (existingPitch) {
                    showNotification('A pitch with this name already exists', 'error');
                    return;
                }
                
                const pitchData = {
                    id: 'pitch-' + Date.now().toString().slice(-6),
                    name: name,
                    status: 'available',
                    pitchSize: size,
                    kickOffTimes: [...selectedKickOffTimes].sort(),
                    availability: availability
                };
                
                pitchesData.push(pitchData);
                
                // Save with conflict detection
                savePitchesDataWithConflictCheck().then(result => {
                    if (result.success) {
                        mockBookings[pitchData.id] = {};
                        showNotification(`"${pitchData.name}" has been added successfully`, 'success');
                        renderPitchesGrid();
                        updateSubscriptionInfo();
                        closePitchModal();
                    } else if (result.cancelled) {
                        showNotification('Add cancelled - data refreshed from server', 'info');
                    } else {
                        showNotification('Failed to add pitch', 'error');
                    }
                });
                return; // Exit early to let async operation complete
            }
            
            // This code will only run for the edit path if no async operation was triggered
            renderPitchesGrid();
            updateSubscriptionInfo();
            closePitchModal();
        }
        
        function closePitchModal() {
            document.getElementById('pitch-modal').classList.remove('active');
            // Reset selected times when modal is closed to prevent cross-contamination
            selectedKickOffTimes = [];
            renderSelectedTimes();
            // Update time availability to reset dropdown states
            updateTimeAvailability();
        }
        
        function exportPitchData() {
            console.log('Opening export options modal...');
            showExportModal();
        }

        function showExportModal() {
            // Populate pitch selection checkboxes
            const pitchCheckboxContainer = document.getElementById('pitch-selection-checkboxes');
            pitchCheckboxContainer.innerHTML = '';
            
            pitchesData.forEach(pitch => {
                const checkboxDiv = document.createElement('div');
                checkboxDiv.className = 'checkbox-option';
                checkboxDiv.innerHTML = `
                    <label class="checkbox-label">
                        <input type="checkbox" value="${pitch.id}" checked class="pitch-checkbox">
                        <span class="checkbox-text">${pitch.name} (${pitch.pitchSize})</span>
                    </label>
                `;
                pitchCheckboxContainer.appendChild(checkboxDiv);
            });

            // Set default date range (current month)
            const today = new Date();
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            document.getElementById('export-from-date').value = firstDayOfMonth.toISOString().split('T')[0];
            document.getElementById('export-to-date').value = lastDayOfMonth.toISOString().split('T')[0];

            // Show modal
            document.getElementById('export-modal').classList.add('active');
        }

        function closeExportModal() {
            document.getElementById('export-modal').classList.remove('active');
        }

        function selectAllPitches() {
            document.querySelectorAll('.pitch-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        function deselectAllPitches() {
            document.querySelectorAll('.pitch-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        function performExport() {
            // Get selected pitches
            const selectedPitches = Array.from(document.querySelectorAll('.pitch-checkbox:checked'))
                .map(checkbox => checkbox.value);
            
            if (selectedPitches.length === 0) {
                showNotification('Please select at least one pitch to export', 'error');
                return;
            }

            // Get date range
            const fromDate = document.getElementById('export-from-date').value;
            const toDate = document.getElementById('export-to-date').value;
            
            if (!fromDate || !toDate) {
                showNotification('Please select both from and to dates', 'error');
                return;
            }

            if (new Date(fromDate) > new Date(toDate)) {
                showNotification('From date cannot be after to date', 'error');
                return;
            }

            // Get selected file format
            const fileFormat = document.querySelector('input[name="export-format"]:checked').value;

            // Generate and download file
            generateExportFile(selectedPitches, fromDate, toDate, fileFormat);
            
            closeExportModal();
        }

        function generateExportFile(selectedPitches, fromDate, toDate, format) {
            const filteredData = getFilteredExportData(selectedPitches, fromDate, toDate);
            let content, mimeType, fileName, extension;

            switch (format) {
                case 'csv':
                    content = generateCSVContent(filteredData);
                    mimeType = 'text/csv;charset=utf-8;';
                    extension = 'csv';
                    break;
                case 'json':
                    content = generateJSONContent(filteredData);
                    mimeType = 'application/json;charset=utf-8;';
                    extension = 'json';
                    break;
                case 'html':
                    content = generateHTMLContent(filteredData, fromDate, toDate);
                    mimeType = 'text/html;charset=utf-8;';
                    extension = 'html';
                    break;
                case 'xml':
                    content = generateXMLContent(filteredData);
                    mimeType = 'application/xml;charset=utf-8;';
                    extension = 'xml';
                    break;
                default:
                    content = generateCSVContent(filteredData);
                    mimeType = 'text/csv;charset=utf-8;';
                    extension = 'csv';
            }

            fileName = `5ive-trackr-pitches-export-${new Date().toISOString().split('T')[0]}.${extension}`;

            // Create and download file
            const blob = new Blob([content], { type: mimeType });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', fileName);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification(`Data exported successfully as ${extension.toUpperCase()}!`, 'success');
            } else {
                showNotification('Export not supported in this browser', 'error');
            }
        }

        function getFilteredExportData(selectedPitches, fromDate, toDate) {
            const filteredPitches = pitchesData.filter(pitch => selectedPitches.includes(pitch.id));
            const startDate = new Date(fromDate);
            const endDate = new Date(toDate);
            
            return filteredPitches.map(pitch => {
                // Filter bookings within date range
                const filteredBookings = {};
                const pitchBookings = mockBookings[pitch.id] || {};
                
                Object.keys(pitchBookings).forEach(dateString => {
                    const bookingDate = new Date(dateString);
                    if (bookingDate >= startDate && bookingDate <= endDate) {
                        filteredBookings[dateString] = pitchBookings[dateString];
                    }
                });

                return {
                    ...pitch,
                    bookings: filteredBookings,
                    bookingCount: Object.keys(filteredBookings).length,
                    totalFixtures: Object.values(filteredBookings).reduce((total, dayBookings) => total + dayBookings.length, 0)
                };
            });
        }
        
        function generateCSVContent(filteredData) {
            const headers = [
                'Pitch ID',
                'Pitch Name',
                'Size',
                'Status',
                'Available Days',
                'Kick-off Times',
                'Total Bookings',
                'Total Fixtures',
                'Booking Details'
            ];
            
            const rows = filteredData.map(pitch => {
                const availableDays = Object.entries(pitch.availability)
                    .filter(([day, available]) => available)
                    .map(([day]) => day.charAt(0).toUpperCase() + day.slice(1))
                    .join('; ');
                
                // Create detailed booking information
                const bookingDetails = Object.entries(pitch.bookings).map(([date, fixtures]) => {
                    return `${date}: ${fixtures.map(f => `${f.time} ${f.homeTeam} vs ${f.awayTeam}`).join(' | ')}`;
                }).join(' // ');
                
                return [
                    pitch.id,
                    `"${pitch.name}"`,
                    pitch.pitchSize,
                    pitch.status,
                    `"${availableDays}"`,
                    `"${pitch.kickOffTimes.join(', ')}"`,
                    pitch.bookingCount,
                    pitch.totalFixtures,
                    `"${bookingDetails}"`
                ];
            });
            
            return [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
        }

        function generateJSONContent(filteredData) {
            const exportData = {
                exportDate: new Date().toISOString(),
                pitchCount: filteredData.length,
                totalBookings: filteredData.reduce((sum, pitch) => sum + pitch.bookingCount, 0),
                totalFixtures: filteredData.reduce((sum, pitch) => sum + pitch.totalFixtures, 0),
                pitches: filteredData
            };
            
            return JSON.stringify(exportData, null, 2);
        }

        function generateHTMLContent(filteredData, fromDate, toDate) {
            const totalBookings = filteredData.reduce((sum, pitch) => sum + pitch.bookingCount, 0);
            const totalFixtures = filteredData.reduce((sum, pitch) => sum + pitch.totalFixtures, 0);
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5ive Trackr - Pitch Export Report</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 2px solid #ff6b35; }
        .header h1 { color: #ff6b35; margin: 0; font-size: 2.5rem; }
        .header .subtitle { color: #666; margin-top: 10px; font-size: 1.1rem; }
        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .summary-card { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #ff6b35; }
        .summary-card h3 { margin: 0; color: #333; font-size: 2rem; }
        .summary-card p { margin: 10px 0 0; color: #666; }
        .pitch-section { margin-bottom: 40px; }
        .pitch-header { background: #ff6b35; color: white; padding: 15px 20px; border-radius: 8px 8px 0 0; }
        .pitch-details { background: white; border: 1px solid #ddd; padding: 20px; border-radius: 0 0 8px 8px; }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .detail-item { padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .detail-item strong { color: #333; }
        .bookings-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .bookings-table th, .bookings-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .bookings-table th { background: #f8f9fa; font-weight: 600; color: #333; }
        .bookings-table tr:hover { background: #f9f9f9; }
        .fixture-confirmed { color: #10b981; }
        .fixture-pending { color: #f59e0b; }
        .no-bookings { text-align: center; color: #666; font-style: italic; padding: 20px; }
        .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; }
    </style>
    <\!-- SPA Redirect Handler -->
    <script src="../../js/core/spa-redirect.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ¥… 5ive Trackr</h1>
            <div class="subtitle">Pitch Export Report | ${fromDate} to ${toDate}</div>
            <div class="subtitle">Generated on ${new Date().toLocaleDateString('en-GB')}</div>
        </div>
        
        <div class="summary">
            <div class="summary-card">
                <h3>${filteredData.length}</h3>
                <p>Pitches Exported</p>
            </div>
            <div class="summary-card">
                <h3>${totalBookings}</h3>
                <p>Total Booking Days</p>
            </div>
            <div class="summary-card">
                <h3>${totalFixtures}</h3>
                <p>Total Fixtures</p>
            </div>
        </div>
        
        ${filteredData.map(pitch => `
            <div class="pitch-section">
                <div class="pitch-header">
                    <h2>${pitch.name} (${pitch.pitchSize})</h2>
                </div>
                <div class="pitch-details">
                    <div class="detail-grid">
                        <div class="detail-item">
                            <strong>Status:</strong> ${pitch.status.charAt(0).toUpperCase() + pitch.status.slice(1)}
                        </div>
                        <div class="detail-item">
                            <strong>Available Days:</strong> ${Object.entries(pitch.availability).filter(([day, available]) => available).map(([day]) => day.charAt(0).toUpperCase() + day.slice(1)).join(', ')}
                        </div>
                        <div class="detail-item">
                            <strong>Kick-off Times:</strong> ${pitch.kickOffTimes.join(', ')}
                        </div>
                        <div class="detail-item">
                            <strong>Bookings in Period:</strong> ${pitch.bookingCount} days, ${pitch.totalFixtures} fixtures
                        </div>
                    </div>
                    
                    ${Object.keys(pitch.bookings).length > 0 ? `
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Home Team</th>
                                    <th>Away Team</th>
                                    <th>League</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(pitch.bookings).map(([date, fixtures]) => 
                                    fixtures.map(fixture => `
                                        <tr>
                                            <td>${new Date(date).toLocaleDateString('en-GB')}</td>
                                            <td>${fixture.time}</td>
                                            <td>${fixture.homeTeam}</td>
                                            <td>${fixture.awayTeam}</td>
                                            <td>${fixture.league}</td>
                                            <td class="${fixture.homeConfirmed && fixture.awayConfirmed ? 'fixture-confirmed' : 'fixture-pending'}">
                                                ${fixture.homeConfirmed && fixture.awayConfirmed ? 'âœ“ Confirmed' : 'â³ Pending'}
                                            </td>
                                        </tr>
                                    `).join('')
                                ).join('')}
                            </tbody>
                        </table>
                    ` : '<div class="no-bookings">No bookings in selected date range</div>'}
                </div>
            </div>
        `).join('')}
        
        <div class="footer">
            <p>This report was generated by 5ive Trackr - Football League Management System</p>
            <p>For more information, visit your league management dashboard</p>
        </div>
    </div>
</body>
</html>`;
        }

        function generateXMLContent(filteredData) {
            const totalBookings = filteredData.reduce((sum, pitch) => sum + pitch.bookingCount, 0);
            const totalFixtures = filteredData.reduce((sum, pitch) => sum + pitch.totalFixtures, 0);
            
            let xml = `<?xml version="1.0" encoding="UTF-8"?>
<pitchExport>
    <exportInfo>
        <exportDate>${new Date().toISOString()}</exportDate>
        <pitchCount>${filteredData.length}</pitchCount>
        <totalBookings>${totalBookings}</totalBookings>
        <totalFixtures>${totalFixtures}</totalFixtures>
    </exportInfo>
    <pitches>`;
            
            filteredData.forEach(pitch => {
                xml += `
        <pitch id="${pitch.id}">
            <name>${pitch.name}</name>
            <size>${pitch.pitchSize}</size>
            <status>${pitch.status}</status>
            <availability>`;
            
                Object.entries(pitch.availability).forEach(([day, available]) => {
                    xml += `
                <${day}>${available}</${day}>`;
                });
                
                xml += `
            </availability>
            <kickOffTimes>`;
            
                pitch.kickOffTimes.forEach(time => {
                    xml += `
                <time>${time}</time>`;
                });
                
                xml += `
            </kickOffTimes>
            <bookings count="${pitch.bookingCount}" fixtures="${pitch.totalFixtures}">`;
                
                Object.entries(pitch.bookings).forEach(([date, fixtures]) => {
                    xml += `
                <bookingDate date="${date}">`;
                    fixtures.forEach(fixture => {
                        xml += `
                    <fixture>
                        <time>${fixture.time}</time>
                        <homeTeam>${fixture.homeTeam}</homeTeam>
                        <awayTeam>${fixture.awayTeam}</awayTeam>
                        <league>${fixture.league}</league>
                        <division>${fixture.division}</division>
                        <matchType>${fixture.matchType}</matchType>
                        <homeConfirmed>${fixture.homeConfirmed}</homeConfirmed>
                        <awayConfirmed>${fixture.awayConfirmed}</awayConfirmed>
                    </fixture>`;
                    });
                    xml += `
                </bookingDate>`;
                });
                
                xml += `
            </bookings>
        </pitch>`;
            });
            
            xml += `
    </pitches>
</pitchExport>`;
            
            return xml;
        }
        
        function showUpgradeDialog() {
            // Update current plan info in modal
            const currentPlanElement = document.querySelector('.upgrade-content .current-plan');
            if (currentPlanElement) {
                currentPlanElement.innerHTML = `
                    <h4>Current Plan: <span class="plan-name">${currentPlan.charAt(0).toUpperCase() + currentPlan.slice(1)}</span></h4>
                    <p>You're currently using <strong>${pitchesData.length} of ${subscriptionLimits[currentPlan]} pitches</strong></p>
                `;
            }
            
            // Update upgrade buttons based on current plan
            document.querySelectorAll('.plan-option button').forEach(button => {
                const planOption = button.closest('.plan-option');
                const plan = planOption.dataset.plan;
                
                if (plan === currentPlan) {
                    button.textContent = 'Current Plan';
                    button.className = 'btn btn-outline';
                    button.disabled = true;
                } else {
                    button.textContent = `Upgrade to ${plan.charAt(0).toUpperCase() + plan.slice(1)}`;
                    button.className = plan === 'professional' ? 'btn btn-primary' : 'btn btn-outline';
                    button.disabled = false;
                }
            });
            
            document.getElementById('upgrade-modal').classList.add('active');
        }
        
        function closeUpgradeModal() {
            document.getElementById('upgrade-modal').classList.remove('active');
        }
        
        function selectPlan(plan) {
            if (plan === currentPlan) {
                return;
            }
            
            if (confirm(`Upgrade to ${plan.charAt(0).toUpperCase() + plan.slice(1)} plan for Â£${plan === 'premium' ? '29.99' : '49.99'}/month?`)) {
                currentPlan = plan;
                updateSubscriptionInfo();
                closeUpgradeModal();
                showNotification(`Successfully upgraded to ${plan.charAt(0).toUpperCase() + plan.slice(1)} plan!`, 'success');
                
                // Re-render grid to show add card if applicable
                renderPitchesGrid();
            }
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : '#3b82f6'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                z-index: 10000;
                font-weight: 600;
                transition: all 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        function openDayView(pitchId, dateString) {
            const pitch = pitchesData.find(p => p.id === pitchId);
            if (!pitch) return;
            
            const date = new Date(dateString);
            const formattedDate = date.toLocaleDateString('en-GB', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Update modal content
            document.getElementById('modal-pitch-name').textContent = pitch.name;
            document.getElementById('modal-date').textContent = formattedDate;
            
            const bookedFixtures = mockBookings[pitchId]?.[dateString] || [];
            const bookedTimes = bookedFixtures.map(fixture => fixture.time || fixture);
            const availableSlots = pitch.kickOffTimes.filter(time => !bookedTimes.includes(time));
            
            // Render booked fixtures with detailed information
            const bookedContainer = document.getElementById('booked-fixtures');
            if (bookedFixtures.length === 0) {
                bookedContainer.innerHTML = '<div class="no-fixtures">No fixtures booked for this day</div>';
            } else {
                bookedContainer.innerHTML = bookedFixtures.map(fixture => {
                    // Handle both old format (string) and new format (object)
                    if (typeof fixture === 'string') {
                        return `
                            <div class="fixture-item">
                                <div class="fixture-header">
                                    <span class="fixture-time">${fixture}</span>
                                    <span class="fixture-type">Match</span>
                                </div>
                                <div class="fixture-teams">
                                    <div class="team-matchup">Fixture Details Not Available</div>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Determine overall confirmation status
                    const bothConfirmed = fixture.homeConfirmed && fixture.awayConfirmed;
                    const noneConfirmed = !fixture.homeConfirmed && !fixture.awayConfirmed;
                    const confirmationClass = bothConfirmed ? 'confirmed' : (noneConfirmed ? 'unconfirmed' : 'pending');
                    
                    // Determine fixture type styling
                    let fixtureTypeClass = '';
                    let displayMatchType = fixture.matchType || 'Match';
                    if (fixture.matchType?.toLowerCase().includes('friendly')) {
                        fixtureTypeClass = 'friendly';
                        displayMatchType = 'Friendly';
                    } else if (fixture.matchType?.toLowerCase().includes('league')) {
                        fixtureTypeClass = 'league';
                        displayMatchType = 'League Match';
                    }
                    
                    // Create fixture status indicators
                    const homeStatus = fixture.homeConfirmed ? 'âœ“' : '?';
                    const awayStatus = fixture.awayConfirmed ? 'âœ“' : '?';
                    
                    return `
                        <div class="fixture-item ${confirmationClass}">
                            <div class="fixture-header">
                                <span class="fixture-time">${fixture.time}</span>
                                <span class="fixture-type ${fixtureTypeClass}">${displayMatchType}</span>
                            </div>
                            <div class="fixture-teams">
                                <div class="team-matchup">${fixture.homeTeam} v ${fixture.awayTeam}</div>
                                <div class="league-info">${fixture.league} â€¢ ${fixture.division}</div>
                            </div>
                            <div class="confirmation-status">
                                <div class="team-status ${fixture.homeConfirmed ? 'confirmed' : 'pending'}">
                                    <span class="status-icon ${fixture.homeConfirmed ? 'confirmed' : 'pending'}"></span>
                                    Home: ${fixture.homeConfirmed ? 'Confirmed' : 'Pending'}
                                </div>
                                <div class="team-status ${fixture.awayConfirmed ? 'confirmed' : 'pending'}">
                                    <span class="status-icon ${fixture.awayConfirmed ? 'confirmed' : 'pending'}"></span>
                                    Away: ${fixture.awayConfirmed ? 'Confirmed' : 'Pending'}
                                </div>
                            </div>
                        </div>
                    `;
            }).join('');
        }
        
        // Function to generate pitch names based on pattern
        function generatePitchNames(baseName, count, pattern) {
            const names = [];
            
            for (let i = 0; i < count; i++) {
                let suffix = '';
                
                switch (pattern) {
                    case 'numbered':
                        suffix = ` ${i + 1}`;
                        break;
                    case 'letters':
                        suffix = ` ${String.fromCharCode(65 + i)}`; // A, B, C, etc.
                        break;
                    case 'descriptive':
                        const descriptors = ['Main', 'Secondary', 'Third', 'Fourth', 'Fifth'];
                        suffix = i === 0 ? ' Main' : ` ${descriptors[i] || (i + 1)}`;
                        break;
                }
                
                names.push(baseName + suffix);
            }
            
            return names;
        }            // Render available slots
            const availableContainer = document.getElementById('available-slots');
            if (availableSlots.length === 0) {
                availableContainer.innerHTML = '<div class="no-fixtures">No available time slots</div>';
            } else {
                availableContainer.innerHTML = availableSlots.map(time => `
                    <div class="fixture-item">
                        <div class="fixture-header">
                            <span class="fixture-time">${time}</span>
                            <span class="fixture-status available">Available</span>
                        </div>
                        <div class="fixture-teams">
                            <div class="team-matchup">Open for booking</div>
                            <div class="league-info">Available for new fixture</div>
                        </div>
                    </div>
                `).join('');
            }
            
            // Show modal
            document.getElementById('day-view-modal').classList.add('active');
        }
        
        function closeDayView() {
            document.getElementById('day-view-modal').classList.remove('active');
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const dayModal = document.getElementById('day-view-modal');
            const pitchModal = document.getElementById('pitch-modal');
            const upgradeModal = document.getElementById('upgrade-modal');
            const exportModal = document.getElementById('export-modal');
            
            if (e.target === dayModal) {
                closeDayView();
            }
            if (e.target === pitchModal) {
                closePitchModal();
            }
            if (e.target === upgradeModal) {
                closeUpgradeModal();
            }
            if (e.target === exportModal) {
                closeExportModal();
            }
        });
        
        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeDayView();
                closePitchModal();
                closeUpgradeModal();
                closeExportModal();
            }
        });
        
        // Handle form submission with Enter key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('pitch-modal').classList.contains('active')) {
                e.preventDefault();
                savePitch();
            }
        });
        
        // Add form validation on input
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize time dropdown when DOM is loaded
            if (document.getElementById('new-time-select')) {
                populateTimeDropdown();
            }
        });
        
        // Global variables for kick-off time management
        let selectedKickOffTimes = [];
        
        // Function to populate the time dropdowns with available times
        function populateTimeDropdown() {
            const hoursDropdown = document.getElementById('hours-select');
            const minutesDropdown = document.getElementById('minutes-select');
            if (!hoursDropdown || !minutesDropdown) return;
            
            // Populate hours dropdown (6 AM to 10 PM)
            hoursDropdown.innerHTML = '<option value="">Hour</option>';
            for (let hour = 6; hour <= 22; hour++) {
                const option = document.createElement('option');
                option.value = hour.toString().padStart(2, '0');
                option.textContent = hour.toString().padStart(2, '0');
                hoursDropdown.appendChild(option);
            }
            
            // Populate minutes dropdown (0, 5, 10, 15, ..., 55)
            minutesDropdown.innerHTML = '<option value="">Min</option>';
            for (let minute = 0; minute < 60; minute += 5) {
                const option = document.createElement('option');
                option.value = minute.toString().padStart(2, '0');
                option.textContent = minute.toString().padStart(2, '0');
                minutesDropdown.appendChild(option);
            }
            
            // Update availability based on current selections
            updateTimeAvailability();
        }
        
        // Function to check if a time is available (not already selected)
        function isTimeAvailable(timeString) {
            // Check if time is already selected
            if (selectedKickOffTimes.includes(timeString)) {
                return false;
            }
            
            return true;
        }
        
        // Convert time string to minutes since midnight
        function timeToMinutes(timeString) {
            const [hours, minutes] = timeString.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        // Convert minutes since midnight back to time string
        function minutesToTime(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
        }
        
        // Function to update time availability based on selected times
        function updateTimeAvailability() {
            const hoursDropdown = document.getElementById('hours-select');
            const minutesDropdown = document.getElementById('minutes-select');
            if (!hoursDropdown || !minutesDropdown) return;
            
            const selectedHour = hoursDropdown.value;
            const selectedMinute = minutesDropdown.value;
            
            // Reset all options to enabled first
            Array.from(hoursDropdown.options).forEach(option => {
                if (option.value) option.disabled = false;
            });
            Array.from(minutesDropdown.options).forEach(option => {
                if (option.value) option.disabled = false;
            });
            
            // Disable unavailable hour/minute combinations
            if (selectedHour) {
                // Check each minute option with the selected hour
                Array.from(minutesDropdown.options).forEach(option => {
                    if (option.value) {
                        const testTime = `${selectedHour}:${option.value}`;
                        if (!isTimeAvailable(testTime)) {
                            option.disabled = true;
                        }
                    }
                });
            }
            
            if (selectedMinute) {
                // Check each hour option with the selected minute
                Array.from(hoursDropdown.options).forEach(option => {
                    if (option.value) {
                        const testTime = `${option.value}:${selectedMinute}`;
                        if (!isTimeAvailable(testTime)) {
                            option.disabled = true;
                        }
                    }
                });
            }
        }
        
        // Function to add a kick-off time
        function addKickOffTime() {
            const hoursDropdown = document.getElementById('hours-select');
            const minutesDropdown = document.getElementById('minutes-select');
            const selectedHour = hoursDropdown.value;
            const selectedMinute = minutesDropdown.value;
            
            if (!selectedHour || !selectedMinute) {
                showNotification('Please select both hour and minute', 'warning');
                return;
            }
            
            const selectedTime = `${selectedHour}:${selectedMinute}`;
            
            // This check should not be needed as unavailable times are disabled in dropdowns
            // but kept as a safety net
            if (!isTimeAvailable(selectedTime)) {
                console.warn('Attempted to add unavailable time - this should not happen with disabled dropdowns');
                showNotification('Unable to add this time', 'warning');
                return;
            }
            
            // Add to selected times array
            selectedKickOffTimes.push(selectedTime);
            selectedKickOffTimes.sort();
            
            // Update UI
            renderSelectedTimes();
            updateTimeAvailability();
            
            // Reset dropdowns
            hoursDropdown.value = '';
            minutesDropdown.value = '';
        }
        
        // Function to remove a kick-off time
        function removeKickOffTime(timeToRemove) {
            selectedKickOffTimes = selectedKickOffTimes.filter(time => time !== timeToRemove);
            renderSelectedTimes();
            updateTimeAvailability();
        }
        
        // Function to render selected times as chips
        function renderSelectedTimes() {
            const container = document.getElementById('selected-times');
            if (!container) return;
            
            if (selectedKickOffTimes.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = selectedKickOffTimes.map(time => `
                <div class="time-chip">
                    <span>${time}</span>
                    <button type="button" class="remove-time" onclick="removeKickOffTime('${time}')" title="Remove time">
                        Ã—
                    </button>
                </div>
            `).join('');
        }
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize time dropdowns when DOM is loaded
            if (document.getElementById('hours-select') && document.getElementById('minutes-select')) {
                populateTimeDropdown();
                
                // Add event listeners for real-time availability checking
                document.getElementById('hours-select').addEventListener('change', updateTimeAvailability);
                document.getElementById('minutes-select').addEventListener('change', updateTimeAvailability);
            }
        });

        // Multiple pitches modal functions
        function openMultiplePitchesModal() {
            populateMultiplePitchCountOptions();
            resetMultiplePitchesForm();
            document.getElementById('multiple-pitches-modal').style.display = 'flex';
            
            // Initialize form validation
            validateMultiplePitchForm();
            setupFormValidationListeners();
        }

        function closeMultiplePitchesModal() {
            document.getElementById('multiple-pitches-modal').style.display = 'none';
            resetMultiplePitchesForm();
            // Clean up validation listeners
            removeFormValidationListeners();
        }

        function populateMultiplePitchCountOptions() {
            const currentPitchCount = pitchesData.length;
            const maxPitches = subscriptionLimits[currentPlan];
            const availableSlots = maxPitches - currentPitchCount;
            
            const select = document.getElementById('multiple-pitch-count');
            const infoElement = document.getElementById('pitch-limit-info');
            
            select.innerHTML = '';
            
            if (availableSlots <= 0) {
                infoElement.innerHTML = '<span style="color: #dc3545;">You have reached the maximum number of Pitches for your subscription.</span>';
                infoElement.innerHTML += ' <a href="#" onclick="showUpgradeDialog()" style="color: #007bff; text-decoration: underline;">Upgrade your plan</a> to add more Pitches.';
                return;
            }
            
            infoElement.innerHTML = `You can add up to ${availableSlots} more Pitch${availableSlots > 1 ? 'es' : ''} with your current subscription.`;
            
            // Add default option
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select Number of Pitches';
            select.appendChild(defaultOption);
            
            // Start from 2 pitches (remove option for 1 pitch)
            for (let i = 2; i <= Math.min(availableSlots, 10); i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i} Pitches`;
                select.appendChild(option);
            }
        }

        // Toggle sections based on user selection
        function toggleDaysSection() {
            const duplicateDaysOption = document.getElementById('duplicate-days-option').value;
            const duplicateDaysSection = document.getElementById('duplicate-days-section');
            const individualDaysSection = document.getElementById('individual-days-section');
            
            if (duplicateDaysOption === 'yes') {
                duplicateDaysSection.style.display = 'block';
                if (individualDaysSection) individualDaysSection.style.display = 'none';
            } else if (duplicateDaysOption === 'no') {
                duplicateDaysSection.style.display = 'none';
                if (individualDaysSection) individualDaysSection.style.display = 'block';
            } else {
                duplicateDaysSection.style.display = 'none';
                if (individualDaysSection) individualDaysSection.style.display = 'none';
            }
            
            // Update individual pitch entries if they exist
            updateIndividualPitchConditionalSections();
            
            // Trigger form validation
            validateMultiplePitchForm();
        }

        function toggleTimesSection() {
            const duplicateTimesOption = document.getElementById('duplicate-times-option').value;
            const duplicateTimesSection = document.getElementById('duplicate-times-section');
            const individualTimesSection = document.getElementById('individual-times-section');
            
            if (duplicateTimesOption === 'yes') {
                duplicateTimesSection.style.display = 'block';
                if (individualTimesSection) individualTimesSection.style.display = 'none';
                // Initialize time dropdowns for duplicate section
                populateTimeDropdowns('multiple-hours-select', 'multiple-minutes-select');
            } else if (duplicateTimesOption === 'no') {
                duplicateTimesSection.style.display = 'none';
                if (individualTimesSection) individualTimesSection.style.display = 'block';
                // Initialize time dropdowns for individual section
                populateTimeDropdowns('individual-hours-select', 'individual-minutes-select');
            } else {
                duplicateTimesSection.style.display = 'none';
                if (individualTimesSection) individualTimesSection.style.display = 'none';
            }
            
            // Update individual pitch entries if they exist
            updateIndividualPitchConditionalSections();
            
            // Trigger form validation
            validateMultiplePitchForm();
        }

        function handlePitchCountChange() {
            const pitchCount = parseInt(document.getElementById('multiple-pitch-count').value) || 0;
            const individualSection = document.getElementById('individual-pitches-section');
            
            if (pitchCount >= 2) {
                // Show individual entries for multiple pitches
                individualSection.style.display = 'block';
                generateIndividualPitchEntries(pitchCount);
            } else {
                // Hide individual section when no valid selection
                individualSection.style.display = 'none';
            }
            
            // Trigger form validation
            validateMultiplePitchForm();
        }

        function generateIndividualPitchEntries(count) {
            const container = document.getElementById('individual-pitch-entries');
            container.innerHTML = '';
            
            for (let i = 1; i <= count; i++) {
                const pitchEntry = document.createElement('div');
                pitchEntry.className = 'individual-pitch-entry';
                pitchEntry.innerHTML = `
                    <h5>
                        <span class="pitch-number">${i}</span>
                        Pitch ${i}
                    </h5>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pitch-name-${i}">Pitch Name *</label>
                            <input type="text" id="pitch-name-${i}" name="pitchName${i}" required placeholder="e.g., Training Pitch A">
                        </div>
                        <div class="form-group">
                            <label for="pitch-size-${i}">Pitch Size *</label>
                            <select id="pitch-size-${i}" name="pitchSize${i}" required>
                                <option value="">Select pitch size</option>
                                <option value="5-a-side">5-a-side</option>
                                <option value="6-a-side">6-a-side</option>
                                <option value="7-a-side">7-a-side</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="conditional-section individual-days-${i}" style="display: none;">
                        <div class="form-group">
                            <label>Available Days for Pitch ${i} *</label>
                            <div class="days-grid">
                                <label class="day-checkbox">
                                    <input type="checkbox" name="availability-${i}" value="monday">
                                    <span class="day-name">Mon</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="availability-${i}" value="tuesday">
                                    <span class="day-name">Tue</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="availability-${i}" value="wednesday">
                                    <span class="day-name">Wed</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="availability-${i}" value="thursday">
                                    <span class="day-name">Thu</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="availability-${i}" value="friday">
                                    <span class="day-name">Fri</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="availability-${i}" value="saturday">
                                    <span class="day-name">Sat</span>
                                </label>
                                <label class="day-checkbox">
                                    <input type="checkbox" name="availability-${i}" value="sunday">
                                    <span class="day-name">Sun</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="conditional-section individual-times-${i}" style="display: none;">
                        <div class="form-group">
                            <label>Kick-off Times for Pitch ${i} *</label>
                            <div class="kickoff-times-container">
                                <div id="selected-times-${i}">
                                    <!-- Selected times will appear here -->
                                </div>
                                <div class="add-time-section">
                                    <div class="time-selectors">
                                        <div class="time-selector-group">
                                            <label for="hours-select-${i}">Hours</label>
                                            <select id="hours-select-${i}" class="time-dropdown">
                                                <option value="">Hour</option>
                                            </select>
                                        </div>
                                        <div class="time-separator">:</div>
                                        <div class="time-selector-group">
                                            <label for="minutes-select-${i}">Minutes</label>
                                            <select id="minutes-select-${i}" class="time-dropdown">
                                                <option value="">Min</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-secondary add-time-btn" onclick="addIndividualPitchTime(${i})">
                                        Add Time
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(pitchEntry);
                
                // Populate time dropdowns for this pitch
                populateTimeDropdowns(`hours-select-${i}`, `minutes-select-${i}`);
            }
            
            // Update conditional sections based on current selections
            updateIndividualPitchConditionalSections();
        }

        function updateIndividualPitchConditionalSections() {
            const duplicateDaysOption = document.getElementById('duplicate-days-option').value;
            const duplicateTimesOption = document.getElementById('duplicate-times-option').value;
            const pitchCount = parseInt(document.getElementById('multiple-pitch-count').value) || 0;
            
            if (pitchCount > 1) {
                for (let i = 1; i <= pitchCount; i++) {
                    const daysSection = document.querySelector(`.individual-days-${i}`);
                    const timesSection = document.querySelector(`.individual-times-${i}`);
                    
                    if (daysSection) {
                        daysSection.style.display = duplicateDaysOption === 'no' ? 'block' : 'none';
                    }
                    
                    if (timesSection) {
                        timesSection.style.display = duplicateTimesOption === 'no' ? 'block' : 'none';
                    }
                }
            }
        }

        function populateTimeDropdowns(hoursId, minutesId) {
            const hoursSelect = document.getElementById(hoursId);
            const minutesSelect = document.getElementById(minutesId);
            
            if (!hoursSelect || !minutesSelect) return;
            
            // Clear existing options
            hoursSelect.innerHTML = '<option value="">Hour</option>';
            minutesSelect.innerHTML = '<option value="">Min</option>';
            
            // Populate hours (09-22)
            for (let hour = 9; hour <= 22; hour++) {
                const hourString = hour.toString().padStart(2, '0');
                hoursSelect.innerHTML += `<option value="${hourString}">${hourString}</option>`;
            }
            
            // Populate minutes (5-minute intervals: 00, 05, 10, 15, ..., 55)
            for (let minute = 0; minute <= 55; minute += 5) {
                const minuteString = minute.toString().padStart(2, '0');
                minutesSelect.innerHTML += `<option value="${minuteString}">${minuteString}</option>`;
            }
        }

        let multipleSelectedKickOffTimes = [];
        let individualSelectedKickOffTimes = [];
        let individualPitchTimes = {}; // Store times for each individual pitch

        function addIndividualPitchTime(pitchIndex) {
            const hoursSelect = document.getElementById(`hours-select-${pitchIndex}`);
            const minutesSelect = document.getElementById(`minutes-select-${pitchIndex}`);
            
            if (!hoursSelect.value || !minutesSelect.value) {
                showNotification('Please select both hours and minutes', 'warning');
                return;
            }
            
            const timeString = `${hoursSelect.value}:${minutesSelect.value}`;
            
            // Initialize array for this pitch if it doesn't exist
            if (!individualPitchTimes[pitchIndex]) {
                individualPitchTimes[pitchIndex] = [];
            }
            
            if (individualPitchTimes[pitchIndex].includes(timeString)) {
                showNotification('This time has already been added for this pitch', 'warning');
                return;
            }
            
            individualPitchTimes[pitchIndex].push(timeString);
            individualPitchTimes[pitchIndex].sort();
            renderIndividualPitchTimes(pitchIndex);
            
            // Reset dropdowns
            hoursSelect.value = '';
            minutesSelect.value = '';
        }

        function renderIndividualPitchTimes(pitchIndex) {
            const container = document.getElementById(`selected-times-${pitchIndex}`);
            if (!container) return;
            
            const times = individualPitchTimes[pitchIndex] || [];
            
            if (times.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = times.map(time => `
                <div class="time-chip">
                    <span>${time}</span>
                    <button type="button" class="remove-time" onclick="removeIndividualPitchTime(${pitchIndex}, '${time}')" title="Remove time">
                        Ã—
                    </button>
                </div>
            `).join('');
        }

        function removeIndividualPitchTime(pitchIndex, timeToRemove) {
            if (individualPitchTimes[pitchIndex]) {
                individualPitchTimes[pitchIndex] = individualPitchTimes[pitchIndex].filter(time => time !== timeToRemove);
                renderIndividualPitchTimes(pitchIndex);
            }
        }

        function addMultipleKickOffTime() {
            const hoursSelect = document.getElementById('multiple-hours-select');
            const minutesSelect = document.getElementById('multiple-minutes-select');
            
            if (!hoursSelect.value || !minutesSelect.value) {
                showNotification('Please select both hours and minutes', 'warning');
                return;
            }
            
            const timeString = `${hoursSelect.value}:${minutesSelect.value}`;
            
            if (multipleSelectedKickOffTimes.includes(timeString)) {
                showNotification('This time has already been added', 'warning');
                return;
            }
            
            multipleSelectedKickOffTimes.push(timeString);
            multipleSelectedKickOffTimes.sort();
            renderMultipleSelectedTimes();
            
            // Reset dropdowns
            hoursSelect.value = '';
            minutesSelect.value = '';
            
            // Trigger form validation
            validateMultiplePitchForm();
        }

        function addIndividualKickOffTime() {
            const hoursSelect = document.getElementById('individual-hours-select');
            const minutesSelect = document.getElementById('individual-minutes-select');
            
            if (!hoursSelect.value || !minutesSelect.value) {
                showNotification('Please select both hours and minutes', 'warning');
                return;
            }
            
            const timeString = `${hoursSelect.value}:${minutesSelect.value}`;
            
            if (individualSelectedKickOffTimes.includes(timeString)) {
                showNotification('This time has already been added', 'warning');
                return;
            }
            
            individualSelectedKickOffTimes.push(timeString);
            individualSelectedKickOffTimes.sort();
            renderIndividualSelectedTimes();
            
            // Reset dropdowns
            hoursSelect.value = '';
            minutesSelect.value = '';
            
            // Trigger form validation
            validateMultiplePitchForm();
        }

        function renderMultipleSelectedTimes() {
            const container = document.getElementById('multiple-selected-times');
            if (!container) return;
            
            if (multipleSelectedKickOffTimes.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = multipleSelectedKickOffTimes.map(time => `
                <div class="time-chip">
                    <span>${time}</span>
                    <button type="button" class="remove-time" onclick="removeMultipleKickOffTime('${time}')" title="Remove time">
                        Ã—
                    </button>
                </div>
            `).join('');
        }

        function renderIndividualSelectedTimes() {
            const container = document.getElementById('individual-selected-times');
            if (!container) return;
            
            if (individualSelectedKickOffTimes.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = individualSelectedKickOffTimes.map(time => `
                <div class="time-chip">
                    <span>${time}</span>
                    <button type="button" class="remove-time" onclick="removeIndividualKickOffTime('${time}')" title="Remove time">
                        Ã—
                    </button>
                </div>
            `).join('');
        }

        function removeMultipleKickOffTime(timeToRemove) {
            multipleSelectedKickOffTimes = multipleSelectedKickOffTimes.filter(time => time !== timeToRemove);
            renderMultipleSelectedTimes();
            // Trigger form validation
            validateMultiplePitchForm();
        }

        function removeIndividualKickOffTime(timeToRemove) {
            individualSelectedKickOffTimes = individualSelectedKickOffTimes.filter(time => time !== timeToRemove);
            renderIndividualSelectedTimes();
            // Trigger form validation
            validateMultiplePitchForm();
        }

        function resetMultiplePitchesForm() {
            document.getElementById('multiple-pitches-form').reset();
            multipleSelectedKickOffTimes = [];
            individualSelectedKickOffTimes = [];
            individualPitchTimes = {};
            renderMultipleSelectedTimes();
            renderIndividualSelectedTimes();
            
            // Hide all conditional sections
            document.getElementById('duplicate-days-section').style.display = 'none';
            document.getElementById('individual-days-section').style.display = 'none';
            document.getElementById('duplicate-times-section').style.display = 'none';
            document.getElementById('individual-times-section').style.display = 'none';
            document.getElementById('individual-pitches-section').style.display = 'none';
            
            // Clear individual pitch entries
            document.getElementById('individual-pitch-entries').innerHTML = '';
            
            // Check all availability days by default for both sections
            document.querySelectorAll('input[name="multiple-availability"]').forEach(cb => {
                cb.checked = true;
            });
            document.querySelectorAll('input[name="individual-availability"]').forEach(cb => {
                cb.checked = false;
            });
        }

        // Form validation functions for multiple pitches
        function validateMultiplePitchForm() {
            const pitchCount = document.getElementById('multiple-pitch-count').value;
            const duplicateDaysOption = document.getElementById('duplicate-days-option').value;
            const duplicateTimesOption = document.getElementById('duplicate-times-option').value;
            
            let isValid = true;
            let validationErrors = [];
            
            // Check if pitch count is selected
            if (!pitchCount) {
                isValid = false;
                validationErrors.push('Select number of pitches');
            }
            
            // Check if duplicate days option is selected
            if (!duplicateDaysOption) {
                isValid = false;
                validationErrors.push('Select duplicate days option');
            }
            
            // Check if duplicate times option is selected
            if (!duplicateTimesOption) {
                isValid = false;
                validationErrors.push('Select duplicate times option');
            }
            
            // If basic options are selected, check specific requirements
            if (pitchCount && duplicateDaysOption && duplicateTimesOption) {
                const pitchCountNum = parseInt(pitchCount);
                
                // Check days availability
                if (duplicateDaysOption === 'yes') {
                    const selectedDays = document.querySelectorAll('input[name="multiple-availability"]:checked');
                    if (selectedDays.length === 0) {
                        isValid = false;
                        validationErrors.push('Select at least one available day');
                    }
                } else {
                    // Individual days - will be checked in individual pitch validation
                }
                
                // Check kick-off times
                if (duplicateTimesOption === 'yes') {
                    if (!multipleSelectedKickOffTimes || multipleSelectedKickOffTimes.length === 0) {
                        isValid = false;
                        validationErrors.push('Add at least one kick-off time');
                    }
                } else {
                    // Check individual times if not duplicating
                    if (duplicateTimesOption === 'no' && !individualSelectedKickOffTimes || individualSelectedKickOffTimes.length === 0) {
                        isValid = false;
                        validationErrors.push('Add at least one kick-off time');
                    }
                }
                
                // Check individual pitch fields
                for (let i = 1; i <= pitchCountNum; i++) {
                    const nameField = document.getElementById(`pitch-name-${i}`);
                    const sizeField = document.getElementById(`pitch-size-${i}`);
                    
                    if (nameField && !nameField.value.trim()) {
                        isValid = false;
                        validationErrors.push(`Enter name for Pitch ${i}`);
                    }
                    
                    if (sizeField && !sizeField.value) {
                        isValid = false;
                        validationErrors.push(`Select size for Pitch ${i}`);
                    }
                    
                    // Check individual availability if not duplicating
                    if (duplicateDaysOption === 'no') {
                        const individualDays = document.querySelectorAll(`input[name="availability-${i}"]:checked`);
                        if (individualDays.length === 0) {
                            isValid = false;
                            validationErrors.push(`Select available days for Pitch ${i}`);
                        }
                    }
                    
                    // Check individual times if not duplicating
                    if (duplicateTimesOption === 'no') {
                        const individualTimes = individualPitchTimes && individualPitchTimes[i];
                        if (!individualTimes || individualTimes.length === 0) {
                            isValid = false;
                            validationErrors.push(`Add kick-off times for Pitch ${i}`);
                        }
                    }
                }
            }
            
            // Update button state
            const createButton = document.getElementById('create-multiple-pitches-btn');
            if (createButton) {
                createButton.disabled = !isValid;
                createButton.style.opacity = isValid ? '1' : '0.6';
                createButton.style.cursor = isValid ? 'pointer' : 'not-allowed';
                
                // Remove any existing tooltip and event listeners
                const existingTooltip = document.querySelector('.validation-tooltip');
                if (existingTooltip) {
                    existingTooltip.remove();
                }
                
                // Clean up existing event listeners by cloning the button
                const newButton = createButton.cloneNode(true);
                createButton.parentNode.replaceChild(newButton, createButton);
                
                // Re-attach the onclick handler
                newButton.onclick = saveMultiplePitches;
                
                // Update button reference
                const updatedButton = document.getElementById('create-multiple-pitches-btn');
                
                // Update button text and add professional tooltip
                if (isValid) {
                    updatedButton.innerHTML = 'Create Pitches';
                    updatedButton.removeAttribute('data-tooltip');
                } else {
                    updatedButton.innerHTML = 'Create Pitches';
                    updatedButton.setAttribute('data-tooltip', 'true');
                    
                    // Add single tooltip event listeners
                    let tooltipTimeout;
                    
                    updatedButton.addEventListener('mouseenter', function() {
                        if (updatedButton.disabled) {
                            // Clear any existing timeout
                            clearTimeout(tooltipTimeout);
                            
                            // Remove any existing tooltip first
                            const existingTooltip = document.querySelector('.validation-tooltip');
                            if (existingTooltip) {
                                existingTooltip.remove();
                            }
                            
                            // Create new tooltip
                            const tooltip = document.createElement('div');
                            tooltip.className = 'validation-tooltip';
                            tooltip.innerHTML = `
                                <div class="tooltip-header">
                                    <span class="tooltip-icon">âš ï¸</span>
                                    <span class="tooltip-title">Required Fields</span>
                                </div>
                                <div class="tooltip-content">
                                    <p class="tooltip-subtitle">Please complete the following:</p>
                                    <ul class="tooltip-list">
                                        ${validationErrors.map(error => `<li>${error}</li>`).join('')}
                                    </ul>
                                </div>
                            `;
                            
                            document.body.appendChild(tooltip);
                            
                            // Position tooltip above button
                            const buttonRect = updatedButton.getBoundingClientRect();
                            tooltip.style.position = 'absolute';
                            tooltip.style.left = (buttonRect.left + buttonRect.width / 2) + 'px';
                            tooltip.style.top = (buttonRect.top - 10) + 'px';
                            tooltip.style.transform = 'translateX(-50%) translateY(-100%)';
                            tooltip.style.zIndex = '10000';
                        }
                    });
                    
                    updatedButton.addEventListener('mouseleave', function() {
                        // Delay tooltip removal to prevent flickering
                        tooltipTimeout = setTimeout(() => {
                            const tooltipElement = document.querySelector('.validation-tooltip');
                            if (tooltipElement) {
                                tooltipElement.remove();
                            }
                        }, 100);
                    });
                }
            }
            
            return isValid;
        }

        function setupFormValidationListeners() {
            // Listen for changes on all form elements
            const form = document.getElementById('multiple-pitches-form');
            if (!form) return;
            
            // Add listeners to main form elements
            const elements = [
                'multiple-pitch-count',
                'duplicate-days-option', 
                'duplicate-times-option'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', validateMultiplePitchForm);
                }
            });
            
            // Add listeners to availability checkboxes
            document.querySelectorAll('input[name="multiple-availability"]').forEach(checkbox => {
                checkbox.addEventListener('change', validateMultiplePitchForm);
            });
            
            // Add mutation observer for dynamically added fields
            if (window.formValidationObserver) {
                window.formValidationObserver.disconnect();
            }
            
            window.formValidationObserver = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        // Re-setup listeners for new elements
                        setupDynamicValidationListeners();
                        validateMultiplePitchForm();
                    }
                });
            });
            
            window.formValidationObserver.observe(form, {
                childList: true,
                subtree: true
            });
        }

        function setupDynamicValidationListeners() {
            // Add listeners to dynamically created individual pitch fields
            const form = document.getElementById('multiple-pitches-form');
            if (!form) return;
            
            // Add listeners to individual pitch name and size fields
            form.querySelectorAll('input[id^="pitch-name-"], select[id^="pitch-size-"]').forEach(field => {
                field.removeEventListener('input', validateMultiplePitchForm);
                field.removeEventListener('change', validateMultiplePitchForm);
                field.addEventListener('input', validateMultiplePitchForm);
                field.addEventListener('change', validateMultiplePitchForm);
            });
            
            // Add listeners to individual availability checkboxes
            form.querySelectorAll('input[name^="availability-"]').forEach(checkbox => {
                checkbox.removeEventListener('change', validateMultiplePitchForm);
                checkbox.addEventListener('change', validateMultiplePitchForm);
            });
        }

        function removeFormValidationListeners() {
            if (window.formValidationObserver) {
                window.formValidationObserver.disconnect();
                window.formValidationObserver = null;
            }
        }

        function saveMultiplePitches() {
            const form = document.getElementById('multiple-pitches-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const pitchCount = parseInt(document.getElementById('multiple-pitch-count').value);
            const duplicateDaysOption = document.getElementById('duplicate-days-option').value;
            const duplicateTimesOption = document.getElementById('duplicate-times-option').value;

            // Validate duplicate options are selected
            if (!duplicateDaysOption) {
                showNotification('Please select whether to duplicate available days', 'error');
                return;
            }
            if (!duplicateTimesOption) {
                showNotification('Please select whether to duplicate kick-off times', 'error');
                return;
            }

            // Check subscription limits
            const currentPitchCount = pitchesData.length;
            const maxPitches = subscriptionLimits[currentPlan];
            
            if (currentPitchCount + pitchCount > maxPitches) {
                showNotification(`Cannot add ${pitchCount} Pitches. You can only add ${maxPitches - currentPitchCount} more Pitch${maxPitches - currentPitchCount > 1 ? 'es' : ''} with your current subscription.`, 'warning');
                showUpgradeDialog();
                return;
            }

            let newPitchesData = [];

            // Individual pitch mode - validate each pitch
            for (let i = 1; i <= pitchCount; i++) {
                const pitchName = document.getElementById(`pitch-name-${i}`).value.trim();
                const pitchSize = document.getElementById(`pitch-size-${i}`).value;
                
                if (!pitchName) {
                    showNotification(`Please enter a name for Pitch ${i}`, 'error');
                    return;
                }
                if (!pitchSize) {
                    showNotification(`Please select a size for Pitch ${i}`, 'error');
                    return;
                }

                // Get availability for this pitch
                let availability = {};
                if (duplicateDaysOption === 'yes') {
                    ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'].forEach(day => {
                        const checkbox = document.querySelector(`input[name="multiple-availability"][value="${day}"]`);
                        availability[day] = checkbox ? checkbox.checked : false;
                    });
                } else {
                    ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'].forEach(day => {
                        const checkbox = document.querySelector(`input[name="availability-${i}"][value="${day}"]`);
                        availability[day] = checkbox ? checkbox.checked : false;
                    });
                }

                // Check if at least one day is selected
                if (!Object.values(availability).some(day => day)) {
                    showNotification(`Please select at least one available day for Pitch ${i}`, 'error');
                    return;
                }

                // Get kick-off times for this pitch
                let kickOffTimes = [];
                if (duplicateTimesOption === 'yes') {
                    if (multipleSelectedKickOffTimes.length === 0) {
                        showNotification('Please add at least one kick-off time', 'error');
                        return;
                    }
                    kickOffTimes = [...multipleSelectedKickOffTimes];
                } else {
                    kickOffTimes = individualPitchTimes[i] || [];
                    if (kickOffTimes.length === 0) {
                        showNotification(`Please add at least one kick-off time for Pitch ${i}`, 'error');
                        return;
                    }
                }

                newPitchesData.push({
                    name: pitchName,
                    pitchSize: pitchSize,
                    availability: availability,
                    kickOffTimes: kickOffTimes
                });
            }

            // Check for name conflicts
            const allNames = newPitchesData.map(p => p.name);
            const existingNames = newPitchesData.filter(pitch => 
                pitchesData.some(p => p.name.toLowerCase() === pitch.name.toLowerCase())
            );
            
            const conflicts = allNames.filter(pitchName => 
                pitchesData.some(p => p.name.toLowerCase() === pitchName.toLowerCase())
            );
            
            if (conflicts.length > 0) {
                showNotification(`The following pitch names already exist: ${conflicts.join(', ')}`, 'error');
                return;
            }

            // Create pitches
            const createdPitches = [];
            newPitchesData.forEach((pitch, index) => {
                const pitchData = {
                    id: 'pitch-' + (Date.now() + index).toString().slice(-6),
                    name: pitch.name,
                    status: 'available',
                    pitchSize: pitch.pitchSize,
                    kickOffTimes: [...pitch.kickOffTimes].sort(),
                    availability: { ...pitch.availability }
                };
                
                pitchesData.push(pitchData);
                mockBookings[pitchData.id] = {};
                createdPitches.push(pitch.name);
            });
            
            // Save updated data with conflict detection
            savePitchesDataWithConflictCheck().then(result => {
                if (result.success) {
                    // Update UI
                    renderPitchesGrid();
                    updateSubscriptionInfo();
                    closeMultiplePitchesModal();
                    
                    // Show success message
                    showNotification(`Successfully created ${pitchCount} Pitch${pitchCount > 1 ? 'es' : ''}: ${createdPitches.join(', ')}`, 'success');
                } else if (result.cancelled) {
                    showNotification('Multiple pitch creation cancelled - data refreshed from server', 'info');
                } else {
                    showNotification('Failed to create multiple pitches', 'error');
                }
            });
        }

        function generatePitchNames(baseName, count, pattern) {
            const names = [];
            
            for (let i = 0; i < count; i++) {
                switch (pattern) {
                    case 'numbered':
                        names.push(`${baseName} ${i + 1}`);
                        break;
                    case 'letters':
                        const letter = String.fromCharCode(65 + i); // A, B, C, etc.
                        names.push(`${baseName} ${letter}`);
                        break;
                    case 'descriptive':
                        const descriptors = ['Main', 'Secondary', 'Reserve', 'Practice', 'Training', 'Competition', 'Youth', 'Senior', 'Primary', 'Backup'];
                        const descriptor = descriptors[i] || `${i + 1}`;
                        names.push(`${baseName} ${descriptor}`);
                        break;
                    default:
                        names.push(`${baseName} ${i + 1}`);
                }
            }
            
            return names;
        }
    </script>
</body>
</html>


